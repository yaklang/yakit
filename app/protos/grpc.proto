syntax = "proto3";

package ypb;
option go_package = "/;ypb";

message Empty {
}

message VersionResponse {
  string Version = 1;
}

message GeneralResponse {
  bool Ok = 1;
  string Reason = 2;
}

message DeleteYakScriptRequest {
  int64  Id = 3;
  repeated int64 Ids = 4;
}

message ExecBatchYakScriptRequest {
  // 目标会被自动拆分
  string Target = 1;
  string TargetFile = 11;

  // 额外参数可以被添加
  repeated ExecParamItem ExtraParams = 7;

  // 筛选与限制
  string Keyword = 2;
  repeated string ExcludedYakScript = 22;
  bool DisableNucleiWorkflow = 23;
  int64 Limit = 3;

  // 默认总用时
  int64 TotalTimeoutSeconds = 4;

  // 模块类型，默认为 nuclei
  string Type = 5;

  // 并发（进程）
  int64 Concurrent = 6;

  // 精确使用脚本名称
  // 要注意，这个 Scripts 和 PluginFilter 是冲突的
  repeated string ScriptNames = 8;

  // Tags with exclude / include
  QueryYakScriptRequest PluginFilter = 12;
  bool EnablePluginFilter = 13;

  // 设置一个代理
  string Proxy = 14;

  // 每个进程的任务数量
  int64 ProgressTaskCount = 15;

  // 基础进度 - 这个默认是 0.1 一般别用，只在 Recover 的时候可能才会有用处
  double BaseProgress = 16;
  // 这个很关键，不然会报错
  bool FromRecover = 17;

  string YakScriptOnlineGroup = 18;
  string TaskName = 19;
}

message ExecBatchYakScriptResult {
  string Id = 1;
  string Status = 2;
  bool Ok = 4;
  string Reason = 5;
  bool Exploitable = 6;

  // 脚本的详细信息
  YakScript PoC = 7;
  ExecResult Result = 8;

  // 如果是整体进度信息，则在这儿展示
  // 处理这几个消息的时候，其他都不应该生效
  bool ProgressMessage = 9;
  double ProgressPercent = 10;
  int64 ProgressTotal = 11;
  int64 ProgressCount = 12;

  // 正在执行中的进程数
  int64 ProgressRunning = 17;

  // 正在执行中的扫描任务数量
  int64 ScanTaskExecutingCount = 18;

  // 任务相关内容
  string Target = 13;
  repeated ExecParamItem ExtraParam = 14;
  string TaskId = 15;

  // 当前时间
  int64 Timestamp = 16;
}

message GetYakScriptByIdRequest {
  int64 Id = 1;
}

message GetYakScriptByNameRequest {
  string Name = 1;
  string UUID = 2;
}

message GetYakScriptByOnlineIDRequest {
  string UUID = 1;
  int64 OnlineID = 2;
}


message VerifySystemCertificateResponse {
  bool valid = 1;
  string Reason = 2;
}

service Yak {
  // version
  rpc Version(Empty) returns (VersionResponse);
  rpc YakVersionAtLeast(YakVersionAtLeastRequest) returns (GeneralResponse);

  // echo 通常用于测试服务是否通畅
  rpc Echo(EchoRequest) returns(EchoResposne);

  rpc VerifySystemCertificate(Empty) returns (VerifySystemCertificateResponse);

  // 中间人劫持
  rpc MITM(stream MITMRequest) returns (stream MITMResponse);
  rpc SetMITMFilter(SetMITMFilterRequest) returns (SetMITMFilterResponse);
  rpc GetMITMFilter(Empty) returns (SetMITMFilterRequest);
  rpc DownloadMITMCert(Empty) returns (MITMCert);

  // 开启端口
  rpc OpenPort(stream Input) returns (stream Output);

  // Exec
  rpc Exec(ExecRequest) returns (stream ExecResult);
  rpc QueryExecHistory(ExecHistoryRequest) returns (ExecHistoryRecordResponse);
  rpc RemoveExecHistory(Empty) returns (Empty);
  rpc LoadNucleiTemplates(Empty) returns (Empty);
  rpc AutoUpdateYakModule(Empty) returns (stream ExecResult);
  rpc ExecYakScript(ExecRequest) returns (stream ExecResult);

  // ExecBatch Script
  rpc ExecBatchYakScript(ExecBatchYakScriptRequest) returns (stream ExecBatchYakScriptResult);
  rpc GetExecBatchYakScriptUnfinishedTask(Empty) returns (GetExecBatchYakScriptUnfinishedTaskResponse);
  rpc GetExecBatchYakScriptUnfinishedTaskByUid(GetExecBatchYakScriptUnfinishedTaskByUidRequest) returns (ExecBatchYakScriptRequest);
  rpc PopExecBatchYakScriptUnfinishedTaskByUid(GetExecBatchYakScriptUnfinishedTaskByUidRequest) returns (ExecBatchYakScriptRequest);
  rpc RecoverExecBatchYakScriptUnfinishedTask(RecoverExecBatchYakScriptUnfinishedTaskRequest) returns (stream ExecBatchYakScriptResult);

  // yakScript
  rpc QueryYakScript(QueryYakScriptRequest) returns (QueryYakScriptResponse);
  rpc QueryYakScriptByYakScriptName(QueryYakScriptRequest) returns (stream YakScript);
  rpc SaveYakScript(YakScript) returns (YakScript);
  rpc DeleteYakScript(DeleteYakScriptRequest) returns (Empty);
  rpc GetYakScriptById(GetYakScriptByIdRequest) returns (YakScript);
  rpc GetYakScriptByName(GetYakScriptByNameRequest) returns (YakScript);
  rpc GetYakScriptByOnlineID(GetYakScriptByOnlineIDRequest) returns (YakScript);
  rpc IgnoreYakScript(DeleteYakScriptRequest) returns (Empty);
  rpc UnIgnoreYakScript(DeleteYakScriptRequest) returns (Empty);
  rpc ExportYakScript(ExportYakScriptRequest) returns (ExportYakScriptResponse);
  rpc ExportYakScriptStream(ExportYakScriptStreamRequest) returns (stream ExecResult);
  rpc ImportYakScriptStream(ImportYakScriptStreamRequest) returns (stream ExecResult);
  rpc ExecutePacketYakScript(ExecutePacketYakScriptParams) returns (stream ExecResult);
  rpc ExecuteBatchPacketYakScript(ExecuteBatchPacketYakScriptParams) returns (stream ExecBatchYakScriptResult);
  rpc GetYakScriptTags(Empty) returns (GetYakScriptTagsResponse);
  rpc QueryYakScriptLocalAndUser(QueryYakScriptLocalAndUserRequest) returns (QueryYakScriptLocalAndUserResponse);
  rpc QueryYakScriptByOnlineGroup(QueryYakScriptByOnlineGroupRequest) returns (QueryYakScriptLocalAndUserResponse);
  rpc QueryYakScriptLocalAll(Empty) returns (QueryYakScriptLocalAndUserResponse);
  rpc QueryYakScriptByNames(QueryYakScriptByNamesRequest) returns (QueryYakScriptByNamesResponse);
  rpc QueryYakScriptByIsCore(QueryYakScriptByIsCoreRequest) returns (QueryYakScriptByIsCoreResponse);
  // 接口废弃
  rpc QueryYakScriptRiskDetailByCWE(QueryYakScriptRiskDetailByCWERequest) returns (QueryYakScriptRiskDetailByCWEResponse);
  // 接口废弃
  rpc YakScriptRiskTypeList(Empty) returns (YakScriptRiskTypeListResponse);
  rpc SaveNewYakScript(SaveNewYakScriptRequest) returns (YakScript);
  rpc SaveYakScriptToOnline(SaveYakScriptToOnlineRequest) returns (stream SaveYakScriptToOnlineResponse);

  // 结构变化,接口废弃
  rpc ExportLocalYakScript(ExportLocalYakScriptRequest) returns (ExportLocalYakScriptResponse);
  rpc ExportLocalYakScriptStream(ExportLocalYakScriptRequest) returns (stream ExportYakScriptLocalResponse);

  rpc ImportYakScript(ImportYakScriptRequest) returns (stream ImportYakScriptResult);

  // YakScript Group
  rpc QueryYakScriptGroup(QueryYakScriptGroupRequest) returns (QueryYakScriptGroupResponse);
  rpc SaveYakScriptGroup(SaveYakScriptGroupRequest) returns (Empty);
  rpc RenameYakScriptGroup(RenameYakScriptGroupRequest) returns (Empty);
  rpc DeleteYakScriptGroup(DeleteYakScriptGroupRequest) returns (Empty);
  rpc GetYakScriptGroup(QueryYakScriptRequest) returns (GetYakScriptGroupResponse);
  rpc ResetYakScriptGroup(ResetYakScriptGroupRequest) returns (Empty);
  rpc SetGroup(SetGroupRequest) returns (Empty);


  // HTTPFlow
  rpc GetHTTPFlowByHash(GetHTTPFlowByHashRequest) returns (HTTPFlow);
  rpc GetHTTPFlowById(GetHTTPFlowByIdRequest) returns (HTTPFlow);
  rpc GetHTTPFlowBodyById(GetHTTPFlowBodyByIdRequest) returns (stream GetHTTPFlowBodyByIdResponse);
  rpc GetHTTPFlowByIds(GetHTTPFlowByIdsRequest) returns (HTTPFlows);
  rpc QueryHTTPFlows(QueryHTTPFlowRequest) returns (QueryHTTPFlowResponse);
  rpc DeleteHTTPFlows(DeleteHTTPFlowRequest) returns (Empty);
  rpc SetTagForHTTPFlow(SetTagForHTTPFlowRequest) returns (Empty);
  rpc QueryHTTPFlowsIds(QueryHTTPFlowsIdsRequest) returns (QueryHTTPFlowsIdsResponse);
  rpc HTTPFlowsFieldGroup(HTTPFlowsFieldGroupRequest) returns (HTTPFlowsFieldGroupResponse);
  rpc HTTPFlowsShare(HTTPFlowsShareRequest) returns (HTTPFlowsShareResponse);
  rpc HTTPFlowsExtract(HTTPFlowsExtractRequest) returns (Empty);
  rpc GetHTTPFlowBare(HTTPFlowBareRequest) returns (HTTPFlowBareResponse);
  rpc ExportHTTPFlows(ExportHTTPFlowsRequest) returns(QueryHTTPFlowResponse);
  rpc HTTPFlowsToOnline(HTTPFlowsToOnlineRequest) returns (Empty);

  // 从一个 FuzzerRequest 中提取 Url
  rpc ExtractUrl(FuzzerRequest) returns (ExtractedUrl);

  // Fuzzer
  rpc GetHistoryHTTPFuzzerTask(GetHistoryHTTPFuzzerTaskRequest) returns (HistoryHTTPFuzzerTaskDetail);
  rpc QueryHistoryHTTPFuzzerTask(Empty) returns (HistoryHTTPFuzzerTasks);
  rpc QueryHistoryHTTPFuzzerTaskEx(QueryHistoryHTTPFuzzerTaskExParams) returns (HistoryHTTPFuzzerTasksResponse);
  rpc DeleteHistoryHTTPFuzzerTask(DeleteHistoryHTTPFuzzerTaskRequest) returns (Empty);
  rpc HTTPFuzzer(FuzzerRequest) returns (stream FuzzerResponse);
  rpc HTTPFuzzerSequence(FuzzerRequests) returns (stream FuzzerSequenceResponse);
  rpc PreloadHTTPFuzzerParams(PreloadHTTPFuzzerParamsRequest) returns (PreloadHTTPFuzzerParamsResponse);
  rpc RenderVariables(RenderVariablesRequest) returns (RenderVariablesResponse);
  rpc MatchHTTPResponse(MatchHTTPResponseParams) returns (MatchHTTPResponseResult);
  rpc ExtractHTTPResponse(ExtractHTTPResponseParams) returns (ExtractHTTPResponseResult);
  rpc RedirectRequest(RedirectRequestParams) returns (FuzzerResponse);
  rpc HTTPRequestMutate(HTTPRequestMutateParams) returns (MutateResult);
  rpc HTTPResponseMutate(HTTPResponseMutateParams) returns (MutateResult);
  rpc FixUploadPacket(FixUploadPacketRequest) returns (FixUploadPacketResponse);
  rpc IsMultipartFormDataRequest(FixUploadPacketRequest) returns (IsMultipartFormDataRequestResult);
  rpc GenerateExtractRule(GenerateExtractRuleRequest) returns (GenerateExtractRuleResponse);
  rpc ExtractData(stream ExtractDataRequest) returns (stream ExtractDataResponse);
  rpc ImportHTTPFuzzerTaskFromYaml(ImportHTTPFuzzerTaskFromYamlRequest) returns (ImportHTTPFuzzerTaskFromYamlResponse);
  rpc ExportHTTPFuzzerTaskToYaml(ExportHTTPFuzzerTaskToYamlRequest) returns (ExportHTTPFuzzerTaskToYamlResponse);
  rpc RenderHTTPFuzzerPacket(RenderHTTPFuzzerPacketRequest) returns (RenderHTTPFuzzerPacketResponse);

  rpc SaveFuzzerLabel(SaveFuzzerLabelRequest) returns (Empty);
  rpc QueryFuzzerLabel(Empty) returns (QueryFuzzerLabelResponse);
  rpc DeleteFuzzerLabel(DeleteFuzzerLabelRequest) returns (Empty);

  // HTTPFuzzerResponse
  // 这个挺特殊的，因为数据包太多了，会卡，所以后端会保存一份，通过这个接口做缓存查询
  rpc QueryHTTPFuzzerResponseByTaskId(QueryHTTPFuzzerResponseByTaskIdRequest) returns (QueryHTTPFuzzerResponseByTaskIdResponse) ;

  // WebSocket
  rpc CreateWebsocketFuzzer(stream ClientWebsocketRequest) returns (stream ClientWebsocketResponse);
  rpc QueryWebsocketFlowByHTTPFlowWebsocketHash(QueryWebsocketFlowByHTTPFlowWebsocketHashRequest) returns (WebsocketFlows);
  rpc DeleteWebsocketFlowByHTTPFlowWebsocketHash(DeleteWebsocketFlowByHTTPFlowWebsocketHashRequest) returns (Empty);
  rpc DeleteWebsocketFlowAll(Empty) returns (Empty);

  // FuzzerResponse 对象转 HTTPFlow：以便分析和模糊测试
  rpc ConvertFuzzerResponseToHTTPFlow(FuzzerResponse) returns (HTTPFlow);

  // 渲染 Fuzzer 模版
  rpc StringFuzzer(StringFuzzerRequest) returns (StringFuzzerResponse);

  // 分析一个 HTTP 请求详情
  rpc HTTPRequestAnalyzer(HTTPRequestAnalysisMaterial) returns (HTTPRequestAnalysis);

  // 编码解码
  rpc Codec(CodecRequest) returns (CodecResponse);
  rpc NewCodec(CodecRequestFlow) returns (CodecResponse);
  rpc GetAllCodecMethods(Empty) returns(CodecMethods);

  rpc SaveCodecFlow(CustomizeCodecFlow) returns (Empty);
  rpc DeleteCodecFlow(DeleteCodecFlowRequest) returns (Empty);
  rpc GetAllCodecFlow(Empty) returns (GetCodecFlowResponse);
  rpc PacketPrettifyHelper(PacketPrettifyHelperRequest) returns (PacketPrettifyHelperResponse);

  // Payload 相关接口
  // database payload group
  rpc QueryPayload(QueryPayloadRequest) returns (QueryPayloadResponse); // query by [keyword/group/folder]
  rpc QueryPayloadFromFile(QueryPayloadFromFileRequest) returns (QueryPayloadFromFileResponse);
  // delete by [id/group/folder]
  rpc DeletePayloadByFolder(NameRequest) returns (Empty);
  rpc DeletePayloadByGroup(DeletePayloadByGroupRequest) returns (Empty);
  rpc DeletePayload(DeletePayloadRequest) returns (Empty);
  // save payload to database
  rpc SavePayload(SavePayloadRequest) returns (Empty);
  rpc SavePayloadStream(SavePayloadRequest) returns (stream SavePayloadProgress);
  rpc SavePayloadToFileStream(SavePayloadRequest) returns (stream SavePayloadProgress); // 两次stream
  // update group/folder/payload
  rpc RenamePayloadFolder(RenameRequest) returns (Empty);
  rpc RenamePayloadGroup(RenameRequest) returns (Empty); // rename
  rpc UpdatePayload(UpdatePayloadRequest) returns (Empty); // edit
  rpc UpdatePayloadToFile(UpdatePayloadToFileRequest) returns (Empty);
  rpc BackUpOrCopyPayloads(BackUpOrCopyPayloadsRequest) returns (Empty);
  // Folder and Group
  // get and update all group with order
  rpc GetAllPayloadGroup(Empty) returns (GetAllPayloadGroupResponse);
  rpc UpdateAllPayloadGroup(UpdateAllPayloadGroupRequest) returns (Empty);
  // get payload
  rpc GetAllPayload(GetAllPayloadRequest) returns (GetAllPayloadResponse); // !已弃用 get payload by [group/folder]
  rpc GetAllPayloadFromFile(GetAllPayloadRequest) returns (stream GetAllPayloadFromFileResponse); // !已弃用 get payload by [group/folder] from file
  // export payload
  rpc ExportAllPayload(GetAllPayloadRequest) returns (stream GetAllPayloadResponse); // get payload by [group/folder]
  rpc ExportAllPayloadFromFile(GetAllPayloadRequest) returns (stream GetAllPayloadResponse); // get payload by [group/folder] from file
  // create folder
  rpc CreatePayloadFolder(NameRequest) returns (Empty);
  // 去重
  rpc RemoveDuplicatePayloads(NameRequest) returns (stream SavePayloadProgress);
  // 转换为数据库保存
  rpc CoverPayloadGroupToDatabase(NameRequest) returns (stream SavePayloadProgress); // !已弃用
  rpc ConvertPayloadGroupToDatabase(NameRequest) returns (stream SavePayloadProgress);
  // 迁移旧的payload
  rpc MigratePayloads(Empty) returns (stream SavePayloadProgress);

  // 自动生成补全
  rpc GetYakitCompletionRaw(Empty) returns (YakitCompletionRawResponse);
  rpc GetYakVMBuildInMethodCompletion(GetYakVMBuildInMethodCompletionRequest) returns (GetYakVMBuildInMethodCompletionResponse);
  rpc StaticAnalyzeError(StaticAnalyzeErrorRequest) returns (StaticAnalyzeErrorResponse);
  rpc YaklangCompileAndFormat(YaklangCompileAndFormatRequest) returns (YaklangCompileAndFormatResponse);

  // LSP
  rpc YaklangLanguageSuggestion(YaklangLanguageSuggestionRequest) returns (YaklangLanguageSuggestionResponse);
  rpc YaklangLanguageFind(YaklangLanguageSuggestionRequest) returns (YaklangLanguageFindResponse);
  // 从代码中提取yaklang数据
  rpc YaklangInspectInformation(YaklangInspectInformationRequest) returns (YaklangInspectInformationResponse);
  // 进行数据迁移使用
  rpc YaklangGetCliCodeFromDatabase(YaklangGetCliCodeFromDatabaseRequest) returns (YaklangGetCliCodeFromDatabaseResponse);
  // editor terminal 交互
  rpc YaklangTerminal(stream Input) returns (stream Output);

  // 端口扫描的封装
  rpc PortScan(PortScanRequest) returns (stream ExecResult);
  rpc ViewPortScanCode(Empty) returns (SimpleScript);

  rpc SimpleDetect(RecordPortScanRequest) returns (stream ExecResult);
  rpc SaveCancelSimpleDetect(RecordPortScanRequest) returns (Empty);
  rpc SimpleDetectCreatReport(CreatReportRequest) returns (stream ExecResult);

  // new interface
  rpc QuerySimpleDetectUnfinishedTask(QueryUnfinishedTaskRequest) returns (QueryUnfinishedTaskResponse);
  rpc GetSimpleDetectRecordRequestById(GetUnfinishedTaskDetailByIdRequest) returns (RecordPortScanRequest);
  rpc DeleteSimpleDetectUnfinishedTask(DeleteUnfinishedTaskRequest) returns (Empty);
  rpc RecoverSimpleDetectTask(RecoverUnfinishedTaskRequest) returns (stream ExecResult);
  //----

  // Deprecated interface
  rpc GetSimpleDetectUnfinishedTask(Empty) returns (GetSimpleDetectUnfinishedTaskResponse);
  rpc GetSimpleDetectUnfinishedTaskByUid(GetExecBatchYakScriptUnfinishedTaskByUidRequest) returns (RecordPortScanRequest);
  rpc PopSimpleDetectUnfinishedTaskByUid(GetExecBatchYakScriptUnfinishedTaskByUidRequest) returns (RecordPortScanRequest);
  rpc RecoverSimpleDetectUnfinishedTask(RecoverExecBatchYakScriptUnfinishedTaskRequest) returns (stream ExecResult);
  // ----

  // 资产管理
  rpc QueryPorts(QueryPortsRequest) returns (QueryPortsResponse);
  rpc DeletePorts(DeletePortsRequest) returns (Empty);
  rpc QueryHosts(QueryHostsRequest) returns (QueryHostsResponse);
  rpc DeleteHosts(DeleteHostsRequest) returns (Empty);
  rpc QueryDomains(QueryDomainsRequest) returns(QueryDomainsResponse);
  rpc DeleteDomains(DeleteDomainsRequest)returns(Empty);
  rpc QueryPortsGroup(Empty)returns (QueryPortsGroupResponse);

  // Yakit Store
  rpc UpdateFromYakitResource(UpdateFromYakitResourceRequest) returns (Empty);
  rpc UpdateFromGithub(UpdateFromGithubRequest) returns (Empty);

  // Menu
  rpc AddToMenu(AddToMenuRequest) returns (Empty);
  rpc RemoveFromMenu(RemoveFromMenuRequest) returns (Empty);
  rpc YakScriptIsInMenu(YakScriptIsInMenuRequest) returns (Empty);
  rpc GetAllMenuItem(Empty) returns (MenuByGroup);
  rpc DeleteAllMenuItem(Empty) returns (Empty);
  rpc ImportMenuItem(ImportMenuItemRequest) returns (Empty);
  rpc ExportMenuItem(Empty) returns (ExportMenuItemResult);
  rpc GetMenuItemById(GetMenuItemByIdRequest) returns (MenuItem);
  rpc QueryGroupsByYakScriptId(QueryGroupsByYakScriptIdRequest) returns (GroupNames);
  rpc AddMenus(AddMenuRequest) returns (Empty);
  rpc QueryAllMenuItem(QueryAllMenuItemRequest) returns (MenuByGroup);
  rpc DeleteAllMenu(QueryAllMenuItemRequest) returns (Empty);

  // NewMenu
  rpc AddToNavigation(AddToNavigationRequest) returns (Empty);
  rpc GetAllNavigationItem(GetAllNavigationRequest) returns (GetAllNavigationItemResponse);
  rpc DeleteAllNavigation(GetAllNavigationRequest) returns (Empty);
  rpc AddOneNavigation(AddOneNavigationRequest) returns (Empty);
  rpc QueryNavigationGroups(QueryNavigationGroupsRequest) returns (GroupNames);

  // document
  rpc SaveMarkdownDocument(SaveMarkdownDocumentRequest) returns (Empty);
  rpc GetMarkdownDocument(GetMarkdownDocumentRequest) returns (GetMarkdownDocumentResponse);
  rpc DeleteMarkdownDocument(GetMarkdownDocumentRequest) returns (Empty);

  // Crawler
  rpc StartBasicCrawler(StartBasicCrawlerRequest)returns (ExecResult);
  rpc ViewBasicCrawlerCode(Empty) returns (SimpleScript);
  rpc GenerateWebsiteTree(GenerateWebsiteTreeRequest) returns (GenerateWebsiteTreeResponse);

  // 对插件结果的操作
  rpc QueryYakScriptExecResult(QueryYakScriptExecResultRequest) returns (QueryYakScriptExecResultResponse);
  rpc QueryYakScriptNameInExecResult(Empty) returns (YakScriptNames);
  rpc DeleteYakScriptExecResult(DeleteYakScriptExecResultRequest) returns (Empty);
  rpc DeleteYakScriptExec(Empty) returns (Empty);

  // Bruter
  rpc StartBrute(StartBruteParams) returns (stream ExecResult);
  rpc GetAvailableBruteTypes(Empty) returns (GetAvailableBruteTypesResponse);

  // Tunnel Server RMI/DNSLog
  rpc GetTunnelServerExternalIP(GetTunnelServerExternalIPParams) returns (GetTunnelServerExternalIPResponse);
  rpc VerifyTunnelServerDomain(VerifyTunnelServerDomainParams) returns (VerifyTunnelServerDomainResponse) ;
  rpc StartFacades(StartFacadesParams) returns (stream ExecResult);
  rpc StartFacadesWithYsoObject(StartFacadesWithYsoParams) returns (stream ExecResult);
  rpc ApplyClassToFacades(ApplyClassToFacadesParamsWithVerbose) returns (Empty);
  rpc BytesToBase64(BytesToBase64Request) returns (BytesToBase64Response);
  rpc ConfigGlobalReverse(ConfigGlobalReverseParams) returns (stream Empty);
  rpc AvailableLocalAddr(Empty) returns (AvailableLocalAddrResponse);
  rpc GetGlobalReverseServer(Empty) returns (GetGlobalReverseServerResponse);

  // Risk
  rpc QueryRisks(QueryRisksRequest) returns (QueryRisksResponse);
  rpc QueryRisk(QueryRiskRequest) returns (Risk);
  rpc DeleteRisk(DeleteRiskRequest) returns (Empty);
  rpc QueryAvailableRiskType(Empty) returns (Fields);
  rpc QueryAvailableRiskLevel(Empty) returns (Fields);
  rpc QueryRiskTableStats(Empty) returns (RiskTableStats);
  rpc ResetRiskTableStats(Empty) returns (Empty);
  rpc QueryAvailableTarget(Empty) returns (Fields);
  rpc QueryNewRisk(QueryNewRiskRequest) returns (QueryNewRiskResponse);
  rpc NewRiskRead(NewRiskReadRequest) returns (Empty);
  rpc UploadRiskToOnline(UploadRiskToOnlineRequest) returns (Empty);
  rpc SetTagForRisk(SetTagForRiskRequest) returns (Empty);
  rpc QueryRiskTags(Empty) returns (QueryRiskTagsResponse);
  rpc RiskFieldGroup(Empty) returns (RiskFieldGroupResponse);


  // Report
  rpc QueryReports(QueryReportsRequest) returns(QueryReportsResponse);
  rpc QueryReport(QueryReportRequest) returns (Report);
  rpc DeleteReport(DeleteReportRequest) returns (Empty);
  rpc QueryAvailableReportFrom(Empty) returns (Fields);

  rpc DownloadReport(DownloadReportRequest) returns (Empty);

  //Yso
  rpc GetAllYsoGadgetOptions(Empty) returns (YsoOptionsWithVerbose);
  rpc GetAllYsoClassOptions(YsoOptionsRequerstWithVerbose) returns (YsoOptionsWithVerbose);
  rpc GetAllYsoClassGeneraterOptions(YsoOptionsRequerstWithVerbose) returns (YsoClassOptionsResponseWithVerbose);
  rpc GenerateYsoCode(YsoOptionsRequerstWithVerbose) returns (YsoCodeResponse);
  rpc GenerateYsoBytes(YsoOptionsRequerstWithVerbose) returns (YsoBytesResponse);
  rpc YsoDump(YsoBytesObject)returns(YsoDumpResponse);

  // WebShell
  rpc CreateWebShell(WebShell) returns (WebShell);
  rpc DeleteWebShell(DeleteWebShellRequest) returns (Empty);
  rpc UpdateWebShell(WebShell) returns (WebShell);
  rpc QueryWebShells(QueryWebShellsRequest) returns (QueryWebShellsResponse);
  rpc Ping(WebShellRequest) returns (WebShellResponse);
  rpc GetBasicInfo(WebShellRequest) returns (WebShellResponse);
  rpc GenerateWebShell(ShellGenerate) returns(WebShellResponse);

  // DNSLog / ICMP / RandomTrigger
  rpc SetYakBridgeLogServer(YakDNSLogBridgeAddr) returns (Empty);
  rpc GetCurrentYakBridgeLogServer(Empty) returns (YakDNSLogBridgeAddr);
  rpc RequireDNSLogDomain(YakDNSLogBridgeAddr) returns (DNSLogRootDomain);
  rpc RequireDNSLogDomainByScript(RequireDNSLogDomainByScriptRequest) returns (DNSLogRootDomain);
  rpc QueryDNSLogByToken(QueryDNSLogByTokenRequest) returns (QueryDNSLogByTokenResponse);
  rpc QueryDNSLogTokenByScript(RequireDNSLogDomainByScriptRequest) returns (QueryDNSLogByTokenResponse);
  rpc RequireICMPRandomLength(Empty) returns (RequireICMPRandomLengthResponse);
  rpc QueryICMPTrigger(QueryICMPTriggerRequest) returns (QueryICMPTriggerResponse);
  rpc RequireRandomPortToken(Empty) returns (RandomPortInfo);
  rpc QueryRandomPortTrigger(QueryRandomPortTriggerRequest) returns (RandomPortTriggerNotification);
  rpc QuerySupportedDnsLogPlatforms(Empty) returns (QuerySupportedDnsLogPlatformsResponse);

  // 获取 Tags
  rpc GetAvailableYakScriptTags(Empty) returns (Fields);
  rpc ForceUpdateAvailableYakScriptTags(Empty) returns (Empty);

  // 通用的漏洞检测技术方案
  rpc ExecYakitPluginsByYakScriptFilter(ExecYakitPluginsByYakScriptFilterRequest) returns (stream ExecResult);

  // GenerateYakCodeByPacket
  rpc GenerateYakCodeByPacket(GenerateYakCodeByPacketRequest) returns (GenerateYakCodeByPacketResponse);

  // CSRF Generator
  rpc GenerateCSRFPocByPacket(GenerateCSRFPocByPacketRequest) returns (GenerateCSRFPocByPacketResponse);

  // MITM 衍生功能：
  // Replacers 管理
  rpc ExportMITMReplacerRules(Empty) returns (ExportMITMReplacerRulesResponse);
  rpc ImportMITMReplacerRules(ImportMITMReplacerRulesRequest) returns (Empty);
  rpc GetCurrentRules(Empty) returns (MITMContentReplacers);
  rpc SetCurrentRules(MITMContentReplacers) returns (Empty);
  rpc GenerateURL(GenerateURLRequest) returns (GenerateURLResponse);

  rpc ExtractDataToFile(stream ExtractDataToFileRequest) returns (stream ExtractDataToFileResult);

  // 尝试自动解码
  rpc AutoDecode(AutoDecodeRequest) returns (AutoDecodeResponse);

  rpc GetSystemProxy(Empty) returns (GetSystemProxyResult);
  rpc SetSystemProxy(SetSystemProxyRequest) returns (Empty);

  // 设置通用存储
  rpc GetKey(GetKeyRequest) returns (GetKeyResult);
  rpc SetKey(SetKeyRequest) returns (Empty);
  rpc DelKey(GetKeyRequest) returns (Empty);
  rpc GetAllProcessEnvKey(Empty) returns (GetProcessEnvKeyResult);
  rpc SetProcessEnvKey(SetKeyRequest) returns (Empty);

  rpc GetProjectKey(GetKeyRequest) returns (GetKeyResult);
  rpc SetProjectKey(SetKeyRequest) returns (Empty);

  // Online
  rpc GetOnlineProfile(Empty) returns (OnlineProfile);
  rpc SetOnlineProfile(OnlineProfile) returns (Empty);
  // 废弃接口
  rpc DownloadOnlinePluginById(DownloadOnlinePluginByIdRequest) returns (Empty);
  // 废弃接口
  rpc DownloadOnlinePluginByIds(DownloadOnlinePluginByIdsRequest) returns (Empty);
  // 废弃接口
  rpc DownloadOnlinePluginAll(DownloadOnlinePluginByTokenRequest) returns (stream DownloadOnlinePluginProgress);
  rpc DeletePluginByUserID(DeletePluginByUserIDRequest) returns (Empty);
  rpc DeleteAllLocalPlugins(Empty) returns (Empty);
  rpc GetYakScriptTagsAndType(Empty) returns (GetYakScriptTagsAndTypeResponse);
  rpc DeleteLocalPluginsByWhere(DeleteLocalPluginsByWhereRequest) returns (Empty);
  // 废弃接口
  rpc DownloadOnlinePluginByScriptNames(DownloadOnlinePluginByScriptNamesRequest) returns (DownloadOnlinePluginByScriptNamesResponse);
  // NewOnline 插件下载
  rpc DownloadOnlinePlugins(DownloadOnlinePluginsRequest) returns(stream DownloadOnlinePluginProgress);
  rpc DownloadOnlinePluginBatch(DownloadOnlinePluginsRequest) returns (Empty);
  rpc DownloadOnlinePluginByPluginName(DownloadOnlinePluginByScriptNamesRequest) returns (DownloadOnlinePluginByScriptNamesResponse);
  rpc DownloadOnlinePluginByUUID(DownloadOnlinePluginByUUIDRequest) returns (YakScript);

  // 新的扫描模式
  rpc ExecPacketScan(ExecPacketScanRequest) returns (stream ExecResult);

  rpc GetEngineDefaultProxy(Empty) returns (DefaultProxyResult);
  rpc SetEngineDefaultProxy(DefaultProxyResult) returns (Empty);

  // machine id
  rpc GetMachineID(Empty) returns (GetMachineIDResponse);

  // license
  rpc GetLicense(Empty) returns (GetLicenseResponse);
  rpc CheckLicense(CheckLicenseRequest) returns (Empty);

  // Response Body 的魔法操作
  rpc GetRequestBodyByHTTPFlowID(DownloadBodyByHTTPFlowIDRequest) returns (Bytes);
  rpc GetResponseBodyByHTTPFlowID(DownloadBodyByHTTPFlowIDRequest) returns (Bytes);
  rpc GetHTTPPacketBody(GetHTTPPacketBodyRequest) returns (Bytes);

  // 注册一个 Facades HTTP 响应
  rpc RegisterFacadesHTTP(RegisterFacadesHTTPRequest) returns (RegisterFacadesHTTPResponse);

  // 重置到恢复出厂设置
  rpc ResetAndInvalidUserData(ResetAndInvalidUserDataRequest) returns (Empty);

  // Yaklang Shell
  // 创建一个交互式 Shell
  rpc CreateYaklangShell(stream YaklangShellRequest) returns (stream YaklangShellResponse);

  // 接入标准输出和标准错误流
  rpc AttachCombinedOutput(AttachCombinedOutputRequest) returns (stream ExecResult);

  // 判断当前引擎对网卡是否有操作权限？
  // 主要是能否发包等敏感操作
  // Windows 判断是否是管理员即可 I Am Admin
  // Linux 和 MacOS 应该尝试 pcap 打开网卡就行
  rpc IsPrivilegedForNetRaw(Empty) returns (IsPrivilegedForNetRawResponse);
  rpc PromotePermissionForUserPcap(Empty) returns (Empty);

  // 操作项目的相关接口，通过设置 ProjectDatabase
  rpc SetCurrentProject(SetCurrentProjectRequest) returns (Empty);
  rpc GetCurrentProject(Empty) returns (ProjectDescription);
  rpc GetProjects(GetProjectsRequest) returns (GetProjectsResponse);
  rpc NewProject(NewProjectRequest) returns (NewProjectResponse);
  rpc UpdateProject(NewProjectRequest) returns(NewProjectResponse);
  rpc IsProjectNameValid(IsProjectNameValidRequest) returns (Empty);
  rpc RemoveProject(RemoveProjectRequest) returns (Empty);

  rpc DeleteProject(DeleteProjectRequest) returns (Empty);
  rpc GetDefaultProject(Empty) returns (ProjectDescription);
  rpc QueryProjectDetail(QueryProjectDetailRequest) returns (ProjectDescription);
  rpc GetTemporaryProject(Empty) returns (ProjectDescription);

  // 导入导出项目，带密码，带进度
  rpc ExportProject(ExportProjectRequest) returns (stream ProjectIOProgress);
  rpc ImportProject(ImportProjectRequest) returns (stream ProjectIOProgress);
  // 迁移旧数据库
  rpc MigrateLegacyDatabase(Empty) returns (Empty);

  // 从规则中提取数据
  rpc QueryMITMRuleExtractedData(QueryMITMRuleExtractedDataRequest) returns (QueryMITMRuleExtractedDataResponse);

  /*
    ChaosMakerRule: Bas
  */
  rpc ImportChaosMakerRules(ImportChaosMakerRulesRequest) returns (Empty);
  rpc QueryChaosMakerRule(QueryChaosMakerRuleRequest) returns (QueryChaosMakerRuleResponse);
  rpc DeleteChaosMakerRuleByID(DeleteChaosMakerRuleByIDRequest) returns (Empty);
  rpc ExecuteChaosMakerRule(ExecuteChaosMakerRuleRequest) returns (stream ExecResult);

  // 这个接口是判断 BAS Agent 远程端口是否可用的，使用 Vulinbox ws agent 协议连接
  // ConnectVulinboxAgent is the same as IsRemoteAddrAvailable
  rpc IsRemoteAddrAvailable(IsRemoteAddrAvailableRequest) returns (IsRemoteAddrAvailableResponse);
  rpc ConnectVulinboxAgent(IsRemoteAddrAvailableRequest) returns (IsRemoteAddrAvailableResponse);

  // vulinbox agent 的操作接口
  rpc GetRegisteredVulinboxAgent(GetRegisteredAgentRequest) returns (GetRegisteredAgentResponse);
  rpc DisconnectVulinboxAgent(DisconnectVulinboxAgentRequest) returns (Empty);

  // CVE
  rpc IsCVEDatabaseReady(IsCVEDatabaseReadyRequest) returns (IsCVEDatabaseReadyResponse);
  rpc UpdateCVEDatabase(UpdateCVEDatabaseRequest) returns (stream ExecResult);
  rpc ExportsProfileDatabase(ExportsProfileDatabaseRequest) returns (stream ExecResult);
  rpc ImportsProfileDatabase(ImportsProfileDatabaseRequest) returns (stream ExecResult);

  rpc QueryCVE(QueryCVERequest) returns (QueryCVEResponse);
  rpc GetCVE(GetCVERequest) returns (CVEDetailEx);
  rpc SaveTextToTemporalFile(SaveTextToTemporalFileRequest) returns (SaveTextToTemporalFileResponse);

  // Screcorder
  rpc IsScrecorderReady(IsScrecorderReadyRequest) returns (IsScrecorderReadyResponse);
  rpc InstallScrecorder(InstallScrecorderRequest) returns (stream ExecResult);
  rpc StartScrecorder(StartScrecorderRequest) returns (stream ExecResult);
  rpc QueryScreenRecorders(QueryScreenRecorderRequest) returns (QueryScreenRecorderResponse);
  rpc DeleteScreenRecorders(QueryScreenRecorderRequest) returns (Empty);
  rpc UploadScreenRecorders(UploadScreenRecorderRequest) returns (Empty);
  rpc GetOneScreenRecorders(GetOneScreenRecorderRequest) returns (ScreenRecorder);
  rpc UpdateScreenRecorders(UpdateScreenRecorderRequest) returns (Empty);

  // Vulinbox
  rpc IsVulinboxReady(IsVulinboxReadyRequest) returns (IsVulinboxReadyResponse);
  rpc InstallVulinbox(InstallVulinboxRequest) returns (stream ExecResult);
  rpc StartVulinbox(StartVulinboxRequest) returns (stream ExecResult);
  rpc GenQualityInspectionReport(GenQualityInspectionReportRequest) returns (stream ExecResult);

  // 通过他可以构造一个 HTTP 请求
  // 这个请求可能是一个，也可能是一系列
  // 一般用来调试插件等
  rpc HTTPRequestBuilder(HTTPRequestBuilderParams) returns (HTTPRequestBuilderResponse);
  // rpc QueryHTTPRequestBuilder(QueryHTTPRequestBuilderRequest) returns (QueryHTTPRequestBuilderResponse);
  // rpc DeleteHTTPRequestBuilder(DeleteHTTPRequestBuilderRequest) returns (Empty);
  rpc DebugPlugin(DebugPluginRequest) returns (stream ExecResult);
  rpc SmokingEvaluatePlugin(SmokingEvaluatePluginRequest) returns (SmokingEvaluatePluginResponse);
  rpc SmokingEvaluatePluginBatch(SmokingEvaluatePluginBatchRequest) returns (stream SmokingEvaluatePluginBatchResponse);
  rpc GetSystemDefaultDnsServers(Empty) returns (DefaultDnsServerResponse);

  // 诊断网络发生的问题
  rpc DiagnoseNetwork(DiagnoseNetworkRequest) returns (stream DiagnoseNetworkResponse);
  rpc DiagnoseNetworkDNS(DiagnoseNetworkDNSRequest) returns (stream DiagnoseNetworkResponse);
  rpc TraceRoute(TraceRouteRequest) returns (stream TraceRouteResponse);

  // Global Network Config
  rpc GetGlobalNetworkConfig(GetGlobalNetworkConfigRequest) returns (GlobalNetworkConfig);
  rpc SetGlobalNetworkConfig(GlobalNetworkConfig) returns (Empty);
  rpc ResetGlobalNetworkConfig(ResetGlobalNetworkConfigRequest) returns (Empty);
  rpc ValidP12PassWord(ValidP12PassWordRequest) returns (ValidP12PassWordResponse);

  // YAKURL
  rpc RequestYakURL(RequestYakURLParams) returns (RequestYakURLResponse);

  // 文件IO
  rpc ReadFile(ReadFileRequest) returns (stream ReadFileResponse);

  // Wireshark
  rpc GetPcapMetadata(PcapMetadataRequest) returns (PcapMetadata);
  rpc PcapX(stream PcapXRequest) returns (stream PcapXResponse);
  rpc QueryTrafficSession(QueryTrafficSessionRequest) returns (QueryTrafficSessionResponse);
  rpc QueryTrafficPacket(QueryTrafficPacketRequest) returns (QueryTrafficPacketResponse);
  rpc QueryTrafficTCPReassembled(QueryTrafficTCPReassembledRequest) returns (QueryTrafficTCPReassembledResponse);
  rpc ParseTraffic(ParseTrafficRequest) returns (ParseTrafficResponse);

  // 与前端交互的双工长连接，用于通知某些消息
  rpc DuplexConnection(stream DuplexConnectionRequest) returns (stream DuplexConnectionResponse);


  // 混合批量扫描
  rpc HybridScan(stream HybridScanRequest) returns (stream HybridScanResponse);
  rpc QueryHybridScanTask(QueryHybridScanTaskRequest) returns (QueryHybridScanTaskResponse);
  rpc DeleteHybridScanTask(DeleteHybridScanTaskRequest) returns (Empty);

  rpc GetSpaceEngineStatus(GetSpaceEngineStatusRequest) returns(SpaceEngineStatus);
  // 由于第三方应用配置改为从后端动态的获取表单字段名，所以弃用此接口改用GetSpaceEngineAccountStatusV2
  rpc GetSpaceEngineAccountStatus(GetSpaceEngineAccountStatusRequest) returns(SpaceEngineStatus);
  rpc GetSpaceEngineAccountStatusV2(ThirdPartyApplicationConfig) returns(SpaceEngineStatus);
  rpc FetchPortAssetFromSpaceEngine(FetchPortAssetFromSpaceEngineRequest) returns (stream ExecResult);

  // 表达式执行
  rpc EvaluateExpression(EvaluateExpressionRequest) returns (EvaluateExpressionResponse);
  rpc EvaluateMultiExpression(EvaluateMultiExpressionRequest) returns (EvaluateMultiExpressionResponse);

  // 第三方应用配置模板
  rpc GetThirdPartyAppConfigTemplate(Empty) returns (GetThirdPartyAppConfigTemplateResponse);

  // AI相关
  rpc CheckHahValidAiConfig(Empty) returns (GeneralResponse);

  // 指纹库
  rpc GetFingerprint(GetFingerprintRequest) returns (GetFingerprintResponse);
  rpc AddFingerprint(AddFingerprintRequest) returns (AddFingerprintResponse);
  rpc ModifyFingerprint(ModifyFingerprintRequest) returns (ModifyFingerprintResponse);

  // 反弹shell命令生成
  rpc GetReverseShellProgramList(GetReverseShellProgramListRequest) returns (GetReverseShellProgramListResponse);
  rpc GenerateReverseShellCommand(GenerateReverseShellCommandRequest) returns (GenerateReverseShellCommandResponse);
}
message GetSpaceEngineAccountStatusRequest {
  string Type = 1;
  string Key = 2;
  string Account = 3;
  string Domain = 4;
}

message GetSpaceEngineStatusRequest {
  string Type = 1;
}

message SpaceEngineStatus {
  string Type = 1;
  string Status = 2;
  string Info = 3;
  bytes Raw = 4;
  int64 Used = 5;
  int64 Remain = 6;
}

message FetchPortAssetFromSpaceEngineRequest {
  // zoomeye / hunter / fofa
  string Type = 1;
  string Filter = 2;
  int64 MaxPage = 3;
  int64 MaxRecord = 4;
  // page limit
  int64 PageSize = 5;
  bool ScanBeforeSave = 6;
  string Proxy = 7;
  int64 Concurrent = 8;
}

message DeleteHybridScanTaskRequest {
  string TaskId = 1;
  bool DeleteAll = 2;
  HybridScanTaskFilter Filter = 3;
}

message HybridScanTask {
  int64 Id = 1;
  int64 CreatedAt = 2;
  int64 UpdatedAt = 3;
  string TaskId = 4;
  string Status = 5; // executing / paused / done
  // exec status
  int64 TotalTargets = 6;
  int64 TotalPlugins = 7;
  int64 TotalTasks = 8;
  int64 FinishedTasks = 9;
  int64 FinishedTargets = 10;
  string FirstTarget = 11;
  string Reason = 12;
}

message QueryHybridScanTaskResponse {
  Paging Pagination = 1;
  repeated HybridScanTask Data = 2;
  int64 Total = 3;
}

message QueryHybridScanTaskRequest {
  Paging Pagination = 1;
  int64 FromId = 2;
  int64 UntilId = 3;
  string Status = 4;
  HybridScanTaskFilter Filter = 5;
}

message HybridScanTaskFilter {
  repeated string TaskId = 1;
  repeated string Status = 2;
  string Target = 3;
  int64 FromId = 4;
  int64  UntilId = 5;
  repeated string HybridScanTaskSource = 6;
}

message HybridScanResponse {
  // 计算整体任务进度等信息
  int64 TotalTargets = 1;
  int64 TotalPlugins = 2;
  int64 TotalTasks = 3;
  int64 FinishedTasks = 4;
  int64 FinishedTargets = 5;
  int64 ActiveTasks = 6;
  int64 ActiveTargets = 7;

  // 混合扫描任务ID，一般用来恢复任务或者暂停任务
  string HybridScanTaskId = 8;

  string CurrentPluginName = 9;

  ExecResult ExecResult = 10;

  // 这字段表示的是，正在执行的任务可以展示出来
  HybridScanUpdateActiveTaskTable UpdateActiveTask = 11;

  // 任务配置  废弃 使用 HybridScanConfig
  string ScanConfig = 12; // json序列化会有base64

  // 任务状态
  string Status = 13;

  // task config
  HybridScanRequest HybridScanConfig = 14;
}

message HybridScanUpdateActiveTaskTable {
  // create: 这个任务正在执行，推入栈中
  // remove: 这个任务执行完毕，弹出栈
  string Operator = 1;

  string Index = 2;
  bool IsHttps = 3;
  bytes HTTPRequest = 4;
  string Url = 6;
  string PluginName = 5;
}

// 输入目标，可以通过 input/file + template 构建可能带认证或其他内容的模版
message HybridScanInputTarget {
  string Input = 1;
  repeated string InputFile = 2;
  HTTPRequestBuilderParams HTTPRequestTemplate = 3;
}

// 输入插件：幂等的，相同的参数，结果是一致的，这样通过记录索引就能恢复进度
message HybridScanPluginConfig {
  repeated string PluginNames = 1;
  QueryYakScriptRequest Filter = 2;
}

message HybridScanRequest {
  // 控制帧字段
  bool Control = 9;
  // new: 新任务
  // resume: 恢复任务
  // pause: 暂停任务
  // stop: 停止任务
  // status: 查询任务状态
  string HybridScanMode = 8;
  string ResumeTaskId = 1;

  // 其他参数
  int64 Concurrent = 2;
  float TotalTimeoutSecond = 3;
  string Proxy = 4;
  float SingleTimeoutSecond = 5;
  bool Detach = 10; // 背后执行，就算进程结束了，也会执行，不太关心 context

  // 新任务
  HybridScanPluginConfig Plugin = 6;
  HybridScanInputTarget Targets = 7;

  // hybridScanTaskSource
  string HybridScanTaskSource = 11;
}

message DuplexConnectionRequest {
  bytes Data = 1;
  string MessageType = 2;
  int64 Timestamp = 3;
}

message DuplexConnectionResponse {
  bytes Data = 1;
  string MessageType = 2;
  int64 Timestamp = 3;
}

message PcapMetadataRequest {

}

message PcapMetadata {
  repeated NetInterface AvailablePcapDevices = 1;
  repeated KVPair AvailableSessionTypes = 2;
  repeated KVPair AvailableLinkLayerTypes = 3;
  repeated KVPair AvailableNetworkLayerTypes = 4;
  repeated KVPair AvailableTransportLayerTypes = 5;

  // AutoDetect Public Net If
  NetInterface DefaultPublicNetInterface = 6;
}

message QueryTrafficPacketRequest {
  Paging Pagination = 1;

  int64 TimestampNow = 2;
  string SessionId = 3;
  string LinkLayerTypes = 4;
  string NetworkLayerTypes = 5;
  string TransportLayerTypes = 6;
  string ApplicationLayerTypes = 7;
  string SrcIP = 8;
  string DstIP = 9;
  string SrcPort = 10;
  string DstPort = 11;

  int64 FromId = 12;
}

message QueryTrafficTCPReassembledRequest {
  Paging Pagination = 1;

  bool FromNow = 2; // ignore it
  string SessionId = 3;

  int64 FromId = 4;
  int64 UntilId = 5;
  int64 TimestampNow = 6;
}

message TrafficSession {
  int64 Id = 1;

  string SessionType = 2;
  string Uuid = 3;
  string DeviceName = 4;
  string DeviceType = 5;

  bool IsLinkLayerEthernet = 6;
  string LinkLayerSrc = 7;
  string LinkLayerDst = 8;

  bool IsIpv4 = 9;
  bool IsIpv6 = 10;
  string NetworkSrcIP = 11;
  string NetworkDstIP = 12;

  bool IsTcpIpStack = 13;
  int64 TransportLayerSrcPort = 14;
  int64 TransportLayerDstPort = 15;

  bool IsTCPReassembled = 16;
  bool IsHalfOpen = 17;
  bool IsClosed = 18;
  bool IsForceClosed = 19;

  bool HaveClientHello = 20;
  string SNI = 21;
}

message QueryTrafficSessionResponse {
  repeated TrafficSession Data = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message TrafficPacket {
  string LinkLayerType = 1;
  string NetworkLayerType = 2;
  string TransportLayerType = 3;
  string ApplicationLayerType = 4;
  bytes Payload = 5;
  bytes Raw = 6;

  string EthernetEndpointHardwareAddrSrc = 7;
  string EthernetEndpointHardwareAddrDst = 8;
  bool IsIpv4 = 9;
  bool IsIpv6 = 10;
  string NetworkEndpointIPSrc = 11;
  string NetworkEndpointIPDst = 12;
  int64 TransportEndpointPortSrc = 13;
  int64 TransportEndpointPortDst = 14;

  string SessionId = 15;
  int64 Id = 16;
  string Protocol = 17;
  string Info = 18;
}

message QueryTrafficPacketResponse {
  repeated TrafficPacket Data = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message TrafficTCPReassembled {
  int64 Id = 1;
  string SessionUuid = 2;
  bytes Raw = 3;
  int64 Seq = 4;
  int64 Timestamp = 5;
  string Source = 6;
  string Destination = 7;
  string Protocol = 8;
}

message QueryTrafficTCPReassembledResponse {
  repeated TrafficTCPReassembled Data = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message QueryTrafficSessionRequest {
  Paging Pagination = 1;

  // active traffic
  bool FromNow = 2; // ignore it, bad field

  int64 FromId = 3;
  int64 UntilId = 4;
  int64 TimestampNow = 5;
}

message PcapXRequest {
  // first request
  repeated string NetInterfaceList = 1;
  double TimeoutFloat = 2;
  SuricataConfig SuricataLoader = 3;
}

message SuricataConfig {

}

message PcapXResponse {
  int64 PacketFrameCounter = 1;
  int64 NetInterfaceTransferKBPerSeconds = 2;
  int64 TCPReassembledCount = 3;
  int64 TrafficSessionCount = 4;
}




message RequestYakURLParams {

  // files:
  // GET: means fetch details
  // POST: means update
  // PUT: means create
  // DELETE: means delete
  // HEAD: means check
  string Method = 1;

  YakURL Url = 2;

  bytes Body = 3; // 用于存储文件的内容
  int64 Page = 4;

  int64 PageSize = 5;

}

message YakURL {
  // YakURL is abstract general fs loader system
  // URL means schema://user:pass@location(:port)/path?query
  string FromRaw = 1;
  // means: file/webshell-.../directory
  string Schema = 2;
  string User = 3;
  string Pass = 4;
  string Location = 5;
  string Path = 6;
  repeated KVPair Query = 7;
}

message YakURLResource {
  // file / bytes
  string ResourceType = 1;
  string VerboseType = 2;

  // path filename
  string ResourceName = 3;
  string VerboseName = 4;

  int64 Size = 5;
  string SizeVerbose = 6;

  // Modified
  int64 ModifiedTimestamp = 8;

  // General URL
  string Path = 9;
  string YakURLVerbose = 10;
  YakURL Url = 11;

  repeated KVPair Extra = 12;

  bool HaveChildrenNodes = 13;
}

message RequestYakURLResponse {
  int64 Page = 1;
  int64 PageSize = 2;
  int64 Total = 3;
  repeated YakURLResource Resources = 4;
}

message PacketPrettifyHelperRequest {
  bytes Packet = 1;

  // SetReplaceBody: replace body for prettier
  bool SetReplaceBody = 2;
  bytes Body = 3;
}

message PacketPrettifyHelperResponse {
  // 处理后的 Packet
  bytes Packet = 1;
  string ContentType = 2;
  bool IsImage = 3;
  bytes ImageHtmlTag = 4;
  bytes Body = 5;
}

message DiagnoseNetworkDNSRequest {
  string Domain = 1;
}

message ResetGlobalNetworkConfigRequest {

}

message GetGlobalNetworkConfigRequest {

}

message ValidP12PassWordRequest {
  bytes Pkcs12Bytes = 1;
  bytes Pkcs12Password = 2;
}

message ValidP12PassWordResponse {
  bool IsSetPassWord = 1;
}

message GlobalNetworkConfig {
  // Config DNS
  bool DisableSystemDNS = 1;
  repeated string CustomDNSServers = 2;
  bool DNSFallbackTCP = 3;
  bool DNSFallbackDoH = 4;
  repeated string CustomDoHServers = 5;

  // certificates
  repeated Certificate ClientCertificates = 6;

  // network
  repeated string DisallowIPAddress = 7;
  repeated string DisallowDomain = 8;

  // default proxy
  repeated string GlobalProxy = 9;
  bool EnableSystemProxyFromEnv = 10;

  // default skip save HTTPFlow
  bool SkipSaveHTTPFlow = 11;

  // 第三方APIKey获取
  repeated ThirdPartyApplicationConfig AppConfigs = 12;

  // http auth info
  repeated AuthInfo AuthInfos = 13;

  // syn扫描选择的网卡
  string SynScanNetInterface = 14;

  repeated string ExcludePluginScanURIs = 15;
  repeated string IncludePluginScanURIs = 16;

  // AI Primary Config 首选 AI 配置项
  // openai / chatglm
  string PrimaryAIType = 17;

  repeated string AiApiPriority = 18;

  // 开启数据库同步存储
  bool DbSaveSync = 19;
}

message AuthInfo {
  string AuthUsername = 1;
  string AuthPassword = 2;
  string AuthType = 3;
  string Host = 4;
  bool Forbidden = 5;
}

message ThirdPartyApplicationConfig {
  // zoomeye / hunter / shodan / fofa / github / openai / token
  string Type = 1;
  string APIKey = 2;
  string UserIdentifier = 3;
  string UserSecret = 4;
  string Namespace = 5;
  string Domain = 6;
  string WebhookURL = 7;
  repeated KVPair ExtraParams = 8;
}

message DiagnoseNetworkRequest {
  double NetworkTimeout = 1;

  // 想要连接或扫描的目标是否都可达？
  // 网络是否可达？网管是什么
  // 如果是一个主机的话，他的 TCP 是否开放？
  // 如果包含域名的话，他的解析结果是什么？不存在？还是本地解析？
  // 多个服务器解析到同一个 IP？
  string ConnectTarget = 2;

  // 代理是否配置正确？
  string Proxy = 3;
  string ProxyAuthUsername = 4;
  string ProxyAuthPassword = 5;
  string ProxyToAddr = 8;

  string Domain = 6;
  repeated string DNSServers = 7;
}

message DiagnoseNetworkResponse {
  string Title = 1;
  string DiagnoseType = 2;
  string DiagnoseResult = 3;
  // info/verbose
  // warning
  string LogLevel = 5;
}

message DisconnectVulinboxAgentRequest {
  string Addr = 1;
}

message GetRegisteredAgentRequest {

}

message GetRegisteredAgentResponse {
  repeated IsRemoteAddrAvailableResponse Agents = 1;
}

message SmokingEvaluatePluginRequest {
  repeated HTTPRequestBuilderParams Requests = 1;

  // 只支持插件名评估
  string PluginName = 2;

  string Code = 3;
  string PluginType = 4;
}

message SmokingEvaluateResult {
  string Item = 1;
  string Suggestion = 2;
  bytes ExtraInfo = 3;
  Range Range = 4;
  string Severity = 5; // Error || Warning
}

message SmokingEvaluatePluginResponse {
  int64 Score = 1;
  repeated SmokingEvaluateResult Results = 2;
}

message IsVulinboxReadyRequest {

}

message IsVulinboxReadyResponse {
  bool Ok = 1;
  string Reason = 2;
}

message InstallVulinboxRequest {
  string Proxy = 1;
}

message StartVulinboxRequest {
  // 默认应该是 127.0.0.1
  string Host = 1;
  // 默认应该是 8787
  string Port = 2;
  // 不启用 HTTPS
  bool NoHttps = 3;
  // 安全模式：不启用命令执行靶场
  bool SafeMode = 4;
}

message GenQualityInspectionReportRequest {
  repeated string ScriptNames = 1;
  string TaskName = 2;
}

message DebugPluginRequest {
  string Code = 1;
  string PluginType = 2;

  string Input = 3;
  HTTPRequestBuilderParams HTTPRequestTemplate = 4;
  repeated KVPair ExecParams = 5;
  HybridScanPluginConfig LinkPluginConfig = 6;

  // plugin name, if not empty, will use code
  string PluginName = 7;

  // runtime id ,if empty, will create a new runtime
  string RuntimeId = 8;
}

message HTTPRequestBuilderResult {
  bool IsHttps = 1;
  string Url = 2;
  bytes HTTPRequest = 3;
}

message HTTPRequestBuilderResponse {
  repeated HTTPRequestBuilderResult Results = 1;
  string Templates = 2;
}

message HTTPRequestBuilderParams {
  bool IsRawHTTPRequest = 1;
  bool IsHttps = 2;
  bytes RawHTTPRequest = 3;

  // fields
  string Method = 4;

  // path 增强型
  repeated string Path = 6;
  repeated KVPair GetParams = 9;

  repeated KVPair Headers = 7;
  repeated KVPair Cookie = 8;

  // body 增强
  bytes Body = 10;
  repeated KVPair PostParams = 11;
  repeated KVPair MultipartParams = 12;
  repeated KVPair MultipartFileParams = 13;

  bool IsHttpFlowId = 14;
  repeated int64 HTTPFlowId = 15;
}

message ScreenRecorder {
  int64 Id = 1;
  string Filename = 2;
  string NoteInfo = 3;
  string Project = 4;
  int64 CreatedAt = 5;
  int64 UpdatedAt = 6;
  string VideoName = 7;
  string Cover = 8;
  string Duration = 9;
  bool  Before = 10;
  bool After = 11;
}

message QueryScreenRecorderRequest {
  string Project = 1;
  Paging Pagination = 2;
  string Keywords = 3;
  repeated int64 Ids = 4;
}

message UploadScreenRecorderRequest{
  string Project = 1;
  string Token = 2;
  string Keywords = 3;
  repeated int64 Ids = 4;
}

message GetOneScreenRecorderRequest {
  int64 Id = 1;
  string Order = 2;
}

message UpdateScreenRecorderRequest {
  int64 Id = 1;
  string VideoName = 2;
  string NoteInfo = 3;
}

message QueryScreenRecorderResponse {
  repeated ScreenRecorder Data = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message StartScrecorderRequest {
  int64 Framerate = 1;
  string ResolutionSize = 2;
  double CoefficientPTS = 3;
  bool DisableMouse = 4;
}

message InstallScrecorderRequest {
  string Proxy = 1;
}

message IsScrecorderReadyRequest {

}

message IsScrecorderReadyResponse {
  bool Ok = 1;
  string Reason = 2;
}

message GetCVERequest {
  string CVE = 1;
}

message QueryCVERequest {
  Paging Pagination = 1;
  // NETWORK/LOCAL/ADJACENT_NETWORK/PHYSICAL
  string AccessVector = 2;
  // HIGH/MIDDLE/LOW
  string AccessComplexity = 3;
  string CWE = 4;
  string Year = 5;
  string Severity = 6;
  double Score = 7;
  string Product = 8;

  // by published_date
  string AfterYear = 9;
  bool ChineseTranslationFirst = 10;
  string Keywords = 11;
}

message CWEDetail {
  string CWE = 1;
  string Name = 2;
  string NameZh = 3;
  //  repeated CWEDetail InterTo = 4;

  string Status = 5;
  bool Stable = 6;
  bool Incomplete = 7;
  string Description = 8;
  string DescriptionZh = 9;
  string LongDescription = 10;
  string LongDescriptionZh = 11;
  repeated string RelativeLanguage = 12;
  string Solution = 13;
  repeated string RelativeCVE = 14;
}

message CVEDetailEx {
  CVEDetail CVE = 1;
  repeated CWEDetail CWE = 2;
}

message CVEDetail {
  string CVE = 1;
  string DescriptionZh = 2;
  string DescriptionOrigin = 3;
  string Title = 4;
  string Solution = 5;
  string References = 6;
  string AccessVector = 7;
  string AccessComplexity = 8;
  string Authentication = 9;
  string ConfidentialityImpact = 10;
  string IntegrityImpact = 11;
  string AvailabilityImpact = 12;
  string Severity = 14;
  int64 PublishedAt = 15;
  string CWE = 16;
  string CVSSVersion = 17;
  string CVSSVectorString = 18;
  double BaseCVSSv2Score = 19;
  double ExploitabilityScore = 20;
  bool ObtainAllPrivileged = 21;
  bool ObtainUserPrivileged = 22;
  bool ObtainOtherPrivileged = 23;
  bool UserInteractionRequired = 24;
  string Product = 25;
  int64  UpdatedAt = 26;
  int64  LastModifiedData = 27;
}

message QueryCVEResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated CVEDetail Data = 3;
}

message SaveTextToTemporalFileRequest {
  bytes Text = 1;
}

message SaveTextToTemporalFileResponse {
  string FileName = 1;
}

message ImportChaosMakerRulesRequest {
  string Content = 1;
  // suricata / http-request / icmp
  string RuleType = 2;
  bool AIDecoration = 3;
  string Domain = 4;
  string Proxy = 5;
  string Key = 6;
}

message ChaosMakerRuleGroup {
  string Title = 1;
  string Description = 2;
  string Keywords = 3;
  repeated string Protocols = 4;
  string Solution = 5;
}

message IsRemoteAddrAvailableRequest {
  string Addr = 1;
  int64 Timeout = 2;
  string Probe = 3;
}

message IsRemoteAddrAvailableResponse {
  string Addr = 1;
  bool IsAvailable = 2;
  string Reason = 3;
  string Status = 4;

  int64 PingCount = 5;
  int64 RequestCount = 6;

  int64 LastActiveAt = 7;
}

message ExecuteChaosMakerRuleRequest {
  repeated ChaosMakerRuleGroup Groups = 1;
  repeated string ExtraOverrideDestinationAddress = 2;

  // 随机延迟
  int64 Concurrent = 3;
  int32 TrafficDelayMinSeconds = 4;
  int32 TrafficDelayMaxSeconds = 5;

  // 额外重复，如果为 -1 认为是永久重复
  int64 ExtraRepeat = 6;

  // 每组流量之间重复的次数
  int64 GroupGapSeconds = 7;
}

message ChaosMakerRule {
  int64 Id = 1;
  string RawTrafficBeyondIpPacketBase64 = 2;
  string RawTrafficBeyondLinkLayerBase64 = 3;
  string RawTrafficBeyondHttpBase64 = 4;
  string RuleType = 5;
  string SuricataRaw = 6;
  string Protocol = 7;
  string Action = 8;
  string Name = 9;
  string NameZh = 10;
  string ClassType = 11;
  string ClassTypeZh = 12;
  string Group = 13;
  string Keywords = 15;
  string KeywordsZh = 16;
  string Description = 17;
  string DescriptionZh = 18;
  repeated string CVE = 19;
}

message QueryChaosMakerRuleResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated ChaosMakerRule Data = 3;
}

message DeleteChaosMakerRuleByIDRequest {
  int64 Id = 1;
}

message QueryChaosMakerRuleRequest {
  Paging Pagination = 1;
  string RuleType = 2;
  repeated string Keywords = 3;

  // offset
  int64 FromId = 4;
  int64 UntilId = 5;
}

message ImportsProfileDatabaseRequest {
  string LocalProfileFile = 1;
}

message ExportsProfileDatabaseRequest {
  string LocalProfileFile = 1;
}

message UpdateCVEDatabaseRequest {
  string Proxy = 1;
  bool JustUpdateLatestCVE = 2;
}

message IsCVEDatabaseReadyResponse {
  bool Ok = 1;
  string Reason = 2;
  bool ShouldUpdate = 3;
}

message IsCVEDatabaseReadyRequest {

}

message MITMRuleExtractedData {
  int64 Id = 1;
  int64 CreatedAt = 2;
  string SourceType = 3;
  string TraceId = 4;
  string Regexp = 5;
  string RuleName = 6;
  string Data = 7;
  int64 Index = 8;
  int64 Length = 9;
  bool IsMatchRequest = 10;
}

message QueryMITMRuleExtractedDataResponse {
  repeated MITMRuleExtractedData Data = 1;
  int64 Total = 2;
  Paging Pagination = 3;
}

message QueryMITMRuleExtractedDataRequest {
  Paging Pagination = 1;
  string HTTPFlowHash = 2;
}

message ExportProjectRequest {
  string ProjectName = 1;
  string Password = 2;
  int64 Id = 3;
}

message ProjectIOProgress {
  string TargetPath = 1;

  // 如果未完成，这个是百分比 0-1.0
  double Percent = 2;

  // 展示的提示语，可能是中断原因或者错误原因之类的
  string Verbose = 4;
}

message ImportProjectRequest {
  string LocalProjectName = 1;
  string ProjectFilePath = 2;
  string Password = 3;
  int64 FolderId = 4;
  int64 ChildFolderId = 5;
}

message IsPrivilegedForNetRawResponse {
  bool IsPrivileged = 1;
  string Advice = 2;
  string AdviceVerbose = 3;
}

message RemoveProjectRequest {
  string ProjectName = 1;
}

message IsProjectNameValidRequest {
  string ProjectName = 1;
  int64 FolderId = 2;
  int64 ChildFolderId = 3;
  string Type = 4;
}

message NewProjectRequest {
  string ProjectName = 1;
  string Description = 2;
  int64 FolderId = 3;
  int64 ChildFolderId = 4;
  string Type = 5;
  int64  Id = 6;
}

message NewProjectResponse {
  int64 Id = 1;
  string ProjectName = 2;
}

message GetProjectsRequest {
  string ProjectName = 1;
  string Description = 2;
  Paging Pagination = 3;
  int64 FolderId = 4;
  int64 ChildFolderId = 5;
  string Type = 6;
}

message ProjectDescription {
  string ProjectName = 1;
  string Description = 2;

  int64 Id = 3;
  string DatabasePath = 4;

  // 创建时间
  int64 CreatedAt = 5;

  int64 FolderId = 6;
  int64 ChildFolderId = 7;
  string Type = 8;
  int64 UpdateAt = 9;
  string FolderName = 10;
  string ChildFolderName = 11;
  string FileSize = 12;
}

message GetProjectsResponse {
  repeated ProjectDescription Projects = 1;
  Paging Pagination = 2;
  int64 Total = 3;
  int64 TotalPage = 4;
  int64 ProjectToTal = 9;
}

message SetCurrentProjectRequest {
  // ProjectName
  string ProjectName = 1;
  int64 Id = 2;
}

message DeleteProjectRequest {
  int64 Id = 1;
  bool IsDeleteLocal = 2;
}

message QueryProjectDetailRequest {
  int64 Id = 1;
}


message AttachCombinedOutputRequest {

}

message YaklangShellRequest {
  string Input = 1;
}

message YaklangShellKVPair {
  string Key = 1;
  bytes Value = 2;
  string ValueVerbose = 3;
  int64 SymbolId = 4;
}

message YaklangShellResponse {
  ExecResult RawResult = 1;
  repeated YaklangShellKVPair Scope = 2;
}

message ResetAndInvalidUserDataRequest {

}

message RegisterFacadesHTTPRequest {
  // 这个优先级比较高，如果有这个的话，他的响应应该像是
  // /_yakit/history/<id>
  int64 HTTPFlowID = 1;

  // 散装 HTTPFlow
  bytes HTTPResponse = 2;
  string Url = 3;
}

message RegisterFacadesHTTPResponse {
  // http(s)://localhost:<facadesport>/...
  string FacadesUrl = 1;
}

message GetHTTPPacketBodyRequest {
  string Packet = 1;
  bytes PacketRaw = 2;
}

message DownloadBodyByHTTPFlowIDRequest {
  int64 Id = 1;
}

message Bytes {
  bytes Raw = 1;
}

message ExtractDataResponse {
  string Token = 1;
  bytes Extracted = 2;
}

message SaveFuzzerLabelRequest {
  repeated FuzzerLabel Data = 1;
}

message QueryFuzzerLabelResponse {
  repeated FuzzerLabel Data = 1;
}

message FuzzerLabel {
  int64 Id = 1;
  string Label = 2;
  string Description = 3;
  string DefaultDescription = 4;
  string Hash = 5;
}

message DeleteFuzzerLabelRequest {
  string Hash = 1;
}

message ExtractDataRequest {
  bytes Data = 1;

  // regexp mode -> regexp between 模式
  string Mode = 2;

  // 根据前后缀提取
  string PrefixRegexp = 3;
  string SuffixRegexp = 4;

  // 根据一个正则提取
  string MatchRegexp = 5;

  // Token 用来标注这个数据是谁的，一般可以用来处理提取的数据
  string Token = 6;

  // 如果不再有数据了，设置这个 flag
  bool End = 7;
}

message GenerateExtractRuleRequest {
  // 要提取规则的样例数据
  bytes Data = 1 ;
  // 选择的文本
  bytes Selected = 2;
  // 选择前后缀的偏移量
  int64 OffsetSize = 3;
}

message GenerateExtractRuleResponse {
  string PrefixRegexp = 1;
  string SuffixRegexp = 2;
  string SelectedRegexp = 3;
}

message GetMachineIDResponse {
  string MachineID = 1;
}

message QueryHTTPFuzzerResponseByTaskIdRequest {
  // 用来索引对应的请求
  int64 TaskId = 1;
  string FuzzRequestToken = 2;

  // 上一个请求的时间戳
  int64 LastResponseTimestamp = 3;

  Paging Pagination = 4;
}

message QueryHTTPFuzzerResponseByTaskIdResponse {
  Paging Pagination = 1;
  repeated FuzzerResponse Data = 2;
  int64 Total = 3;
  int64 TotalPage = 4;
}

message QueryWebsocketFlowByHTTPFlowWebsocketHashRequest {
  string WebsocketRequestHash = 1;
  Paging Pagination = 2;
}

message DeleteWebsocketFlowByHTTPFlowWebsocketHashRequest {
  string WebsocketRequestHash = 1;
}

message ClientWebsocketRequest {
  bool IsTLS = 1;
  bytes UpgradeRequest = 2;

  // 要发送到服务器的请求
  bytes ToServer = 3;
  repeated string Encode = 4;

  // 是否允许 fuzz 标签渲染，然后发送
  bool AllowToFuzz = 5;
  int64 TotalTimeoutSeconds = 6;

  string Proxy = 7;
}

message ClientWebsocketResponse {
  // 切换协议是否成功
  bool SwitchProtocolSucceeded = 2;

  // 是 Websocket 数据帧吗？
  bool IsDataFrame = 1;
  // 服务器端返回还是？
  bool FromServer = 4;
  // 编码是啥样的？
  repeated string GuessEncode = 5;

  // 其他状态，以及出现问题的原因
  string StatusVerbose = 6;
  string ReasonVerbose = 7;

  // DataLength
  int64 DataLength = 8;
  bytes Data = 9;

  bool IsJson = 10;
  bool IsProtobuf = 11;

  int64 DataFrameIndex = 12;
  string WebsocketHash = 13;

  // 设置大小
  string DataSizeVerbose = 14;
  string DataVerbose = 15;

  // 升级
  bool IsUpgradeResponse = 16;
  bytes UpgradeResponse = 17;
}

message DefaultProxyResult {
  string Proxy = 1;
}

message ExecPacketScanRequest {
  // 选择 HTTPFlow 进行扫描
  repeated int64 HTTPFlow = 1;
  bytes HTTPRequest = 2;
  bool HTTPS = 3;

  // 允许数据包的 Fuzz 打开
  bool AllowFuzzTag = 5;

  // 扫描进程总超时
  int64 TotalTimeoutSeconds = 6;
  // 默认发包的 Timeout
  int64 Timeout = 7;

  // 并发
  int64 PluginConcurrent = 8;
  int64 PacketConcurrent = 9;

  // 插件列表
  repeated string PluginList = 10;

  // 设置代理
  string Proxy = 11;
}

message Range {
  string Code = 1;
  int64 StartLine = 2;
  int64 StartColumn = 3;
  int64 EndLine = 4;
  int64 EndColumn = 5;
}

message YaklangInspectInformationRequest {
  string YakScriptType = 1;
  string YakScriptCode = 2;
  Range Range = 3;
}

message YaklangLanguageSuggestionRequest {
  string InspectType = 1;// completion(补全) / hover(提示) / signature(签名) / definition(找定义) / reference(找引用)

  // {
  // from source code : support all InspectType
  string YakScriptType = 2;
  string YakScriptCode = 3;
  // }

  Range Range = 4; // selected range 
  string ModelID = 5; // monaco model id 

  // {
  // from database : support getReference 
  // if set this progranName will use this from database 
  string ProgramName = 6; 
  string FileName = 7;
  // } 
}


// message RiskInfo {
//   string Type = 1;
//   string TypeVerbose = 3;
//   string Level = 2;
//   string Cve = 4;
// }


message YaklangInformationKV {
  string Key = 1;
  bytes Value = 2;
  repeated YaklangInformationKV Extern = 3;
}

message YaklangInformation {
  string Name = 1;
  repeated YaklangInformationKV Data = 2;
}

message YaklangLanguageSuggestionResponse {
  repeated SuggestionDescription SuggestionMessage = 1;
}

message YaklangLanguageFindResponse {
  string URI = 1;
  repeated Range Ranges = 2;
}

message YaklangInspectInformationResponse {
  repeated YaklangInformation Information = 1;
  repeated YakScriptParam CliParameter = 2;
  repeated YakRiskInfo RiskInfo = 3;
  repeated YakUIInfo UIInfo = 4;
  repeated string Tags = 5;
}

message YakUIInfo {
  string Typ = 1;
  repeated string Effected = 2;
  string WhenExpression = 3;
}

message YakRiskInfo {
  string Level = 1;
  string TypeVerbose = 2;
  string CVE = 3;
  string Description = 4;
  string Solution = 5;
}


message YaklangGetCliCodeFromDatabaseResponse {
  string Code = 1;
  bool NeedHandle = 2;
}

message YaklangGetCliCodeFromDatabaseRequest {
  string ScriptName = 1;

}

message StaticAnalyzeErrorRequest {
  bytes Code = 1;
  string PluginType = 2;
}

message YaklangCompileAndFormatRequest {
  string Code = 1;
}


message YaklangCompileAndFormatResponse {
  string Code = 1;
  repeated StaticAnalyzeErrorResult Errors = 2;
}

message StaticAnalyzeErrorResult {
  bytes Message = 1;
  int64 StartLineNumber = 2;
  int64 EndLineNumber = 3;
  int64 StartColumn = 4;
  int64 EndColumn = 5;
  bytes RawMessage = 6;
  string Severity = 7;
  string Tag = 8;
}

message StaticAnalyzeErrorResponse {
  repeated StaticAnalyzeErrorResult Result = 1;
}

message SavePayloadProgress {
  double Progress = 1; // 进度

  int64 HandledBytes = 2;          // old
  string HandledBytesVerbose = 3;          // old
  int64 TotalBytes = 4;          // old
  string TotalBytesVerbose = 5;          // old
  double CostDuration = 6;          // old

  string CostDurationVerbose = 7; // 耗时
  string Speed = 8;// 速度
  string RestDurationVerbose = 9;// 剩余时间
  string Message = 10;
}

message DeletePluginByUserIDRequest {
  int64 UserID = 1;
  string OnlineBaseUrl = 2;
}

message DeleteLocalPluginsByWhereRequest {
  string Keywords = 1;
  string Type = 2;
  int64  UserId = 3;
  string UserName = 4;
  repeated int64 Ids = 5;
  string Tags = 6;
  repeated string Groups = 7;
}

message DownloadOnlinePluginProgress {
  // 进度
  double Progress = 1;
  string Log = 2;
}

message DownloadOnlinePluginByTokenRequest {
  string Token = 1;
  bool BindMe = 2;
  string Keywords = 3;
  string PluginType = 4;
  string Status = 5;
  string IsPrivate = 6;
  string Tags = 7;
  string UserName = 8;
  int64  UserId = 9;
  string TimeSearch = 10;
  string Group = 11;
}

message DownloadOnlinePluginByIdRequest {
  int64 OnlineID = 1;
  string Token = 2;
  string UUID = 3;
}

message DownloadOnlinePluginByIdsRequest {
  repeated int64 OnlineIDs = 1;
  string Token = 2;
  repeated string UUID = 3;
}

message DownloadOnlinePluginsRequest {
  string Token = 1;
  repeated bool IsPrivate = 2;
  string  Keywords = 3;
  repeated string PluginType = 4;
  repeated string  Tags = 5;
  string   UserName = 6;
  int64  UserId = 7;
  string TimeSearch = 8;
  repeated string Group = 9;
  string   ListType = 10;
  repeated int64 Status = 11;
  repeated string UUID = 12;
  repeated string ScriptName = 13;
}

message DownloadOnlinePluginByScriptNamesRequest {
  repeated string ScriptNames = 1;
  string Token = 2;
}

message DownloadOnlinePluginByScriptNamesResponse {
  repeated DownloadOnlinePluginByScriptName Data = 1;
}

message DownloadOnlinePluginByScriptName {
  string ScriptName = 1;
  int64 Id = 2;
  string HeadImg = 3;
}

message DownloadOnlinePluginByUUIDRequest {
  string UUID = 1;
  string Token = 2;
}

message OnlineProfile {
  string BaseUrl = 1;
  string Password = 2;
  string Proxy = 3;
  bool   IsCompany = 4;
}

message SetKeyRequest {
  string Key = 1;
  string Value = 2;
  int64 TTL = 3;
}

message GetKeyRequest {
  string Key = 1;
}

message GetKeyResult {
  string Value = 1;
}

message GeneralStorage {
  string Key = 1;
  string Value = 2;
  int64 ExpiredAt = 3;
  bool ProcessEnv = 4;
  string Verbose = 5;
  string Group = 6;
}

message GetProcessEnvKeyResult {
  repeated GeneralStorage Results = 1;
}

message SetSystemProxyRequest {
  string HttpProxy = 1;
  bool Enable = 2;
}

message GetSystemProxyResult {
  string CurrentProxy = 1;
  bool Enable = 2;
}

// --- Deprecated interface--
message GetExecBatchYakScriptUnfinishedTaskByUidRequest {
  string Uid = 1;
}

message RecoverExecBatchYakScriptUnfinishedTaskRequest {
  string Uid = 1;
}

message ExecBatchYakScriptUnfinishedTask {
  double Percent = 1;
  int64 CreatedAt = 2;
  string Uid = 3;
  string YakScriptOnlineGroup = 4;
  string TaskName = 5;
}

message SimpleDetectUnfinishedTask {
  double Percent = 1;
  int64 CreatedAt = 2;
  string Uid = 3;
  string YakScriptOnlineGroup = 4;
  string TaskName = 5;
  int64  LastRecordPtr = 6;
}

message GetExecBatchYakScriptUnfinishedTaskResponse {
  repeated ExecBatchYakScriptUnfinishedTask Tasks = 1;
}

message GetSimpleDetectUnfinishedTaskResponse {
  repeated SimpleDetectUnfinishedTask Tasks = 1;
}
// -------------------

message UnfinishedTaskFilter {
  repeated string RuntimeId = 1;
  repeated string ProgressSource = 2;
  string TaskName = 3; // support fuzzy search
  string Target = 4; // support fuzzy search
}

message QueryUnfinishedTaskRequest {// query unfinished task list ,just brief info
  Paging Pagination = 1;
  UnfinishedTaskFilter Filter = 2;
}

message DeleteUnfinishedTaskRequest {
  UnfinishedTaskFilter Filter = 1;
}

message UnfinishedTask {
  double Percent = 1;
  int64 CreatedAt = 2;
  string RuntimeId = 3;
  string YakScriptOnlineGroup = 4;
  string TaskName = 5;
  int64  LastRecordPtr = 6;
  string Target = 7;
}

message QueryUnfinishedTaskResponse {// brief information for unfinished task
  repeated UnfinishedTask Tasks = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message GetUnfinishedTaskDetailByIdRequest {// get unfinished task detail by runtime id, get task start param or last record
  string RuntimeId = 1;
}

message RecoverUnfinishedTaskRequest {// recover unfinished simple detect task by runtime id
  string RuntimeId = 1;
}

message FixUploadPacketRequest {
  bytes Request = 1;
}

message FixUploadPacketResponse {
  bytes Request = 1;
}

message IsMultipartFormDataRequestResult {
  bool IsMultipartFormData = 1;
}

message AutoDecodeRequest {
  string Data = 1;
  repeated AutoDecodeResult ModifyResult = 2;
}

message AutoDecodeResult {
  string Type = 1;
  string TypeVerbose = 2;
  bytes Origin = 3;
  bytes Result = 4;
  bool Modify = 5;
}

message AutoDecodeResponse {
  repeated AutoDecodeResult Results = 1;
}

message ExtractDataToFileResult {
  string FilePath = 1;
}

message GetYakScriptTagsResponse {
  repeated Tags Tag = 1;
}

message Tags {
  string Value = 1;
  int32 Total = 2;
}

message QueryYakScriptLocalAndUserRequest {
  string OnlineBaseUrl = 1;
  int64 UserId = 2;
}

message QueryYakScriptLocalAndUserResponse {
  repeated YakScript Data = 1;
}

message QueryYakScriptByOnlineGroupRequest {
  string OnlineGroup = 1;
}

message QueryYakScriptByNamesRequest {
  repeated string YakScriptName = 1;
}

message QueryYakScriptByIsCoreRequest {
  bool IsCorePlugin = 1;
}

message QueryYakScriptByNamesResponse {
  repeated YakScript Data = 1;
}

message QueryYakScriptByIsCoreResponse {
  repeated YakScript Data = 1;
}

message QueryYakScriptRiskDetailByCWERequest {
  string CWEId = 1;
}

message QueryYakScriptRiskDetailByCWEResponse {
  string CWEId = 1;
  string RiskType = 2;
  string Description = 3;
  string CWESolution = 4;
}

message YakScriptRiskTypeListResponse {
  repeated RiskTypeLists Data = 1;
}

message RiskTypeLists {
  string RiskType = 1;
  string CWEId = 2;
}

message ExtractDataToFileRequest {
  bool JsonOutput = 1;
  bool CSVOutput = 2;
  string DirName = 3;

  map<string, ExtractableData> Data = 4;
  string FileNamePattern = 5;

  // 当没有数据的时候，执行这个即可
  bool Finished = 6;
}

message ExtractableData {
  string StringValue = 1;
  bytes BytesValue = 2;
}

message MITMContentReplacers {
  repeated MITMContentReplacer Rules = 1;
}

message ImportMITMReplacerRulesRequest {
  bytes JsonRaw = 1;
  bool ReplaceAll = 2;
}

message ExportMITMReplacerRulesResponse {
  bytes JsonRaw = 1;
}

message ExecYakitPluginsByYakScriptFilterRequest {
  QueryYakScriptRequest Filter = 1;

  // 这个 Target 很复杂，URL / IP / CIDR / Host / Host:port
  string Target = 2;
  string Ports = 3;
  string TargetFile = 5;

  repeated ExecParamItem ExtraParams = 4;
}

message GenerateYakCodeByPacketRequest {
  bool IsHttps = 1;
  bytes Request = 2;
  enum Template {
    Ordinary = 0;
    Batch = 1;
  }
  Template CodeTemplate = 3;
}

message GenerateCSRFPocByPacketRequest {
  bool IsHttps = 1;
  bytes Request = 2;
}

message GenerateCSRFPocByPacketResponse {
  bytes Code = 1;
}

message GenerateYakCodeByPacketResponse {
  bytes Code = 1;
}

message QueryReportRequest {
  int64 Id = 1;
  string Hash = 2;
}

message DeleteReportRequest {
  int64 Id = 1;
  string Hash = 2;
  QueryReportsRequest Filter = 3;
  repeated int64 IDs = 4;
  bool DeleteAll = 5;
}

message QueryReportsResponse {
  repeated Report Data = 1;
  int64 Total = 2;
  Paging Pagination = 3;
}

message QueryReportsRequest {
  Paging Pagination = 1;
  string Owner = 2;
  string From = 3;
  string Keyword = 4;
  string Title = 5;
}

message Report {
  string Title = 1;
  uint64 PublishedAt = 2;
  string Hash = 3;
  uint64 Id = 4;
  string Owner = 5;
  string From = 6;
  string JsonRaw = 7;
}

message SetTagForHTTPFlowRequest {
  int64 Id = 1;
  string Hash = 2;
  repeated string Tags = 3;
  repeated CheckSetTagsHTTPFlow CheckTags = 4;
}

message CheckSetTagsHTTPFlow {
  int64 Id = 1;
  string Hash = 2;
  repeated string Tags = 3;
}

message RequireICMPRandomLengthResponse {
  int32 Length = 1;
  string ExternalHost = 2;
}

message RandomPortTriggerNotification {
  string RemoteAddr = 1;
  string RemoteIP = 2;
  int32 RemotePort = 3;
  int32 LocalPort = 4;
  repeated string History = 5;
  int32 CurrentRemoteCachedConnectionCount = 6;
  int32 LocalPortCachedHistoryConnectionCount = 7;
  int64 TriggerTimestamp = 8;
  int64 Timestamp = 9;
}

message QueryRandomPortTriggerRequest {
  string Token = 1;
}

message RandomPortInfo {
  string Token = 1;
  string Addr = 2;
  int32 Port = 3;
}

message DeleteHistoryHTTPFuzzerTaskRequest {
  int32 Id = 1;
  string WebFuzzerIndex = 2;
}

message RiskTableStats {
  // 最近一次更新的漏洞信息
  int64 LatestCreatedAtTimestamp = 1;

  Fields RiskTypeStats = 2;
  Fields RiskLevelStats = 3;
}

message MITMCert {
  bytes CaCerts = 1;
  string LocalFile = 2;
}

message FieldName {
  string Name = 1;
  string Verbose = 2;
  int32 Total = 3;

  // 比上一次的增量/变化量
  int32 Delta = 4;
}

message Fields {
  repeated FieldName Values = 1;
}
//获取Gadget的Options
message YsoOption{
  string Name = 1;
  string NameVerbose = 2;
  string Help = 3;
}
message YsoOptionsWithVerbose{
  repeated YsoOption Options = 1;
}
//已弃用
message YsoOptions{
  repeated string Names = 1;
}
//类生成器的参数
message YsoClassGeneraterOptionsWithVerbose{
  string Key = 1;
  string KeyVerbose = 2;
  string Help = 3;
  string Value = 4;
  string Type = 5;
  map<string, YsoClassOptionsResponseWithVerbose> BindOptions = 6;
}
message YsoClassOptionsResponseWithVerbose{
  repeated YsoClassGeneraterOptionsWithVerbose Options = 1;
}
//已弃用
message YsoClassGeneraterOptions{
  string Key = 1;
  string Value = 2;
  string Type = 3;
}
//已弃用
message YsoClassOptionsResponse{
  repeated YsoClassGeneraterOptions Options = 1;
}
//生成代码和字节码
message YsoOptionsRequerstWithVerbose{
  string Gadget = 1;
  string Class = 2;
  repeated YsoClassGeneraterOptionsWithVerbose Options = 3;
}
//已弃用
message YsoOptionsRequerst{
  string Gadget = 1;
  string Class = 2;
  repeated YsoClassGeneraterOptions Options = 3;
}
message YsoBytesObject{
  bytes Data = 1;
}
message YsoDumpResponse{
  string Data = 1;
}

message YsoCodeResponse{
  string Code = 1;
}
message YsoBytesResponse{
  string FileName = 1;
  bytes Bytes = 2;
}
message BytesToBase64Request{
  bytes Bytes = 1;
}
message BytesToBase64Response{
  string Base64 = 1;
}
message QueryICMPTriggerRequest {
  int32 Length = 1;
}

message QueryICMPTriggerResponse {
  repeated ICMPTriggerNotification Notification = 1;
}

message QuerySupportedDnsLogPlatformsResponse{
  repeated string Platforms = 1;
}

message ICMPTriggerNotification {
  int32 Size = 1;
  string CurrentRemoteAddr = 2;
  repeated string Histories = 3;
  int32 CurrentRemoteCachedConnectionCount = 4;
  int32 SizedCachedHistoryConnectionCount = 5;
  int64 TriggerTimestamp = 7;
  int64 Timestamp = 8;
}

message GetHistoryHTTPFuzzerTaskRequest {
  int32 Id = 1;
}


message HistoryHTTPFuzzerTaskDetail {
  HistoryHTTPFuzzerTask BasicInfo = 1;
  FuzzerRequest OriginRequest = 2;
}

message HistoryHTTPFuzzerTask {
  int32 Id = 1;
  int64 CreatedAt = 2;
  int32 HTTPFlowTotal = 3;
  int32 HTTPFlowSuccessCount = 4;
  int32 HTTPFlowFailedCount = 5;
  string Host = 6;
  int32  Port = 7;
}

message HistoryHTTPFuzzerTasks {
  repeated HistoryHTTPFuzzerTask Tasks = 1;
}

message HistoryHTTPFuzzerTasksResponse {
  repeated HistoryHTTPFuzzerTaskDetail Data = 1;
  int64 Total = 2;
  int64 TotalPage = 3;
  Paging Pagination = 4;
}

message QueryHistoryHTTPFuzzerTaskExParams {
  Paging Pagination = 1;
  string Keyword = 2;
  string FuzzerTabIndex = 3;
}

message ExecutePacketYakScriptParams {
  string ScriptName = 1;
  bool IsHttps = 2;
  bytes Request = 3;
  bytes Response = 4;
}

message ExecuteBatchPacketYakScriptParams {
  repeated string ScriptName = 1;
  bool IsHttps = 2;
  bytes Request = 3;
  bytes Response = 4;

  // 并发
  int32 Concurrent = 5;
  // 设置单个超时时间
  double PerTaskTimeout = 6;
}


// WebShell
enum ShellType {
  Behinder = 0;
  Godzilla = 1;
  YakShell = 2;
}

enum ShellScript {
  JSP = 0;
  JSPX = 1;
  ASP = 2;
  ASPX = 3;
  PHP = 4;
}
enum EncMode {
  Raw = 0;
  Base64 = 1;
  AesRaw = 2;
  AesBase64 = 3;
  XorRaw = 4;
  XorBase64 = 5;
}

message WebShell {
  int64 Id = 1;
  string Url = 2;
  string Pass = 3;
  string SecretKey = 4;
  string EncMode = 5;
  string Charset = 6;
  string ShellType = 7;
  string ShellScript = 8;
  bool Status = 9;
  string Tag = 10;
  //    Proxy
  string Proxy = 11;
  map<string, string> Headers = 12;
  string Remark = 13;
  int64 CreatedAt = 14;
  int64 UpdatedAt = 15;
  string PacketCodecName = 16;
  string PayloadCodecName = 17;
  map<string, string> Posts = 18;
  ShellOptions ShellOptions = 19;
  string Os = 20;
  string ResDecMOde = 21; //解密方式
}

message ShellGenerate{
  EncMode EncMode = 1;
  ShellScript Script = 2;
  string Pass = 3;
  bool Confuse = 4;  //是否混淆
  bool IsSession = 5;
}

message ShellOptions{
  int64 RetryCount = 1; //重新时间
  int64 Timeout = 2; //超时时间
  int64 BlockSize = 3; //分块大小
  int64 MaxSize = 4; //上传的最大包（M）
  int64 UpdateTime = 5; //更新时间，当是session-mode的时候涉及到session过期的问题
  bool IsSession = 6; //是否是session类型
}

message WebShellRequest {
  int64 Id = 1;
}

message WebShellResponse {
  bool State = 1;
  bytes Data = 2;
}

message QueryWebShellsRequest {
  Paging Pagination = 1;
  string Tag = 2;
}

message QueryWebShellsResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated WebShell Data = 3;
}

message UpdateWebShellRequest {
  int64 Id = 1;
  string Url = 2;
  string Pass = 3;
  string SecretKey = 4;
  string EncMode = 5;
  string Charset = 6;
  string ShellType = 7;
  string ShellScript = 8;
  string Tag = 10;
  ShellOptions ShellOptions = 11;
  string Os = 12;
  string ResDataMOde = 13;
  map<string, string> Headers = 14;
  map<string, string> Posts = 15;

}

message DeleteWebShellRequest {
  int64 Id = 1;
  repeated int64 Ids = 2;
}


message YakDNSLogBridgeAddr {
  string DNSLogAddr = 1;
  string DNSLogAddrSecret = 2;
  string DNSMode = 3;
  bool UseLocal = 4;
  bool UseRemote = 5;
}

message RequireDNSLogDomainByScriptRequest {
  string Token = 1;
  string ScriptName = 2;
}

message QueryDNSLogByTokenRequest {
  string Token = 1;
  string DNSLogAddr = 2;
  string DNSMode = 3;
  bool UseLocal = 4;
  bool UseRemote = 5;
}

message QueryDNSLogByTokenResponse {
  repeated DNSLogEvent Events = 1;
}

message DNSLogEvent {
  string DNSType = 1;
  string Token = 2;
  string Domain = 3;
  string RemoteAddr = 4;
  string RemoteIP = 5;
  int32 RemotePort = 6;
  bytes Raw = 7;
  int64 Timestamp = 8;
}

message DNSLogRootDomain {
  string Domain = 1;
  string Token = 2;
}

message GetGlobalReverseServerResponse {
  string PublicReverseIP = 1;
  int32 PublicReversePort = 2;
  string LocalReverseAddr = 3;
  int32 LocalReversePort = 4;
}

message AvailableLocalAddrResponse {
  repeated NetInterface Interfaces = 1;
}

message NetInterface {
  string Name = 1;
  string Addr = 2;
  string IP = 3;
  string Description = 4;
  bool IsIpv4 = 5;
  bool IsIpv6 = 6;
  string NetInterfaceName = 7;
}

message ConfigGlobalReverseParams {
  GetTunnelServerExternalIPParams ConnectParams = 1;
  string LocalAddr = 2;
}

message DeleteRiskRequest {
  int64 Id = 1;
  string Hash = 2;
  repeated int64 Ids = 4;
  QueryRisksRequest Filter = 3;
  bool DeleteAll = 5;
  bool DeleteRepetition = 6;
}

message QueryRiskRequest {
  int64 Id = 1;
  string Hash = 2;
  repeated int64 Ids = 4;
  QueryRisksRequest Filter = 3;
}

message Risk {
  string Hash = 1;

  string IP = 2;
  string Url = 3;
  int32  Port = 4;
  string Host = 5;

  string Title = 6;
  string TitleVerbose = 7;
  string RiskType = 8;
  string RiskTypeVerbose = 9;
  string Parameter = 10;
  string Payload = 11;
  string Details = 12;

  string FromYakScript = 13;
  string YakScriptUUID = 29;

  bool WaitingVerified = 14;
  string ReverseToken = 15;

  int64 Id = 18;
  int64 CreatedAt = 16;
  int64 UpdatedAt = 17;

  string Severity = 19;

  // 数据包提取出来！
  bytes Request = 20;
  bytes Response = 21;

  // 这个一般用于生成报告追踪报告中产生的漏洞
  string RuntimeId = 22;

  string CVE = 23;
  string Description = 24;
  string Solution = 25;
  string TaskName = 26;
  string Tags = 27;
  bool IsRead = 28;
}

message QueryRisksRequest {
  Paging Pagination = 1;

  string Search = 2;
  string Network = 3;
  string Ports = 4;
  string RiskType = 5;
  string Token = 6;
  bool WaitingVerified = 7;
  string Severity = 8;

  int64 FromId = 9;
  int64 UntilId = 10;
  string Tags = 11;
  string IsRead = 12;
  string Title = 13;
  repeated int64 Ids = 14;

  string RuntimeId = 15;
}

message QueryRisksResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated Risk Data = 3;
}

message QueryNewRiskRequest {
  int64 AfterId = 1;
}

message QueryNewRiskResponse {
  repeated NewRisk Data = 1;
  int64 NewRiskTotal = 2;
  int64 Total = 3;
  int64 Unread = 4;
}

message QueryRiskTagsResponse {
  repeated FieldGroup RiskTags = 1;
}

message RiskFieldGroupResponse {
  repeated FieldGroup RiskIPGroup = 1;
  repeated FieldName RiskLevelGroup = 2;
  repeated FieldName RiskTypeGroup = 3;
}

message FieldGroup {
  string Name = 1;
  int32 Total = 2;
}

message NewRisk {
  string Title = 1;
  int64 Id = 2;
  int64 CreatedAt = 3;
  int64 UpdatedAt = 4;
  string Verbose = 5;
  string TitleVerbose = 6;
  bool IsRead = 7;
}

message NewRiskReadRequest {
  int64 AfterId = 1;
  repeated int64 Ids = 2;
}

message UploadRiskToOnlineRequest {
  string Token = 1;
  string ProjectName = 2;
}

message SetTagForRiskRequest {
  int64 Id = 1;
  string Hash = 2;
  repeated string Tags = 3;
}


message VerifyTunnelServerDomainParams {
  GetTunnelServerExternalIPParams ConnectParams = 1;
  string Domain = 2;
}

message VerifyTunnelServerDomainResponse {
  string Domain = 1;
  bool Ok = 2;
  string Reason = 3;
}

message GetTunnelServerExternalIPParams {
  string Addr = 1;
  string Secret = 2;
}

message GetTunnelServerExternalIPResponse {
  string IP = 1;
}

message StartFacadesParams {
  // 端口复用的
  string LocalFacadeHost = 41;
  int32 LocalFacadePort = 42;
  //  bool EnableRMIServer = 1;
  //  int32 RMILocalPort = 2;
  //
  bool EnableDNSLogServer = 3;
  int32 DNSLogLocalPort = 4;
  //
  //  bool EnableHTTPServer = 23;
  //  int32 HTTPServerPort = 24;

  // 连接远程端口参数
  GetTunnelServerExternalIPParams ConnectParam = 5;

  // 远端端口开放情况
  //  int32 RMIRemotePort = 6;
  int32 FacadeRemotePort = 16;
  int32 DNSLogRemotePort = 7;

  // 外部域名
  string ExternalDomain = 8;

  // 验证端口是否转发成功
  bool Verify = 9;
}
message ApplyClassToFacadesParamsWithVerbose {
  YsoOptionsRequerstWithVerbose GenerateClassParams = 1;
  string Token = 2;
}
//已弃用
message ApplyClassToFacadesParams {
  YsoOptionsRequerst GenerateClassParams = 1;
  string Token = 2;
}
message StartFacadesWithYsoParams {
  // 端口复用的
  bool IsRemote = 1;
  int32 ReversePort = 2;
  string ReverseHost = 4;
  string Token = 5;
  GetTunnelServerExternalIPParams BridgeParam = 6;

  YsoOptionsRequerst GenerateClassParams = 7;
}

message Tree {
  string Name = 1;
  string Data = 2;
  repeated Tree Children = 3;
}

message GetAvailableBruteTypesResponse {
  repeated string Types = 1; // 弃用
  repeated Tree TypesWithChild = 2;
}

message StartBruteParams {
  string Type = 1;
  string Targets = 2;
  string TargetFile = 3;

  // 设置如果用户输入了，就代替默认字典
  bool ReplaceDefaultUsernameDict = 28;
  bool ReplaceDefaultPasswordDict = 29;

  repeated string Usernames = 4;
  string UsernameFile = 24;

  repeated string Passwords = 5;
  string PasswordFile = 25;

  repeated string Prefix = 6;
  float Timeout = 7;

  // 每个目标之间的并发
  int64 Concurrent = 8;
  int64 Retry = 9;

  // 目标任务内并发
  int64 TargetTaskConcurrent = 10;

  //
  bool OkToStop = 11;
  int64 DelayMin = 12;
  int64 DelayMax = 13;

  string PluginScriptName = 14;
}

message HTTPRequestMutateParams {
  bytes Request = 1;

  repeated string FuzzMethods = 2;

  // use chunk encode
  bool ChunkEncode = 3;

  // multipart boundary
  bool UploadEncode = 4;
}

message HTTPResponseMutateParams {
  bytes Response = 2;
}

message MutateResult {
  bytes Result = 1;
  repeated bytes ExtraResults = 2;
}

message QueryHostsRequest {
  Paging Pagination = 1;

  string DomainKeyword = 2;
  string Network = 3;
}

message DeleteHostsRequest {
  bool DeleteAll = 1;
  string DomainKeyword = 2;
  string Network = 3;
  int64 ID = 4;
}

message QueryHostsResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated Host Data = 3;
}

message QueryDomainsRequest {
  Paging Pagination = 1;
  string Network = 2;
  string DomainKeyword = 3;
  string Title = 4;
  bool   All = 5;
}

message DeleteDomainsRequest {
  bool DeleteAll = 1;
  string DomainKeyword = 2;
  string Network = 3;
  int64 ID = 4;
  QueryDomainsRequest Filter = 5;
  repeated int64 IDs = 6;
}

message QueryDomainsResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated Domain Data = 3;
}

message Domain {
  int64 ID = 1;
  string DomainName = 2;
  string IPAddr = 3;
  string HTTPTitle = 4;
}

message QueryPortsGroupResponse {
  repeated PortsGroup PortsGroupList = 1;
}

message PortsGroup {
  string GroupName = 1;
  repeated GroupList GroupLists = 2;
}

message GroupList {
  string ServiceType = 1;
  string ShowServiceType = 2;
  int32 Total = 3;
}

message Host {
  int64 Id = 1;
  string IP = 2;
  int64 IPInteger = 3;
  bool IsInPublicNet = 4;
  repeated string Domains = 5;
}

message DownloadReportRequest {
  string FileData = 1;
  string FileName = 2;
  string FileDir = 3;
}

message DeleteYakScriptExecResultRequest {
  repeated int64 Id = 1;
  string YakScriptName = 2;
}

message YakScriptNames {
  repeated string YakScriptNames = 1;
}

message QueryYakScriptExecResultRequest {
  Paging Pagination = 1;
  string YakScriptName = 2;
}

message QueryYakScriptExecResultResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated ExecResult Data = 3;
}

message GenerateWebsiteTreeResponse {
  bytes TreeDataJson = 1;
}

message GenerateWebsiteTreeRequest {
  string Targets = 1;
}

message StartBasicCrawlerRequest {
  string Targets = 1;
  string TargetsFile = 2;

  string MaxDepth = 3;
  string MaxCountOfLinks = 4;
  string MaxCountOfRequest = 5;
  string DisallowSuffix = 6;
  string StartFromParentPath = 7;
  string MaxRetryTimes = 8;
  string AllowMethods = 9;
  string AllowDomains = 10;
  string ForbiddenDomain = 11;
  string AllowUrlRegexp = 12;
  string ForbiddenUrlRegexp = 13;
  string UserAgent = 14;

  // 基础认证
  string BasicAuth = 15;
  string BasicAuthUsername = 16;
  string BasicAuthPassword = 17;

  // Transport
  repeated string Proxies = 18;
  int64 Concurrent = 19;
  int64 MaxRedirectTimes = 20;
  int64 ConnectTimeoutSeconds = 21;
  int64 ResponseTimeoutSeconds = 22;

  repeated HTTPHeader Headers = 23;
  repeated HTTPCookie Cookies = 24;
}

message HTTPCookieSetting {
  string Key = 1;
  string Value = 2;
  string Path = 3;
  string Domain = 4;
  int64 Expires = 5;
  int64 MaxAge = 6;
  bool Secure = 7;
  bool HttpOnly = 8;

  // default
  // lax
  // strict
  // none
  string SameSiteMode = 9;
}

message HTTPCookie {
  string Key = 1;
  string Value = 2;
  bool AllowOverride = 3;
}

message ExportYakScriptRequest {
  int64 YakScriptId = 1;
  string OutputDir = 2;
  string OutputPluginDir = 3;
  repeated int64 YakScriptIds = 4;
  bool All = 5;
}

message ExportYakScriptStreamRequest {
  QueryYakScriptRequest Filter = 1;
  string OutputFilename = 2;
  string Password = 3;
}

message ImportYakScriptStreamRequest {
  bytes Data = 1;
  string Password = 2;
  string Filename = 3;
}

message ExportYakScriptResponse {
  string OutputDir = 2;
}


message GetMarkdownDocumentResponse {
  YakScript Script = 1;
  string Markdown = 2;
}

message GetMarkdownDocumentRequest {
  string YakScriptName = 1;
  int64 YakScriptId = 2;
}

message SaveMarkdownDocumentRequest {
  string YakScriptName = 1;
  int64 YakScriptId = 2;
  string Markdown = 3;
}

message GroupNames {
  repeated string Groups = 1;
}

message QueryGroupsByYakScriptIdRequest {
  int64 YakScriptId = 1;
  string Mode = 2;
}

message MenuItem {
  string Group = 1;
  string Verbose = 2;
  int64 YakScriptId = 3;
  BatchExecutionPluginFilter Query = 4;
  uint64 MenuItemId = 5;
  int64 GroupSort = 6;
  string YakScriptName = 7;
}

// 这里的小写不要改动，兼容前端已有的格式
message BatchExecutionPluginFilter {
  string type = 1;
  string tags = 2;
  repeated string include = 3;
  repeated string exclude = 4;
}

message MenuItemGroup {
  string Group = 1;
  repeated MenuItem Items = 2;
  int64 MenuSort = 3;
  string Mode = 4;
}

message GetMenuItemByIdRequest {
  uint64 ID = 1;
}

message MenuByGroup {
  repeated MenuItemGroup Groups = 1;
}

message YakScriptIsInMenuRequest {
  string Group = 1 ;
  int64 YakScriptId = 2;
}

message RemoveFromMenuRequest {
  int64 YakScriptId = 1;
  string Group = 2;
  string Mode = 3;
}

message AddToMenuRequest {
  int64 YakScriptId = 1;
  string Group = 2;
  string Verbose = 3;
  string Mode = 4;
  int64  MenuSort = 5;
  int64  GroupSort = 6;
}

message AddMenuRequest {
  repeated MenuItemGroup  Data = 1;
}

message QueryAllMenuItemRequest {
  string Mode = 1;
  string Group = 2;
  string Verbose = 3;
}

message ImportMenuItemRequest {
  string RawJson = 1;
  string JsonFileName = 2;
}

message ExportMenuItemResult {
  string RawJson = 1;
}

message AddToNavigationRequest {
  repeated NavigationList Data = 1;
}

message NavigationList {
  string Group = 1;
  repeated NavigationItem Items = 2;
  int64 GroupSort = 3;
  string Mode = 4;
  string GroupLabel = 5;
}

message NavigationItem {
  int64 YakScriptId = 1;
  string Group = 2;
  string Mode = 3;
  int64  VerboseSort = 4;
  int64  GroupSort = 5;
  string Route = 6;
  string YakScriptName = 7;
  string Verbose = 8;
  string VerboseLabel = 9;
  string GroupLabel = 10;
  string HeadImg = 11;
}

message GetAllNavigationRequest {
  string Mode = 1;
  string Group = 2;
  string YakScriptName = 3;
}

message GetAllNavigationItemResponse {
  repeated NavigationList Data = 1;
}

message AddOneNavigationRequest {
  string YakScriptName = 1;
  string Group = 2;
  string Verbose = 3;
  string Mode = 4;
  int64  VerboseSort = 5;
  int64  GroupSort = 6;
  string GroupLabel = 7;
  string VerboseLabel = 8;
  string Route = 9;
}

message QueryNavigationGroupsRequest {
  string YakScriptName = 1;
  string Mode = 2;
}


message UpdateFromYakitResourceRequest {
  string Proxy = 1;
  string BaseSourceUrl = 2;
}

message UpdateFromGithubRequest {
  string Proxy = 1;
  string GithubUrl = 2;
}

message SimpleScript {
  string Content = 1;
}

message LastRecord {
  int64 LastRecordPtr = 1;
  double Percent = 2;
  string YakScriptOnlineGroup = 3;
  string ExtraInfo = 4;
}

message RecordPortScanRequest {
  LastRecord LastRecord = 1;
  StartBruteParams StartBruteParams = 3;
  PortScanRequest PortScanRequest = 2;
  string RuntimeId = 4;
}

message CreatReportRequest {
  string ReportName = 1;
  string RuntimeId = 2;
}

message PortScanRequest {
  string Targets = 1;
  string Ports = 2;
  string Mode = 3;
  repeated string Proto = 4;
  int64 Concurrent = 5;
  // 主动发包模式
  bool Active = 6;
  // service / web / all
  string FingerprintMode = 7;

  // 保存数据库
  bool SaveToDB = 8;

  // 保存已经关闭的端口
  bool SaveClosedPorts = 9;

  // 上传扫描目标为文件
  string TargetsFile = 10;

  // 设置上传的文件
  repeated string ScriptNames = 11;

  // TCPProxy
  repeated string Proxy = 12;

  // 设置单次探测超时时间
  double ProbeTimeout = 13;

  // ProbeMax 设置指纹探测条数
  int32 ProbeMax = 14;

  // 启用 C 段扫描
  bool EnableCClassScan = 15;

  // HostAlive Scan
  bool SkippedHostAliveScan = 16;
  double HostAliveTimeout = 17;
  int32 HostAliveConcurrent = 18;
  string HostAlivePorts = 19;

  // 排除端口与主机
  string ExcludeHosts = 20;
  string ExcludePorts = 21;

  // EnableBasicCrawler
  // 是否启用基础爬虫，以及基础爬虫最多几个请求？
  bool EnableBasicCrawler = 22;
  int64 BasicCrawlerRequestMax = 23;

  // SYN Concurrent
  // 简易设置 SYN 每秒并发
  int64 SynConcurrent = 24;

  string TaskName = 25;

  bool EnableBrute = 26;

  string SynScanNetInterface = 27;

  // 联动插件的配置
  HybridScanPluginConfig LinkPluginConfig = 28;

  // 爬虫是否启用 JS 解析
  bool BasicCrawlerEnableJSParser = 29;
  repeated string UserFingerprintFiles = 30;
}

message DeletePortsRequest {
  string Hosts = 1;
  string Ports = 2;
  repeated int64 Id = 3;
  bool All = 4;
  repeated int64 Ids = 5;
  bool DeleteAll = 6;
  QueryPortsRequest Filter = 7;
}

message QueryPortsRequest {
  Paging Pagination = 1;

  // 根据 Hosts Ports 查询
  string Hosts = 2;
  string Ports = 3;
  string Service = 4;
  string State = 5;
  string Title = 6;
  bool   All = 7;
  string Keywords = 8;
  bool  TitleEffective = 9;
  string ComplexSelect = 10;
  string Proto = 11;
  string RuntimeId = 12;

  int64 BeforeUpdatedAt = 13;
  int64 AfterUpdatedAt = 14;
  int64 AfterId = 15;
  int64 BeforeId = 16;
  string OrderBy = 17;
  string Order = 18;
}

message QueryPortsResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated Port Data = 3;
}

message Port {
  string Host = 1;
  int64 IPInteger = 2;
  int64 Port = 3;
  string Proto = 4;
  string ServiceType = 5;
  string State = 6;
  string Reason = 7;
  string Fingerprint = 8;
  repeated string CPE = 9;
  string HtmlTitle = 10;

  int64 Id = 11;
  int64 CreatedAt = 12;
  int64 UpdatedAt = 13;
  string TaskName = 14;
}

message YakitCompletionRawResponse {
  bytes RawJson = 1;
}

message GetYakVMBuildInMethodCompletionRequest {

}

// 这个定义我们争取和 monaco editor suggestion 基本一致
message SuggestionDescription {
  string Label = 1;
  string Description = 2;
  string InsertText = 3;
  bool JustAppend = 4;
  string DefinitionVerbose = 5; // 展示定义的内容，如果没有的话，一般展示 InsertText 就行
  string Kind = 6; // 补全类型, Method = 0, Function = 1, Constructor = 2, Field = 3, Variable = 4, Class = 5, Struct = 6, Interface = 7, Module = 8, Property = 9, Event = 10, Operator = 11, Unit = 12, Value = 13, Constant = 14, Enum = 15, EnumMember = 16, Keyword = 17, Text = 18, Color = 19, File = 20, Reference = 21, Customcolor = 22, Folder = 23, TypeParameter = 24, User = 25, Issue = 26, Snippet = 27
}

message MethodSuggestion {
  // 产生这个方法提示的关键词是啥？
  repeated string ExactKeywords = 1;
  repeated string FuzzKeywords = 2;
  repeated string Regexp = 3;

  // 提示的内容是啥？
  repeated SuggestionDescription Suggestions = 4;

  // 这个代码提示方法组是啥？
  string Verbose = 5;
}

message GetYakVMBuildInMethodCompletionResponse {
  repeated MethodSuggestion Suggestions = 1;
}


message RenameRequest {
  string Name = 1;
  string NewName = 2;
}

message NameRequest {
  string Name = 1;
}

message PayloadGroupNode {
  string Type = 1; // "File" / "DataBase" / "Folder"
  string Name = 2;
  int64 Number = 3;
  repeated PayloadGroupNode Nodes = 4; // for Type "Folder"
}

message GetAllPayloadGroupResponse {
  repeated string Groups = 1;
  repeated PayloadGroupNode Nodes = 2;
}
message UpdateAllPayloadGroupRequest{
  repeated PayloadGroupNode Nodes = 1;
}

message SavePayloadRequest {
  bool IsFile = 1;
  string Group = 2;
  string Content = 3;
  repeated string FileName = 4;
  string Folder = 5;
  bool IsNew = 6;
}


message UpdatePayloadRequest {
  // old
  string Group = 1;   // old
  string OldGroup = 2; // old

  // new, please use this
  int64 Id = 3;
  Payload Data = 4;
}

message UpdatePayloadToFileRequest {
  string GroupName = 1;
  string Content = 2;
}

// copy payload(get by id) to group
message BackUpOrCopyPayloadsRequest {
  repeated int64 Ids = 1;
  string Group = 2;
  string Folder = 3;
  bool Copy = 4;
}

message DeletePayloadByGroupRequest {
  string Group = 1;
}

message DeletePayloadRequest {
  int64 Id = 1;
  repeated int64 Ids = 2;
}

message QueryPayloadFromFileRequest {
  string Group = 1;
  string Folder = 2;
}
message QueryPayloadFromFileResponse {
  bytes Data = 1;
  bool IsBigFile = 2;
}

message QueryPayloadRequest {
  Paging Pagination = 1;
  string Group = 2;
  string Keyword = 3;
  string Folder = 4;
}

message QueryPayloadResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated Payload Data = 3;
}

message Payload {
  int64 Id = 1;
  string Group = 2;
  bytes ContentBytes = 3;
  string Content = 4;
  string Folder = 5;
  int64 HitCount = 6;
  bool IsFile = 7;
}

message GetAllPayloadRequest {
  string Group = 1;
  string Folder = 2;
  string SavePath = 3;
}

message GetAllPayloadResponse {
  repeated Payload Data = 1;
  double Progress = 2;
}

message GetAllPayloadFromFileResponse {
  double Progress = 1;
  bytes Data = 2;
}

message QueryYakScriptRequest {
  Paging Pagination = 1;
  string Type = 2;
  string Keyword = 3;
  bool IsHistory = 4;
  bool IsIgnore = 5;
  bool IsGeneralModule = 6;
  bool IsBatch = 7;
  bool ExcludeNucleiWorkflow = 8;
  repeated string ExcludeScriptNames = 9;
  repeated string IncludedScriptNames = 10;
  repeated string Tag = 11;
  bool NoResultReturn = 12; // 这是一很特殊的选项，如果开启了，total 将会为 0
  int64 UserId = 13;
  string UserName = 14;

  bool IgnoreGeneralModuleOrder = 15;
  repeated string Family = 16;
  string UUID = 17;
  PluginGroup Group = 18;
  repeated string ExcludeTypes = 19;
  int64 IsMITMParamPlugins = 20; //0->默认全部 1->是mitm带参数插件 2->mitm不带参数
}

message PluginGroup {
  bool UnSetGroup = 1;
  repeated string Group = 2;
  string IsPocBuiltIn = 3;
}

message QueryYakScriptResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated YakScript Data = 3;
}

message YakScriptParam {
  string Field = 1;
  string DefaultValue = 2;

  // int/number/integer/float/str/bool
  string TypeVerbose = 3;

  string FieldVerbose = 4;

  string Help = 5;

  bool Required = 6;
  string Group = 7;

  string ExtraSetting = 8;

  string MethodType = 9;
}

message YakScript {
  int64 Id = 1;
  string Content = 2;
  string Type = 3;
  repeated YakScriptParam Params = 4;
  int64 CreatedAt = 5;
  string ScriptName = 6;
  string Help = 7;
  string Level = 8;
  string Author = 9;
  string Tags = 10;
  bool IsHistory = 11;
  bool IsIgnore = 12;
  bool IsGeneralModule = 13;
  string GeneralModuleVerbose = 14;
  string GeneralModuleKey = 15;
  string FromGit = 16;
  bool EnablePluginSelector = 17;
  string PluginSelectorTypes = 18;
  int64 OnlineId = 19;
  int64 UserId = 20;
  string OnlineScriptName = 21;
  string OnlineContributors = 22;
  string UUID = 23;
  bool OnlineIsPrivate = 24;
  string HeadImg = 25;
  string OnlineBaseUrl = 26;
  int64  BaseOnlineId = 27;
  bool OnlineOfficial = 28;
  string OnlineGroup = 29;
  bool IsCorePlugin = 30;
  int64 UpdatedAt = 31;
  string RiskType = 32;
  // 结构弃用
  QueryYakScriptRiskDetailByCWEResponse RiskDetail = 33;
  string RiskAnnotation = 34;
  // 协作者
  repeated Collaborator CollaboratorInfo = 35;
  repeated YakRiskInfo RiskInfo = 36;
  bool IsUpdate = 37;
}

message Collaborator {
  string HeadImg = 1;
  string UserName = 2;
}

message SaveNewYakScriptRequest {
  string Content = 1;
  string Type = 2;
  repeated YakScriptParam Params = 3;
  string ScriptName = 4;
  string Help = 5;
  string Level = 6;
  string Tags = 7;
  bool IsHistory = 8;
  bool IsIgnore = 9;
  bool IsGeneralModule = 10;
  string GeneralModuleVerbose = 11;
  string GeneralModuleKey = 12;
  string FromGit = 13;
  bool EnablePluginSelector = 14;
  string PluginSelectorTypes = 15;
  bool IsCorePlugin = 16;
  string RiskType = 17;
  // 这个结构弃用,换成YakRiskInfo
  QueryYakScriptRiskDetailByCWEResponse RiskDetail = 18;
  string RiskAnnotation = 19;
  int64 Id = 20;
  repeated YakRiskInfo RiskInfo = 21;
}

message SaveYakScriptToOnlineRequest {
  repeated string ScriptNames = 1;
  string Token = 2;
  bool IsPrivate = 3;
  bool All = 4;
}

message SaveYakScriptToOnlineResponse {
  // 进度
  double Progress = 1;
  string Message = 2;
  string MessageType = 3;
}

message ToOnlineResult {
  string ScriptName = 1;
}

message ExportLocalYakScriptRequest {
  string OutputDir = 1;
  string OutputPluginDir = 2;
  repeated int64 YakScriptIds = 3;
  string Keywords = 4;
  string Type = 5;
  string UserName = 6;
  string Tags = 7;
}

message ExportLocalYakScriptResponse {
  string OutputDir = 1;
}

message ExportYakScriptLocalResponse {
  string OutputDir = 1;
  double Progress = 2;
  string Message = 3;
  string MessageType = 4;
}


message ImportYakScriptRequest {
  repeated string Dirs = 1;
}

message ImportYakScriptResult {
  // 进度
  double Progress = 1;
  string Message = 2;
  string MessageType = 3;
}

message QueryYakScriptGroupRequest {
  bool All = 1;
  string PageId = 2;
  // 默认是false， 目前中有专项漏洞这里的关键词组传 true 才会返回数据，插件管理里面不传就不会返回 poc 这边的内置组
  bool IsPocBuiltIn = 3;
  repeated string ExcludeType = 4;
  int64 IsMITMParamPlugins = 5;
}

message QueryYakScriptGroupResponse {
  repeated GroupCount Group = 1;
}

message GroupCount {
  string Value = 1;
  int32 Total = 2;
  bool Default = 3;
  // 临时组ID
  string TemporaryId = 5;
  bool IsPocBuiltIn = 6;
}

message SaveYakScriptGroupRequest {
  QueryYakScriptRequest Filter = 1;
  repeated string SaveGroup = 2;
  repeated string RemoveGroup = 3;
  string PageId = 4;
}

message RenameYakScriptGroupRequest {
  string Group = 1;
  string NewGroup = 2;
}

message DeleteYakScriptGroupRequest {
  string Group = 1;
}

/*message GetYakScriptGroupRequest {
  QueryYakScriptRequest Filter = 1;
}*/

message GetYakScriptGroupResponse {
  repeated string SetGroup = 1;
  repeated string AllGroup = 2;
}

message ResetYakScriptGroupRequest {
  string Token = 1;
}

message SetGroupRequest {
  string GroupName = 1;
}

message GetYakScriptTagsAndTypeResponse {
  repeated TagsAndType Type = 1;
  repeated TagsAndType Tag = 2;
  repeated TagsAndType Group = 3;
}

message TagsAndType {
  string Value = 1;
  int32 Total = 2;
}

message CodecRequest {
  string Text = 1;
  string Type = 2;
  bool Auto = 3;
  repeated ExecParamItem Params = 4;
  string ScriptName = 5;

  // 如果 InputBytes 设置了，将会无条件覆盖 Text
  bytes InputBytes = 6;
}

message CodecWork{
  string CodecType = 1;
  string Script = 2;
  string PluginName = 3;
  repeated ExecParamItem Params = 5;
}

message CodecRequestFlow{
  string Text = 1;
  bool Auto = 2;
  repeated CodecWork WorkFlow = 3;
  bytes InputBytes = 6;
}

message CustomizeCodecFlow{
  string FlowName = 1;
  repeated CodecWork WorkFlow = 2;
  string WorkFlowUI = 3;
}

message DeleteCodecFlowRequest {
  bool DeleteAll = 1;
  string FlowName = 2;
}

message GetCodecFlowResponse {
  repeated CustomizeCodecFlow Flows = 1;
}


message CodecResponse {
  string Result = 1; // show result
  bytes  RawResult = 2; // raw result, need hex editor
  string ResultVerbose = 3;
  bool IsFalseAppearance = 4; // 是否是失真
}

message CodecMethods {
  repeated CodecMethod Methods = 1;
}

message CodecMethod {
  string Tag = 1; // Codec 分类
  string CodecName = 2; //  Codec name
  string CodecMethod = 3; // Codec Method
  string Desc = 4; // 描述
  repeated CodecParam Params = 5; // Codec Param 用于构建样式
}

message CodecParam {
  string Name = 1;
  string Type = 2; // input | select | checkbox | search | monaco | inputSelect
  repeated string Options = 3; // 可选值
  bool  Required = 4; // 就算是false也需要传
  string Desc = 5; // 描述
  string Regex = 6; // 正则
  string Label = 7; // 参数文本标签
  string DefaultValue = 8; // 默认值
  CodecParam Connector = 9; // 连接组件
}

// Yak Invoker
message ExecHistoryRequest {
  Paging Pagination = 1;
  int64 YakScriptId = 3;
  string YakScriptName = 4;
}

message ExecHistoryRecordResponse {
  repeated ExecHistoryRecord Data = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

// 执行的历史记录
message ExecHistoryRecord {
  // 脚本内容
  string Script = 1;
  // 脚本 ID（如果有的话）
  string ScriptId = 2;
  // 执行时间点
  int64 Timestamp = 3;
  // 执行间隔
  int64 DurationMs = 4;
  // 执行参数（命令行参数部分）
  string Params = 5;

  // 执行成功还是失败
  bool Ok = 7;
  // 失败原因是啥？
  string Reason = 8;
  // Uid
  string Id = 9;

  // 展示界面内容
  bytes Stdout = 10;
  bytes Stderr = 11;

  //
  string RuntimeId = 12;
  string FromYakModule = 13;

  int64 StdoutLen = 14;
  int64 StderrLen = 15;

  bytes Messages = 16;

}

// Fuzz 相关模型
message StringFuzzerRequest {
  string Template = 1;
  string HotPatchCode = 2;
  string HotPatchCodeWithParamGetter = 3;
  int64 Limit = 4;
  int64 TimeoutSeconds = 5;
}


message StringFuzzerResponse {
  repeated bytes Results = 1;
}

message HTTPRequestAnalysisMaterial {
  string Request = 1;
  bool IsHTTPS = 2;
  string Response = 3;
}

message HTTPRequestParamItem {
  string TypePosition = 1;
  string ParamOriginValue = 2;
  string ParamName = 3;
  string TypePositionVerbose = 4;
}

message HTTPRequestAnalysis {
  repeated HTTPRequestParamItem Params = 1;
  repeated string Requests = 2;
  bool IsHTTPS = 3;
}

message HTTPResponseMatcher {
  repeated HTTPResponseMatcher SubMatchers = 1;
  string SubMatcherCondition = 2;

  string MatcherType = 3;
  string Scope = 4;
  string Condition = 5;
  repeated string Group = 6;
  string GroupEncoding = 7;
  bool Negative = 8;
  string ExprType = 9;

  string HitColor = 10;
  string Action = 11;
}

message RenderVariablesRequest {
  repeated KVPair Params = 1;
  bool IsHTTPS = 2;
  bool IsGmTLS = 3;
  bytes HTTPRequest = 5;
  bytes HTTPResponse = 4;
}

message RenderVariablesResponse {
  repeated KVPair Results = 1;
}

message MatchHTTPResponseParams {
  repeated HTTPResponseMatcher Matchers = 1;
  string MatcherCondition = 2;

  bool IsHTTPS = 3;
  string HTTPResponse = 4;
  string HTTPRequest = 5;
}

message MatchHTTPResponseResult {
  bool Matched = 1;
}

message HTTPResponseExtractor {
  string Name = 1; // default for index
  string Type = 2; // regex / xpath / kval / json / nuclei-dsl
  string Scope = 3; // body / header / raw
  repeated string Groups = 4;
  repeated int64 RegexpMatchGroup = 5;
  string XPathAttribute = 6;
}

message ExtractHTTPResponseResult {
  repeated FuzzerParamItem Values = 1;
}

message ExtractHTTPResponseParams {
  repeated HTTPResponseExtractor Extractors = 1;
  string HTTPResponse = 2;
}

message PreloadHTTPFuzzerParamsRequest {
  repeated FuzzerParamItem Params = 1;
}

message PreloadHTTPFuzzerParamsResponse {
  repeated FuzzerParamItem Values = 2;
}

message FuzzerParamItem {
  string Key = 1;
  string Value = 2;

  // nuclei-dsl / raw
  // fuzztag
  string Type = 3;
}

message FuzzerRequests {
  repeated FuzzerRequest Requests = 1;
  // concurrent flow
  int64 Concurrent = 2;
}

message FuzzerRequest {
  string Request = 1;
  bytes RequestRaw = 16;  // 这里是因为麻将块儿的问题，还是需要处理一下类型
  repeated FuzzerParamItem Params = 2;
  int64 Concurrent = 3;
  bool IsHTTPS = 4;
  bool IsGmTLS = 35;
  bool ForceFuzz = 5;
  string FuzzTagMode = 50;
  bool FuzzTagSyncIndex = 51;
  string Proxy = 6;
  double PerRequestTimeoutSeconds = 7;

  // 用于处理 Host 和 Header 中 Host 不一致的情况
  string ActualAddr = 8;

  // redirect setting
  bool NoFollowRedirect = 9;
  // 这个弃用了，Meta 自动归类到 Redirect 里面
  bool NoFollowMetaRedirect = 10;
  bool FollowJSRedirect = 11;
  double RedirectTimes = 27;

  // 如果从历史加载，就用这个！
  int32 HistoryWebFuzzerId = 12;

  // 如果不想自动修复 Content-Length
  bool NoFixContentLength = 13;

  // 热加载代码
  string HotPatchCode = 14;

  // 设置 Fuzzer
  FuzzerResponseFilter Filter = 15;

  // 随时 delay
  double DelayMinSeconds = 17;
  double DelayMaxSeconds = 18;

  // 获取模版数据
  string HotPatchCodeWithParamGetter = 19;

  // retry
  int64 MaxRetryTimes = 20; // 最大重试次数
  string RetryInStatusCode = 21; // 命中这些状态码的时候，重试
  string RetryNotInStatusCode = 22; // 不是这些状态的时候，重试
  double RetryWaitSeconds = 25; // 重试等待时间
  double RetryMaxWaitSeconds = 26; // 最大重试等待时间

  // Response Charset
  // 默认或者不填为 UTF8
  // 中国的话，用 gb18030
  string ResponseCharset = 23;

  // Verbose
  // 这个字段不需要用户做任何处理，也不需要客户端传递
  // 这是服务端用来初始化的字段，用以构建快速搜索
  string Verbose = 24;

  // dns config
  repeated string DNSServers = 28;
  repeated KVPair EtcHosts = 29;

  // 不启用系统代理
  bool NoSystemProxy = 30;

  // 重复次数
  int64 RepeatTimes = 31;

  // Extractor n Matchers
  repeated HTTPResponseExtractor Extractors = 32;
  repeated HTTPResponseMatcher Matchers = 33;
  string MatchersCondition = 34;
  string HitColor = 36;

  // 如果发包的时候，需要指定一两个插件，那么可以通过他来操作，并把流量一起返回
  repeated string YamlPoCNames = 37;

  // 是否继承上一个 Workflow 的变量？（在 Sequence 中生效）
  bool InheritVariables = 38;
  bool ForceOnlyOneResponse = 39;
  bool InheritCookies = 40; // 上一个 Request 一般来说是单个请求，他的响应信息中 Cookie 也应该被妥善处理

  // web fuzzer task id
  // 需要配合前端的 Index
  // 这两个 Index 如果有的话，后端在执行 HTTP Fuzzer Sequence 的时候，就可以只传递这两个了
  // 如果没有的话，直接把整个 Request 传回去
  string FuzzerIndex = 41;
  string FuzzerTabIndex = 42;

  // BatchTarget
  // 继承透传给 HTTPPOOL 的参数，可以使用批量目标来发送
  bool BatchTargetFile = 43;
  bytes BatchTarget = 44;
  bool AfterRequested = 45;
  bool StopAtFirstMatch = 46;

  // retry task id
  int64 RetryTaskID = 47;

  // re matcher
  bool ReMatch = 48;

  // default 5M?
  // packet is too large (> MaxBodySize)
  int64 MaxBodySize = 49;

  int64 PauseTaskID = 52;
  bool IsPause = 53;

  repeated MutateMethod MutateMethods = 54;
  bool SetPauseStatus = 55;
}

message MutateMethod {
  string Type = 1;
  repeated KVPair Value = 2;
}

message KVPair {
  string Key = 1;
  string Value = 2;
}

message FuzzerResponseFilter {
  // 设置 body 大小作为过滤依据
  int64 MinBodySize = 1;
  int64 MaxBodySize = 2;

  // 设置正则作为过滤依据，这个正则针对整个数据包生效
  repeated string Regexps = 3;
  repeated string Keywords = 4;

  repeated string StatusCode = 6;
}

message RedirectRequestParams {
  string Request = 1;
  string Response = 2;
  bool IsHttps = 3;
  double PerRequestTimeoutSeconds = 4;
  string Proxy = 5;

  // Extractor n Matchers
  repeated HTTPResponseExtractor Extractors = 6;
  repeated HTTPResponseMatcher Matchers = 7;
  string MatchersCondition = 8;
  string HitColor = 9;

  repeated FuzzerParamItem Params = 10;
  bool IsGmTLS = 11;
}

message ExtractedUrl {
  string Url = 1;
}

message FuzzerSequenceResponse {
  FuzzerRequest Request = 1;
  FuzzerResponse Response = 2;
}

message FuzzerResponse {
  string Method = 1;
  int32  StatusCode = 2;
  string Host = 3;
  string ContentType = 4;
  repeated HTTPHeader Headers = 5;
  bytes ResponseRaw = 6;

  // response body 的长度
  int64 BodyLength = 7;
  // 这个请求大约花费了多长时间
  int64 DurationMs = 8; // FirstByte Duration
  int64 DNSDurationMs = 40;
  int64 FirstByteDurationMs = 41;
  int64 TotalDurationMs = 42;

  // 给一个随机 ID
  string UUID = 9;
  // timestamp 请求
  int64 Timestamp = 10;

  // RequestRaw 原始数据包
  bytes RequestRaw = 11;

  // 猜测可能的编码
  string GuessResponseEncoding = 12;

  // 基础状态
  bool Ok = 31;
  string Reason = 32;

  // IsHTTPS
  bool IsHTTPS = 33;

  // payloads
  repeated string Payloads = 34;

  double BodySimilarity = 35;
  double HeaderSimilarity = 36;

  // Matched by filter
  bool MatchedByFilter = 37;

  string Url = 38;

  int64 TaskId = 39;

  // 使用哪个代理
  string Proxy = 43;
  string RemoteAddr = 44;

  // 如果设置了
  repeated KVPair ExtractedResults = 45;
  bool MatchedByMatcher = 46;
  string HitColor = 47;
  repeated RedirectHTTPFlow RedirectFlows = 48;

  // too large file operators
  bool IsTooLargeResponse = 49;
  string TooLargeResponseHeaderFile = 50;
  string TooLargeResponseBodyFile = 51;
  bool DisableRenderStyles = 52;

  string RuntimeID = 53;
  bool Discard = 54;
}

message RedirectHTTPFlow {
  bool IsHttps = 1;
  bytes Request = 2;
  bytes Response = 3;
}

message Paging {
  int64 Page = 51;
  int64 Limit = 52;
  string OrderBy = 53;
  string Order = 54;
  string RawOrder = 55;
}

message GetHTTPFlowByHashRequest {
  string Hash = 1;
}

message GetHTTPFlowByIdRequest {
  int64 Id = 1;
}

message GetHTTPFlowByIdsRequest {
  repeated int64 Ids = 2;
}

message GetHTTPFlowBodyByIdRequest {
  int64 Id = 1;
  bool IsRequest = 2;
  int64 BufSize = 3;
}

message QueryHTTPFlowRequest {
  Paging Pagination = 1;
  string SourceType = 2;
  string Methods = 3;
  string SearchURL = 4;
  string StatusCode = 5;
  bool HaveCommonParams = 6;
  bool HaveBody = 7;
  string SearchContentType = 9;

  // 一般用于查询增量，查询所有更新前的内容
  int64 BeforeUpdatedAt = 10;
  int64 AfterUpdatedAt = 11;
  int64 AfterId = 12;
  int64 BeforeId = 13;

  string Keyword = 14;

  bool OnlyWebsocket = 15;

  // 查询包含在这个 URL 中的搜索结果
  repeated string IncludeInUrl = 16;
  // 不查询当前 URL 中的结果
  repeated string ExcludeInUrl = 17;
  // 仅查看当前 IP 对应的结果或不包含
  repeated string IncludeInIP = 18;
  repeated string ExcludeInIP = 19;

  repeated int64 ExcludeId = 20;

  repeated string IncludeInWhere = 21;
  repeated int64 IncludeId = 22;

  repeated string Tags = 23;
  string HaveParamsTotal = 24;
  repeated string Color = 25;
  int64 OffsetId = 26;

  int64 AfterBodyLength = 27;
  int64 BeforeBodyLength = 28;
  string IsWebsocket = 29;

  string RuntimeId = 31;
  string FromPlugin = 32;
  bool  Full = 33;

  repeated string IncludePath = 34;
  repeated string ExcludePath = 35;
  repeated string IncludeSuffix = 36;
  repeated string ExcludeSuffix = 37;
  repeated string ExcludeContentType = 38;

  bool WithPayload = 39;
  repeated string RuntimeIDs = 40;

  repeated string IncludeHash = 41;
  repeated string HiddenIndex = 42;
}

message HTTPFlowsToOnlineRequest {
  string Token = 1;
  string ProjectName = 2;
  string ProjectDescription = 3;
}

message ExportHTTPFlowsRequest {
  QueryHTTPFlowRequest ExportWhere = 1;
  repeated int64 Ids = 2;
  repeated string FieldName = 3;
}

message DeleteHTTPFlowRequest {
  bool DeleteAll = 1;
  repeated int64 Id = 4;
  repeated string ItemHash = 2;

  string URLPrefix = 3;
  QueryHTTPFlowRequest Filter = 5;
  repeated string  URLPrefixBatch = 6;
}

message QueryHTTPFlowsIdsRequest {
  repeated string IncludeInWhere = 1;
  string SourceType = 2;
}

message QueryHTTPFlowsIdsResponse {
  repeated HTTPFlow Data = 1;
}

message HTTPHeader {
  string Header = 1;
  string Value = 2;
}

message HTTPFlows {
  repeated HTTPFlow Data = 1;
}

message HTTPFlow {
  bool IsHTTPS = 2;
  string Url = 3;
  repeated HTTPHeader RequestHeader = 4;
  bytes Request = 5;
  repeated HTTPHeader ResponseHeader = 6;
  bytes Response = 7;
  string SourceType = 8;
  string Path = 9;
  string Method = 10;
  int64 BodyLength = 11;
  string BodySizeVerbose = 19;
  int64 RequestLength = 31; // 设置 Request Body 长度
  string RequestSizeVerbose = 32; // 设置 Request
  string ContentType = 12;
  int64 StatusCode = 13;
  int64 GetParamsTotal = 14;
  int64 PostParamsTotal = 15;
  int64 CookieParamsTotal = 22;
  int64 UpdatedAt = 16;
  int64 CreatedAt = 17;
  string Hash = 18;

  repeated FuzzableParam GetParams = 20;
  repeated FuzzableParam PostParams = 21;
  repeated FuzzableParam CookieParams = 23;

  string HostPort = 24;
  string IPAddress = 25;

  string HtmlTitle = 26;

  string Tags = 27;
  bool NoFixContentLength = 28;

  uint64 Id = 29;

  // websocket 相关字段
  bool IsWebsocket = 30;
  string WebsocketHash = 33;

  // 标记 UTF8 Invalid
  /*
    一般这不是无损的情况，会涉及到用户 Copy Paste 直接 Body 的需求
  */
  bool InvalidForUTF8Request = 34;
  bool InvalidForUTF8Response = 35;
  string RawRequestBodyBase64 = 36;
  string RawResponseBodyBase64 = 37;

  // 可以安全的传输到 Fuzzer 的 HTTPRequest
  string SafeHTTPRequest = 38;

  /*
  在完全数据下，可加载 Domain 和 RootDomain 还有 Json
  */
  repeated string Domains = 40;
  repeated string RootDomains = 41;
  repeated string JsonObjects = 42;

  bool IsTooLargeResponse = 43;
  string TooLargeResponseHeaderFile = 44;
  string TooLargeResponseBodyFile = 45;
  bool DisableRenderStyles = 46;

  // payloads (web fuzzer)
  repeated string Payloads = 47;
  int64 DurationMs = 48;
}

message FuzzableParam {
  string Position = 1;
  string ParamName = 2;
  bytes OriginValue = 3;
  bytes AutoTemplate = 4;
  bool IsHTTPS = 5;
}

message GetHTTPFlowBodyByIdResponse {
   bytes Data = 1;
   string Filename = 2; // 第一个响应里才有，应该保存的文件名
   bool EOF = 3; // 是否是最后一个包
}

message QueryHTTPFlowResponse {
  Paging Pagination = 1;
  repeated HTTPFlow Data = 2;
  int64 Total = 3;
}

message HTTPFlowsFieldGroupRequest {
  bool RefreshRequest = 1;
}

message HTTPFlowsFieldGroupResponse {
  repeated TagsCode Tags = 1;
  repeated TagsCode StatusCode = 2;
}

message HTTPFlowsShareRequest {
  repeated int64 Ids = 1;
  int64 LimitNum = 2;
  int64 ExpiredTime = 3;
  bool Pwd = 4;
  string ShareId = 5;
  string Token = 6;
  string Module = 7;
}

message HTTPFlowsShareResponse {
  string ShareId = 1;
  string ExtractCode = 2;
}

message HTTPFlowsExtractRequest {
  string ShareExtractContent = 1;
}

message TagsCode {
  string Value = 1;
  int32 Total = 2;
}

message WebsocketFlows {
  Paging Pagination = 1;
  repeated WebsocketFlow Data = 2;
  int64 Total = 4;
}

message WebsocketFlow {
  int64 ID = 1;
  int64 CreatedAt = 2;
  string WebsocketRequestHash = 3;
  int64 FrameIndex = 4;
  bool FromServer = 5;
  string MessageType = 6;
  bytes Data = 7;
  string DataSizeVerbose = 8;
  int64 DataLength = 9;
  string DataVerbose = 10;
  bool IsJson = 11;
  bool IsProtobuf = 12;
}

message SetMITMFilterRequest {
  repeated string includeHostname = 7;
  repeated string excludeHostname = 8;
  repeated string excludeSuffix = 9;
  repeated string includeSuffix = 10;
  repeated string excludeMethod = 11;
  repeated string excludeContentTypes = 40;
  repeated string excludeUri = 43;
  repeated string includeUri = 44;
}

message SetMITMFilterResponse {

}

// 中间人劫持的问题
message MITMRequest {
  // id 54
  bytes request = 1;
  bytes response = 111;

  string host = 2;
  uint32 port = 3;
  string downstreamProxy = 4;

  // 用来保证不要串台
  int64 id = 5;
  // 这个是响应劫持需要注意的字段。保证不串台
  int64 responseId = 16;
  bool recover = 6;

  // 过滤器
  repeated string includeHostname = 7;
  repeated string excludeHostname = 8;
  repeated string excludeSuffix = 9;
  repeated string includeSuffix = 10;
  repeated string excludeMethod = 11;
  repeated string excludeContentTypes = 40;
  repeated string excludeUri = 43;
  repeated string includeUri = 44;
  bool updateFilter = 12;

  bool hijackResponse = 13;
  bool cancelhijackResponse = 54;

  // 手动丢包
  bool drop = 14;

  // 原封不动放行
  bool forward = 15;

  // mitm plugin 中间人插件，本质上是一段 Yak 代码
  bool setYakScript = 21;
  repeated ExecParamItem yakScriptParams = 22;
  int64 yakScriptID = 23;
  string yakScriptContent = 25;

  // 查看当前启用插件
  bool getCurrentHook = 30;

  // 移除插件
  bool removeHook = 31;  // 当这个为 true 的时候，将会
  RemoveHookParams removeHookParams = 32;

  // 设置自动转发
  bool setAutoForward = 33;
  bool autoForwardValue = 34;

  // 设置清除上下文
  bool setClearMITMPluginContext = 35;

  // 设置启用插件模式，自动加载所有主插件。
  // 如果不设置 initPluginNames 的话，启动所有默认插件
  bool setPluginMode = 36;
  repeated string initPluginNames = 37;

  // 设置内容替代器
  bool setContentReplacers = 38;
  repeated MITMContentReplacer replacers = 39;

  // 恢复 filter, 防止用户删除了全部的 filter
  bool setResetFilter = 41;

  // enable h2
  bool enableHttp2 = 42;

  repeated Certificate certificates = 45;

  // gmtls config
  bool enableGMTLS = 46;
  bool onlyEnableGMTLS = 47;
  bool preferGMTLS = 48;

  // 代理用户名和密码
  string proxyUsername = 49;
  string proxyPassword = 50;
  bool enableProxyAuth = 51;
  repeated string dnsServers = 52;
  repeated KVPair hosts = 53;

  // max content-length
  int64 maxContentLength = 55;

  // 提前为此次flow设置tags
  repeated string Tags = 56;

  // 过滤 ws
  bool filterWebsocket = 57;
  bool updateFilterWebsocket = 58;

  // force close
  bool ForceDisableKeepAlive = 59;

  // runtime change proxy
  bool SetDownstreamProxy = 60;

  // disable MITM CA Cert Page
  bool DisableCACertPage = 61;

  // random JA3 fingerprint
  bool RandomJA3 = 62;
}

message Certificate {
  bytes CrtPem = 1;
  bytes KeyPem = 2;
  repeated bytes CaCertificates = 3;

  // pkcs12path need a .p12 or .pfx file
  bytes Pkcs12Bytes = 4;
  bytes Pkcs12Password = 5;
}

message MITMContentReplacer {
  // 如果是正则的话，就把匹配到的内容替换成对应结果
  // 优先 Golang 原生规则
  // 然后再是 Re2 规则
  // 然后子字符串
  string Rule = 1;

  // 这个功能意义在于，不要替代内容，仅标注颜色（敏感内容）
  bool NoReplace = 2;

  // 这里保存对应结果
  string Result = 3;

  // 选择替换之后的颜色
  string Color = 4;

  // 生效内容：默认对 body 生效
  bool EnableForRequest = 5;
  bool EnableForResponse = 6;
  bool EnableForHeader = 9;
  bool EnableForBody = 10;
  bool EnableForURI = 15;

  // Index
  int32 Index = 7;

  // 额外标签，用于标注 flow
  repeated string ExtraTag = 8;

  // 一键禁用启用全部
  bool Disabled = 11;

  // 展示名称，一般用于助记，不会有啥额外影响
  string VerboseName = 12;

  // 为数据包新增 Header
  repeated HTTPHeader ExtraHeaders = 13;
  repeated HTTPCookieSetting ExtraCookies = 14;

  // Action
  // 额外重复一次这个数据包（替换后的数据）
  // 只有替换数据
  bool ExtraRepeat = 16;
  // 匹配掉之后直接丢包
  bool Drop = 17;

}

message RemoveHookParams {
  bool ClearAll = 1;

  repeated string HookName = 2;
  repeated string RemoveHookID = 3;
}

message MITMResponse {
  bytes request = 1;

  // 劫持的是 HTTPS 吗？
  bool isHttps = 3;
  string url = 4;

  // 和 Request 中的一一对应
  int64 id = 5;

  // 过滤器
  bool justFilter = 16;
  repeated string includeHostname = 17;
  repeated string excludeHostname = 18;
  repeated string excludeSuffix = 19;
  repeated string includeSuffix = 110;
  repeated string excludeMethod = 111;
  repeated string excludeContentTypes = 113;
  repeated string excludeUri = 114;
  repeated string includeUri = 115;

  // 替代过滤器的内容
  bool justContentReplacer = 120;
  repeated MITMContentReplacer replacers = 121;

  // 刷新表格: 如果这个是 True 的话，那么不应该发送回劫持器，应该只发送刷新表格的信息
  bool refresh = 2;
  HTTPFlow historyHTTPFlow = 22;

  bool forResponse = 23;
  bytes response = 24;
  int64 responseId = 26;

  // exec result
  bool haveMessage = 27;
  ExecResult message = 28;

  bool getCurrentHook = 30;
  repeated YakScriptHooks hooks = 31;

  string RemoteAddr = 32;

  // 这里用来展示一些服务端通知，直接弹框就好
  bool haveNotification = 34;
  bytes notificationContent = 33;

  // 这两个标志是用来设置 MITM 加载状态的，用于服务端控制用户端的 "加载中"
  bool haveLoadingSetter = 35;
  bool loadingFlag = 36;

  // Websocket 相关配置
  bool isWebsocket = 37;
  repeated string websocketEncode = 38;
  // Websocket 传输的数据
  bytes Payload = 39;

  // 响应跟踪信息
  TraceInfo traceInfo = 40;
}

message TraceInfo {
  repeated string AvailableDNSServers = 1;
  int64 DurationMs = 2; // ServerTime
  int64 DNSDurationMs = 3; // DNSTime
  int64 ConnDurationMs = 4; // ConnTime
  int64 TotalDurationMs = 5; // TotalTime
}

message YakScriptHooks {
  string HookName = 1;
  repeated YakScriptHookItem Hooks = 2;
}

message YakScriptHookItem {
  int64 YakScriptId = 1;
  string YakScriptName = 2;
  string Verbose = 3;
}

// 最基础的 ECHO
message EchoRequest {
  string text = 1;
}

message EchoResposne {
  string result = 1;
}

// 开启一个端口，对接 GRPC 服务器
message Input {
  bytes raw = 1;

  string host = 2;
  uint32 port = 3;
  string path = 4;
  uint32 width = 5;
  uint32 height = 6;
}

message Output {
  bytes raw = 1;
  string remoteAddr = 11;
  string localAddr = 12;

  // 如果 control 为 true 说明这是一个控制信息
  bool control = 2;
  // 服务端需要关闭
  bool closed = 3;
  // 服务端正在等待连接接入
  bool waiting = 4;
}

// 执行脚本
message ExecParamItem {
  string Key = 1;
  string Value = 2;
}
message ExecRequest {
  // 执行优先级为：ScriptPath > Script > ScriptId 
  repeated ExecParamItem Params = 1;
  string Script = 2;
  string ScriptId = 3;
  int64 YakScriptId = 5;

  // 这个是为了满足 Runner 的情况，属于特殊情况
  string RunnerParamRaw = 6;
  bool NoDividedEngine = 7;

  string WorkDir = 8; // 工作目录
  string ScriptPath = 9; // 脚本位置
}

message ExecResult {
  string Hash = 1;
  string OutputJson = 2;
  bytes Raw = 3;
  bool IsMessage = 4;
  bytes Message = 5;

  // 如果是一个保存过的 ExecResult 他应该有数据库记录 ID
  int64 Id = 6;

  string RuntimeID = 7;
  float Progress = 8;
}

message GetLicenseResponse {
  string License = 1;
}

message CheckLicenseRequest {
  string LicenseActivation = 1;
  string CompanyVersion = 2;
}
message DefaultDnsServerResponse{
  repeated string DefaultDnsServer = 1;
}


message HTTPFlowBareRequest {
  int64 Id = 1;
  string BareType = 2;
}

message HTTPFlowBareResponse {
  int64 Id = 1;
  bytes Data = 2;
}
message ImportHTTPFuzzerTaskFromYamlRequest {
  string YamlContent = 1;
}
message ImportHTTPFuzzerTaskFromYamlResponse{
  GeneralResponse Status = 1;
  FuzzerRequests Requests = 2;
}
message ExportHTTPFuzzerTaskToYamlRequest{
  FuzzerRequests Requests = 1;
  string TemplateType = 2;
}
message ExportHTTPFuzzerTaskToYamlResponse{
  GeneralResponse Status = 1;
  string YamlContent = 2;
}

message RenderHTTPFuzzerPacketRequest {
  bytes Packet = 1;
}

message RenderHTTPFuzzerPacketResponse {
  bytes Packet = 1;
}

message SmokingEvaluatePluginBatchRequest {
  repeated string ScriptNames = 1;
}

message SmokingEvaluatePluginBatchResponse {
  double Progress = 1;
  string Message = 2;
  string MessageType = 3;
}

message GenerateURLRequest{
  string Scheme = 1;
  string Host = 2;
  int32 Port = 3;
  string Username = 4;
  string Password = 5;
}
message GenerateURLResponse{
  string URL = 1;
}

message YakVersionAtLeastRequest{
  string AtLeastVersion = 1;
  string YakVersion = 2;
}
message ParseTrafficRequest{
  int64 Id = 1;
  string Type = 2;
}
message ParseTrafficResponse{
  bool OK = 1;
  string Result = 2;
  string Message = 3;
}
message TraceRouteRequest{
  string Host = 1;
}
message TraceRouteResponse{
  string Ip = 1;
  int64 Rtt = 2;
  string Reason = 3;
  int64 Hop = 4;
}

message EvaluateExpressionRequest {
  string Expression = 1;
  repeated KVPair Variables = 2;
}

message EvaluateExpressionResponse {
  string Result = 1; // json marshal
  bool BoolResult = 2;
}

message EvaluateMultiExpressionRequest {
  repeated string Expressions = 1;
  repeated KVPair Variables = 2;
}

message EvaluateMultiExpressionResponse {
  repeated EvaluateExpressionResponse Results = 1;
}

message ThirdPartyAppConfigItemTemplate{
  bool Required = 2;
  string Name = 1;
  string Verbose = 7;
  string Type = 3;
  string DefaultValue = 4;
  string Desc = 5;
  string Extra = 6;
}

message GetThirdPartyAppConfigTemplate {
  string Name = 1;
  string Verbose = 2;
  string Type = 4;
  repeated ThirdPartyAppConfigItemTemplate Items = 3;
}
message GetThirdPartyAppConfigTemplateResponse{
  repeated GetThirdPartyAppConfigTemplate Templates = 2;
}
message GetFingerprintRequest{

}
message GetFingerprintResponse{

}
message AddFingerprintRequest{
  string Name = 1;
  string Fingerprint = 2;
}
message AddFingerprintResponse{

}
message ModifyFingerprintRequest{
}

message ModifyFingerprintResponse{

}

message ReadFileRequest {
  string FilePath = 1;
  int64 BufSize = 2;
  string FileSystem = 3; // "local" "ssadb"
}

message ReadFileResponse {
  bytes Data = 1;
  bool EOF = 2;
}

message GetReverseShellProgramListRequest{
  string System = 1;
  string CmdType = 2;
}

message GetReverseShellProgramListResponse{
  repeated string ProgramList = 1;
  repeated string ShellList = 2;
}
message GenerateReverseShellCommandRequest{
  string System = 1;
  string CmdType = 2;
  string ShellType = 4;
  string Encode = 5;
  string Program = 6;
  string IP = 7;
  int32 port = 8;
}

message GenerateReverseShellCommandResponse{
  GeneralResponse Status = 1;
  string Result = 2;
}