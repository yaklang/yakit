syntax = "proto3";

package ypb;
option go_package = "/;ypb";

message Empty {
}

message VersionResponse {
  string Version = 1;
}

message GeneralResponse {
  bool Ok = 1;
  string Reason = 2;
}

message DeleteYakScriptRequest {
  int64  Id = 3;
  repeated int64 Ids = 4;
}

message ExecBatchYakScriptRequest {
  // 目标会被自动拆分
  string Target = 1;
  string TargetFile = 11;

  // 额外参数可以被添加
  repeated ExecParamItem ExtraParams = 7;

  // 筛选与限制
  string Keyword = 2;
  repeated string ExcludedYakScript = 22;
  bool DisableNucleiWorkflow = 23;
  int64 Limit = 3;

  // 默认总用时
  int64 TotalTimeoutSeconds = 4;

  // 模块类型，默认为 nuclei
  string Type = 5;

  // 并发（进程）
  int64 Concurrent = 6;

  // 精确使用脚本名称
  // 要注意，这个 Scripts 和 PluginFilter 是冲突的
  repeated string ScriptNames = 8;

  // Tags with exclude / include
  QueryYakScriptRequest PluginFilter = 12;
  bool EnablePluginFilter = 13;

  // 设置一个代理
  string Proxy = 14;

  // 每个进程的任务数量
  int64 ProgressTaskCount = 15;

  // 基础进度 - 这个默认是 0.1 一般别用，只在 Recover 的时候可能才会有用处
  double BaseProgress = 16;
  // 这个很关键，不然会报错
  bool FromRecover = 17;

  string YakScriptOnlineGroup = 18;
  string TaskName = 19;
}

message ExecBatchYakScriptResult {
  string Id = 1;
  string Status = 2;
  bool Ok = 4;
  string Reason = 5;
  bool Exploitable = 6;

  // 脚本的详细信息
  YakScript PoC = 7;
  ExecResult Result = 8;

  // 如果是整体进度信息，则在这儿展示
  // 处理这几个消息的时候，其他都不应该生效
  bool ProgressMessage = 9;
  double ProgressPercent = 10;
  int64 ProgressTotal = 11;
  int64 ProgressCount = 12;

  // 正在执行中的进程数
  int64 ProgressRunning = 17;

  // 正在执行中的扫描任务数量
  int64 ScanTaskExecutingCount = 18;

  // 任务相关内容
  string Target = 13;
  repeated ExecParamItem ExtraParam = 14;
  string TaskId = 15;

  // 当前时间
  int64 Timestamp = 16;
}

message GetYakScriptByIdRequest {
  int64 Id = 1;
}

message GetYakScriptByNameRequest {
  string Name = 1;
  string UUID = 2;
}

message GetYakScriptByOnlineIDRequest {
  string UUID = 1;
  int64 OnlineID = 2;
}


message VerifySystemCertificateResponse {
  bool valid = 1;
  string Reason = 2;
}

service Yak {
  // version
  rpc Version(Empty) returns (VersionResponse);
  rpc YakVersionAtLeast(YakVersionAtLeastRequest) returns (GeneralResponse);

  // echo 通常用于测试服务是否通畅
  rpc Echo(EchoRequest) returns(EchoResposne);

  // 握手 用于检查前端是否可以连接当前引擎 
  rpc Handshake(HandshakeRequest) returns (HandshakeResponse);

  rpc VerifySystemCertificate(Empty) returns (VerifySystemCertificateResponse);
  rpc InstallMITMCertificate(Empty) returns (GeneralResponse);

  // 中间人劫持
  rpc MITM(stream MITMRequest) returns (stream MITMResponse);
  rpc SetMITMFilter(SetMITMFilterRequest) returns (SetMITMFilterResponse);
  rpc GetMITMFilter(Empty) returns (SetMITMFilterRequest);
  rpc ResetMITMFilter(Empty) returns (SetMITMFilterRequest); //重置MITM启动前的过滤器
  rpc DownloadMITMCert(Empty) returns (MITMCert);
  rpc DownloadMITMGMCert(Empty) returns (MITMCert);

  rpc MITMV2(stream MITMV2Request) returns (stream MITMV2Response);

  // 开启端口
  rpc OpenPort(stream Input) returns (stream Output);

  // Exec
  rpc Exec(ExecRequest) returns (stream ExecResult);
  rpc QueryExecHistory(ExecHistoryRequest) returns (ExecHistoryRecordResponse);
  rpc RemoveExecHistory(Empty) returns (Empty);
  rpc LoadNucleiTemplates(Empty) returns (Empty);
  rpc AutoUpdateYakModule(Empty) returns (stream ExecResult);
  rpc ExecYakScript(ExecRequest) returns (stream ExecResult);

  // ExecBatch Script
  rpc ExecBatchYakScript(ExecBatchYakScriptRequest) returns (stream ExecBatchYakScriptResult);
  rpc GetExecBatchYakScriptUnfinishedTask(Empty) returns (GetExecBatchYakScriptUnfinishedTaskResponse);
  rpc GetExecBatchYakScriptUnfinishedTaskByUid(GetExecBatchYakScriptUnfinishedTaskByUidRequest) returns (ExecBatchYakScriptRequest);
  rpc PopExecBatchYakScriptUnfinishedTaskByUid(GetExecBatchYakScriptUnfinishedTaskByUidRequest) returns (ExecBatchYakScriptRequest);
  rpc RecoverExecBatchYakScriptUnfinishedTask(RecoverExecBatchYakScriptUnfinishedTaskRequest) returns (stream ExecBatchYakScriptResult);

  // yakScript
  rpc QueryYakScript(QueryYakScriptRequest) returns (QueryYakScriptResponse);
  rpc QueryYakScriptByYakScriptName(QueryYakScriptRequest) returns (stream YakScript);
  rpc SaveYakScript(YakScript) returns (YakScript);
  rpc DeleteYakScript(DeleteYakScriptRequest) returns (Empty);
  rpc GetYakScriptById(GetYakScriptByIdRequest) returns (YakScript);
  rpc GetYakScriptByName(GetYakScriptByNameRequest) returns (YakScript);
  rpc GetYakScriptByOnlineID(GetYakScriptByOnlineIDRequest) returns (YakScript);
  rpc IgnoreYakScript(DeleteYakScriptRequest) returns (Empty);
  rpc UnIgnoreYakScript(DeleteYakScriptRequest) returns (Empty);
  rpc ExportYakScript(ExportYakScriptRequest) returns (ExportYakScriptResponse);
  rpc ExportYakScriptStream(ExportYakScriptStreamRequest) returns (stream ExecResult);
  rpc ImportYakScriptStream(ImportYakScriptStreamRequest) returns (stream ExecResult);
  rpc ExecutePacketYakScript(ExecutePacketYakScriptParams) returns (stream ExecResult);
  rpc ExecuteBatchPacketYakScript(ExecuteBatchPacketYakScriptParams) returns (stream ExecBatchYakScriptResult);
  rpc GetYakScriptTags(Empty) returns (GetYakScriptTagsResponse);
  rpc QueryYakScriptLocalAndUser(QueryYakScriptLocalAndUserRequest) returns (QueryYakScriptLocalAndUserResponse);
  rpc QueryYakScriptByOnlineGroup(QueryYakScriptByOnlineGroupRequest) returns (QueryYakScriptLocalAndUserResponse);
  rpc QueryYakScriptLocalAll(Empty) returns (QueryYakScriptLocalAndUserResponse);
  rpc QueryYakScriptByNames(QueryYakScriptByNamesRequest) returns (QueryYakScriptByNamesResponse);
  rpc QueryYakScriptByIsCore(QueryYakScriptByIsCoreRequest) returns (QueryYakScriptByIsCoreResponse);
  // 接口废弃
  rpc QueryYakScriptRiskDetailByCWE(QueryYakScriptRiskDetailByCWERequest) returns (QueryYakScriptRiskDetailByCWEResponse);
  // 接口废弃
  rpc YakScriptRiskTypeList(Empty) returns (YakScriptRiskTypeListResponse);
  rpc SaveNewYakScript(SaveNewYakScriptRequest) returns (YakScript);
  rpc SaveYakScriptToOnline(SaveYakScriptToOnlineRequest) returns (stream SaveYakScriptToOnlineResponse);

  // 结构变化,接口废弃
  rpc ExportLocalYakScript(ExportLocalYakScriptRequest) returns (ExportLocalYakScriptResponse);
  rpc ExportLocalYakScriptStream(ExportLocalYakScriptRequest) returns (stream ExportYakScriptLocalResponse);

  rpc ImportYakScript(ImportYakScriptRequest) returns (stream ImportYakScriptResult);
  rpc SetYakScriptSkipUpdate(SetYakScriptSkipUpdateRequest) returns (Empty);
  rpc QueryYakScriptSkipUpdate(QueryYakScriptRequest) returns (QueryYakScriptSkipUpdateResponse);

  // YakScript Group
  rpc QueryYakScriptGroup(QueryYakScriptGroupRequest) returns (QueryYakScriptGroupResponse);
  rpc SaveYakScriptGroup(SaveYakScriptGroupRequest) returns (Empty);
  rpc RenameYakScriptGroup(RenameYakScriptGroupRequest) returns (Empty);
  rpc DeleteYakScriptGroup(DeleteYakScriptGroupRequest) returns (Empty);
  rpc GetYakScriptGroup(QueryYakScriptRequest) returns (GetYakScriptGroupResponse);
  rpc ResetYakScriptGroup(ResetYakScriptGroupRequest) returns (Empty);
  rpc SetGroup(SetGroupRequest) returns (Empty);


  // HTTPFlow
  rpc GetHTTPFlowByHash(GetHTTPFlowByHashRequest) returns (HTTPFlow);
  rpc GetHTTPFlowById(GetHTTPFlowByIdRequest) returns (HTTPFlow);
  rpc GetHTTPFlowBodyById(GetHTTPFlowBodyByIdRequest) returns (stream GetHTTPFlowBodyByIdResponse);
  rpc GetHTTPFlowByIds(GetHTTPFlowByIdsRequest) returns (HTTPFlows);
  rpc QueryHTTPFlows(QueryHTTPFlowRequest) returns (QueryHTTPFlowResponse);
  rpc DeleteHTTPFlows(DeleteHTTPFlowRequest) returns (Empty);
  rpc SetTagForHTTPFlow(SetTagForHTTPFlowRequest) returns (Empty);
  rpc QueryHTTPFlowsIds(QueryHTTPFlowsIdsRequest) returns (QueryHTTPFlowsIdsResponse);
  rpc HTTPFlowsFieldGroup(HTTPFlowsFieldGroupRequest) returns (HTTPFlowsFieldGroupResponse);
  rpc HTTPFlowsShare(HTTPFlowsShareRequest) returns (HTTPFlowsShareResponse);
  rpc HTTPFlowsExtract(HTTPFlowsExtractRequest) returns (Empty);
  rpc GetHTTPFlowBare(HTTPFlowBareRequest) returns (HTTPFlowBareResponse);
  rpc ExportHTTPFlows(ExportHTTPFlowsRequest) returns(QueryHTTPFlowResponse);
  rpc HTTPFlowsToOnline(HTTPFlowsToOnlineRequest) returns (Empty);
  rpc QueryHTTPFlowsProcessNames(QueryHTTPFlowRequest) returns (QueryHTTPFlowsProcessNamesResponse);
  rpc HTTPFlowsToOnlineBatch(HTTPFlowsToOnlineBatchRequest) returns (HTTPFlowsToOnlineBatchResponse);

  // 流量分析器
  rpc AnalyzeHTTPFlow(AnalyzeHTTPFlowRequest) returns (stream AnalyzeHTTPFlowResponse);
  // 从一个 FuzzerRequest 中提取 Url
  rpc ExtractUrl(FuzzerRequest) returns (ExtractedUrl);

  // Fuzzer
  rpc GetHistoryHTTPFuzzerTask(GetHistoryHTTPFuzzerTaskRequest) returns (HistoryHTTPFuzzerTaskDetail);
  rpc QueryHistoryHTTPFuzzerTask(Empty) returns (HistoryHTTPFuzzerTasks);
  rpc QueryHistoryHTTPFuzzerTaskEx(QueryHistoryHTTPFuzzerTaskExParams) returns (HistoryHTTPFuzzerTasksResponse);
  rpc DeleteHistoryHTTPFuzzerTask(DeleteHistoryHTTPFuzzerTaskRequest) returns (Empty);
  rpc HTTPFuzzer(FuzzerRequest) returns (stream FuzzerResponse);
  rpc HTTPFuzzerSequence(FuzzerRequests) returns (stream FuzzerSequenceResponse);
  rpc HTTPFuzzerGroup(GroupHTTPFuzzerRequest) returns (stream GroupHTTPFuzzerResponse);
  rpc PreloadHTTPFuzzerParams(PreloadHTTPFuzzerParamsRequest) returns (PreloadHTTPFuzzerParamsResponse);
  rpc RenderVariables(RenderVariablesRequest) returns (RenderVariablesResponse);
  rpc MatchHTTPResponse(MatchHTTPResponseParams) returns (MatchHTTPResponseResult);
  rpc ExtractHTTPResponse(ExtractHTTPResponseParams) returns (ExtractHTTPResponseResult);
  rpc RedirectRequest(RedirectRequestParams) returns (FuzzerResponse);
  rpc HTTPRequestMutate(HTTPRequestMutateParams) returns (MutateResult);
  rpc HTTPResponseMutate(HTTPResponseMutateParams) returns (MutateResult);
  rpc FixUploadPacket(FixUploadPacketRequest) returns (FixUploadPacketResponse);
  rpc IsMultipartFormDataRequest(FixUploadPacketRequest) returns (IsMultipartFormDataRequestResult);
  rpc GenerateExtractRule(GenerateExtractRuleRequest) returns (GenerateExtractRuleResponse);
  rpc ExtractData(stream ExtractDataRequest) returns (stream ExtractDataResponse);
  rpc ImportHTTPFuzzerTaskFromYaml(ImportHTTPFuzzerTaskFromYamlRequest) returns (ImportHTTPFuzzerTaskFromYamlResponse);
  rpc ExportHTTPFuzzerTaskToYaml(ExportHTTPFuzzerTaskToYamlRequest) returns (ExportHTTPFuzzerTaskToYamlResponse);
  rpc RenderHTTPFuzzerPacket(RenderHTTPFuzzerPacketRequest) returns (RenderHTTPFuzzerPacketResponse);

  rpc SaveFuzzerLabel(SaveFuzzerLabelRequest) returns (Empty);
  rpc QueryFuzzerLabel(Empty) returns (QueryFuzzerLabelResponse);
  rpc DeleteFuzzerLabel(DeleteFuzzerLabelRequest) returns (Empty);

  rpc SaveFuzzerConfig(SaveFuzzerConfigRequest) returns (DbOperateMessage);
  rpc QueryFuzzerConfig(QueryFuzzerConfigRequest) returns (QueryFuzzerConfigResponse);
  rpc DeleteFuzzerConfig(DeleteFuzzerConfigRequest) returns (DbOperateMessage);

  // HTTPFuzzerResponse
  // 这个挺特殊的，因为数据包太多了，会卡，所以后端会保存一份，通过这个接口做缓存查询
  rpc QueryHTTPFuzzerResponseByTaskId(QueryHTTPFuzzerResponseByTaskIdRequest) returns (QueryHTTPFuzzerResponseByTaskIdResponse) ;

  // WebSocket
  rpc CreateWebsocketFuzzer(stream ClientWebsocketRequest) returns (stream ClientWebsocketResponse);
  rpc QueryWebsocketFlowByHTTPFlowWebsocketHash(QueryWebsocketFlowByHTTPFlowWebsocketHashRequest) returns (WebsocketFlows);
  rpc DeleteWebsocketFlowByHTTPFlowWebsocketHash(DeleteWebsocketFlowByHTTPFlowWebsocketHashRequest) returns (Empty);
  rpc DeleteWebsocketFlowAll(Empty) returns (Empty);

  // FuzzerResponse 对象转 HTTPFlow：以便分析和模糊测试
  rpc ConvertFuzzerResponseToHTTPFlow(FuzzerResponse) returns (HTTPFlow);

  // 渲染 Fuzzer 模版
  rpc StringFuzzer(StringFuzzerRequest) returns (StringFuzzerResponse);

  // 分析一个 HTTP 请求详情
  rpc HTTPRequestAnalyzer(HTTPRequestAnalysisMaterial) returns (HTTPRequestAnalysis);

  // 用户自定义代码补全
  rpc CreateSnippet(SnippetsRequest) returns (Empty);
  rpc UpdateSnippet(EditSnippetsRequest) returns (Empty);
  rpc DeleteSnippets(QuerySnippetsRequest) returns (Empty);
  rpc QuerySnippets(QuerySnippetsRequest) returns (SnippetsResponse);

  // 编码解码
  rpc Codec(CodecRequest) returns (CodecResponse);
  rpc NewCodec(CodecRequestFlow) returns (CodecResponse);
  rpc GetAllCodecMethods(Empty) returns(CodecMethods);

  rpc SaveCodecFlow(CustomizeCodecFlow) returns (Empty);
  rpc UpdateCodecFlow(UpdateCodecFlowRequest) returns (Empty);
  rpc DeleteCodecFlow(DeleteCodecFlowRequest) returns (Empty);
  rpc GetAllCodecFlow(Empty) returns (GetCodecFlowResponse);
  rpc PacketPrettifyHelper(PacketPrettifyHelperRequest) returns (PacketPrettifyHelperResponse);

  // Payload 相关接口
  // database payload group
  rpc QueryPayload(QueryPayloadRequest) returns (QueryPayloadResponse); // query by [keyword/group/folder]
  rpc QueryPayloadFromFile(QueryPayloadFromFileRequest) returns (QueryPayloadFromFileResponse);
  // delete by [id/group/folder]
  rpc DeletePayloadByFolder(NameRequest) returns (Empty);
  rpc DeletePayloadByGroup(DeletePayloadByGroupRequest) returns (Empty);
  rpc DeletePayload(DeletePayloadRequest) returns (Empty);
  // save payload to database
  rpc SavePayload(SavePayloadRequest) returns (Empty);
  rpc SavePayloadStream(SavePayloadRequest) returns (stream SavePayloadProgress);
  rpc SavePayloadToFileStream(SavePayloadRequest) returns (stream SavePayloadProgress);
  rpc SaveLargePayloadToFileStream(SavePayloadRequest) returns (stream SavePayloadProgress);
  // update group/folder/payload
  rpc RenamePayloadFolder(RenameRequest) returns (Empty);
  rpc RenamePayloadGroup(RenameRequest) returns (Empty); // rename
  rpc UpdatePayload(UpdatePayloadRequest) returns (Empty); // edit
  rpc UpdatePayloadToFile(UpdatePayloadToFileRequest) returns (Empty);
  rpc BackUpOrCopyPayloads(BackUpOrCopyPayloadsRequest) returns (Empty);
  // Folder and Group
  // get and update all group with order
  rpc GetAllPayloadGroup(Empty) returns (GetAllPayloadGroupResponse);
  rpc UpdateAllPayloadGroup(UpdateAllPayloadGroupRequest) returns (Empty);
  // get payload
  rpc GetAllPayload(GetAllPayloadRequest) returns (GetAllPayloadResponse); // !已弃用 get payload by [group/folder]
  rpc GetAllPayloadFromFile(GetAllPayloadRequest) returns (stream GetAllPayloadFromFileResponse); // !已弃用 get payload by [group/folder] from file
  // export payload
  rpc ExportAllPayload(GetAllPayloadRequest) returns (stream GetAllPayloadResponse); // get payload by [group/folder]
  rpc ExportAllPayloadFromFile(GetAllPayloadRequest) returns (stream GetAllPayloadResponse); // get payload by [group/folder] from file
  // create folder
  rpc CreatePayloadFolder(NameRequest) returns (Empty);
  // 去重
  rpc RemoveDuplicatePayloads(NameRequest) returns (stream SavePayloadProgress);
  // 转换为数据库保存
  rpc CoverPayloadGroupToDatabase(NameRequest) returns (stream SavePayloadProgress); // !已弃用
  rpc ConvertPayloadGroupToDatabase(NameRequest) returns (stream SavePayloadProgress);
  // 迁移旧的payload
  rpc MigratePayloads(Empty) returns (stream SavePayloadProgress);

  // 批量导payload 数据库 已废弃
  rpc ExportPayloadBatch(ExportPayloadBatchRequest) returns (stream GetAllPayloadResponse);
  rpc UploadPayloadToOnline(UploadPayloadToOnlineRequest) returns (stream DownloadProgress);
  rpc DownloadPayload(DownloadPayloadRequest) returns (stream DownloadProgress);
  // 批量导payload所有
  rpc ExportPayloadDBAndFile(ExportPayloadDBAndFileRequest) returns (stream GetAllPayloadResponse);


  // 自动生成补全
  rpc GetYakitCompletionRaw(Empty) returns (YakitCompletionRawResponse);
  rpc GetYakVMBuildInMethodCompletion(GetYakVMBuildInMethodCompletionRequest) returns (GetYakVMBuildInMethodCompletionResponse);
  rpc StaticAnalyzeError(StaticAnalyzeErrorRequest) returns (StaticAnalyzeErrorResponse);
  rpc YaklangCompileAndFormat(YaklangCompileAndFormatRequest) returns (YaklangCompileAndFormatResponse);

  // LSP
  rpc YaklangLanguageSuggestion(YaklangLanguageSuggestionRequest) returns (YaklangLanguageSuggestionResponse);
  rpc YaklangLanguageFind(YaklangLanguageSuggestionRequest) returns (YaklangLanguageFindResponse);

  //fuzztag suggestion
  rpc FuzzTagSuggestion(FuzzTagSuggestionRequest) returns (YaklangLanguageSuggestionResponse);

  // 从代码中提取yaklang数据
  rpc YaklangInspectInformation(YaklangInspectInformationRequest) returns (YaklangInspectInformationResponse);
  // 进行数据迁移使用
  rpc YaklangGetCliCodeFromDatabase(YaklangGetCliCodeFromDatabaseRequest) returns (YaklangGetCliCodeFromDatabaseResponse);
  // editor terminal 交互
  rpc YaklangTerminal(stream Input) returns (stream Output);

  // 端口扫描的封装
  rpc PortScan(PortScanRequest) returns (stream ExecResult);
  rpc ViewPortScanCode(Empty) returns (SimpleScript);

  rpc SimpleDetect(RecordPortScanRequest) returns (stream ExecResult);
  rpc SaveCancelSimpleDetect(RecordPortScanRequest) returns (Empty);
  rpc SimpleDetectCreatReport(CreatReportRequest) returns (stream ExecResult);

  // new interface
  rpc QuerySimpleDetectUnfinishedTask(QueryUnfinishedTaskRequest) returns (QueryUnfinishedTaskResponse);
  rpc GetSimpleDetectRecordRequestById(GetUnfinishedTaskDetailByIdRequest) returns (RecordPortScanRequest);
  rpc DeleteSimpleDetectUnfinishedTask(DeleteUnfinishedTaskRequest) returns (Empty);
  rpc RecoverSimpleDetectTask(RecoverUnfinishedTaskRequest) returns (stream ExecResult);
  //----

  // Deprecated interface
  rpc GetSimpleDetectUnfinishedTask(Empty) returns (GetSimpleDetectUnfinishedTaskResponse);
  rpc GetSimpleDetectUnfinishedTaskByUid(GetExecBatchYakScriptUnfinishedTaskByUidRequest) returns (RecordPortScanRequest);
  rpc PopSimpleDetectUnfinishedTaskByUid(GetExecBatchYakScriptUnfinishedTaskByUidRequest) returns (RecordPortScanRequest);
  rpc RecoverSimpleDetectUnfinishedTask(RecoverExecBatchYakScriptUnfinishedTaskRequest) returns (stream ExecResult);
  // ----

  // 资产管理
  rpc QueryPorts(QueryPortsRequest) returns (QueryPortsResponse);
  rpc DeletePorts(DeletePortsRequest) returns (Empty);
  rpc QueryHosts(QueryHostsRequest) returns (QueryHostsResponse);
  rpc DeleteHosts(DeleteHostsRequest) returns (Empty);
  rpc QueryDomains(QueryDomainsRequest) returns(QueryDomainsResponse);
  rpc DeleteDomains(DeleteDomainsRequest)returns(Empty);
  rpc QueryPortsGroup(Empty)returns (QueryPortsGroupResponse);

  // Yakit Store
  rpc UpdateFromYakitResource(UpdateFromYakitResourceRequest) returns (Empty);
  rpc UpdateFromGithub(UpdateFromGithubRequest) returns (Empty);

  // Menu
  rpc AddToMenu(AddToMenuRequest) returns (Empty);
  rpc RemoveFromMenu(RemoveFromMenuRequest) returns (Empty);
  rpc YakScriptIsInMenu(YakScriptIsInMenuRequest) returns (Empty);
  rpc GetAllMenuItem(Empty) returns (MenuByGroup);
  rpc DeleteAllMenuItem(Empty) returns (Empty);
  rpc ImportMenuItem(ImportMenuItemRequest) returns (Empty);
  rpc ExportMenuItem(Empty) returns (ExportMenuItemResult);
  rpc GetMenuItemById(GetMenuItemByIdRequest) returns (MenuItem);
  rpc QueryGroupsByYakScriptId(QueryGroupsByYakScriptIdRequest) returns (GroupNames);
  rpc AddMenus(AddMenuRequest) returns (Empty);
  rpc QueryAllMenuItem(QueryAllMenuItemRequest) returns (MenuByGroup);
  rpc DeleteAllMenu(QueryAllMenuItemRequest) returns (Empty);

  // NewMenu
  rpc AddToNavigation(AddToNavigationRequest) returns (Empty);
  rpc GetAllNavigationItem(GetAllNavigationRequest) returns (GetAllNavigationItemResponse);
  rpc DeleteAllNavigation(GetAllNavigationRequest) returns (Empty);
  rpc AddOneNavigation(AddOneNavigationRequest) returns (Empty);
  rpc QueryNavigationGroups(QueryNavigationGroupsRequest) returns (GroupNames);

  // document
  rpc SaveMarkdownDocument(SaveMarkdownDocumentRequest) returns (Empty);
  rpc GetMarkdownDocument(GetMarkdownDocumentRequest) returns (GetMarkdownDocumentResponse);
  rpc DeleteMarkdownDocument(GetMarkdownDocumentRequest) returns (Empty);

  // Crawler
  rpc StartBasicCrawler(StartBasicCrawlerRequest)returns (ExecResult);
  rpc ViewBasicCrawlerCode(Empty) returns (SimpleScript);
  rpc GenerateWebsiteTree(GenerateWebsiteTreeRequest) returns (GenerateWebsiteTreeResponse);

  // 对插件结果的操作
  rpc QueryYakScriptExecResult(QueryYakScriptExecResultRequest) returns (QueryYakScriptExecResultResponse);
  rpc QueryYakScriptNameInExecResult(Empty) returns (YakScriptNames);
  rpc DeleteYakScriptExecResult(DeleteYakScriptExecResultRequest) returns (Empty);
  rpc DeleteYakScriptExec(Empty) returns (Empty);

  // Bruter
  rpc StartBrute(StartBruteParams) returns (stream ExecResult);
  rpc GetAvailableBruteTypes(Empty) returns (GetAvailableBruteTypesResponse);

  // Tunnel Server RMI/DNSLog
  rpc GetTunnelServerExternalIP(GetTunnelServerExternalIPParams) returns (GetTunnelServerExternalIPResponse);
  rpc VerifyTunnelServerDomain(VerifyTunnelServerDomainParams) returns (VerifyTunnelServerDomainResponse) ;
  rpc StartFacades(StartFacadesParams) returns (stream ExecResult);
  rpc StartFacadesWithYsoObject(StartFacadesWithYsoParams) returns (stream ExecResult);
  rpc ApplyClassToFacades(ApplyClassToFacadesParamsWithVerbose) returns (Empty);
  rpc BytesToBase64(BytesToBase64Request) returns (BytesToBase64Response);
  rpc ConfigGlobalReverse(ConfigGlobalReverseParams) returns (stream Empty);
  rpc AvailableLocalAddr(Empty) returns (AvailableLocalAddrResponse);
  rpc GetGlobalReverseServer(Empty) returns (GetGlobalReverseServerResponse);

  // Risk
  rpc QueryRisks(QueryRisksRequest) returns (QueryRisksResponse);
  rpc QueryRisk(QueryRiskRequest) returns (Risk);
  rpc DeleteRisk(DeleteRiskRequest) returns (Empty);
  rpc QueryAvailableRiskType(Empty) returns (Fields);
  rpc QueryAvailableRiskLevel(Empty) returns (Fields);
  rpc QueryRiskTableStats(Empty) returns (RiskTableStats);
  rpc ResetRiskTableStats(Empty) returns (Empty);
  rpc QueryAvailableTarget(Empty) returns (Fields);
  rpc QueryNewRisk(QueryNewRiskRequest) returns (QueryNewRiskResponse);
  rpc NewRiskRead(NewRiskReadRequest) returns (Empty);
  // 风险漏洞自动同步
  rpc UploadRiskToOnline(UploadRiskToOnlineRequest) returns (Empty);
  rpc SetTagForRisk(SetTagForRiskRequest) returns (Empty);
  rpc QueryRiskTags(Empty) returns (QueryRiskTagsResponse);
  rpc RiskFieldGroup(Empty) returns (RiskFieldGroupResponse);
  // 误报反馈
  rpc RiskFeedbackToOnline(UploadRiskToOnlineRequest) returns (Empty);

  // Report
  rpc QueryReports(QueryReportsRequest) returns(QueryReportsResponse);
  rpc QueryReport(QueryReportRequest) returns (Report);
  rpc DeleteReport(DeleteReportRequest) returns (Empty);
  rpc QueryAvailableReportFrom(Empty) returns (Fields); // no implement

  rpc DownloadReport(DownloadReportRequest) returns (Empty);

  //Yso
  rpc GetAllYsoGadgetOptions(Empty) returns (YsoOptionsWithVerbose);
  rpc GetAllYsoClassOptions(YsoOptionsRequerstWithVerbose) returns (YsoOptionsWithVerbose);
  rpc GetAllYsoClassGeneraterOptions(YsoOptionsRequerstWithVerbose) returns (YsoClassOptionsResponseWithVerbose);
  rpc GenerateYsoCode(YsoOptionsRequerstWithVerbose) returns (YsoCodeResponse);
  rpc GenerateYsoBytes(YsoOptionsRequerstWithVerbose) returns (YsoBytesResponse);
  rpc YsoDump(YsoBytesObject)returns(YsoDumpResponse);

  // WebShell
  rpc CreateWebShell(WebShell) returns (WebShell);
  rpc DeleteWebShell(DeleteWebShellRequest) returns (Empty);
  rpc UpdateWebShell(WebShell) returns (WebShell);
  rpc QueryWebShells(QueryWebShellsRequest) returns (QueryWebShellsResponse);
  rpc Ping(WebShellRequest) returns (WebShellResponse);
  rpc GetBasicInfo(WebShellRequest) returns (WebShellResponse);
  rpc GenerateWebShell(ShellGenerate) returns(WebShellResponse);

  // DNSLog / ICMP / RandomTrigger
  rpc SetYakBridgeLogServer(YakDNSLogBridgeAddr) returns (Empty);
  rpc GetCurrentYakBridgeLogServer(Empty) returns (YakDNSLogBridgeAddr);
  rpc RequireDNSLogDomain(YakDNSLogBridgeAddr) returns (DNSLogRootDomain);
  rpc RequireDNSLogDomainByScript(RequireDNSLogDomainByScriptRequest) returns (DNSLogRootDomain);
  rpc QueryDNSLogByToken(QueryDNSLogByTokenRequest) returns (QueryDNSLogByTokenResponse);
  rpc QueryDNSLogTokenByScript(RequireDNSLogDomainByScriptRequest) returns (QueryDNSLogByTokenResponse);
  rpc RequireICMPRandomLength(Empty) returns (RequireICMPRandomLengthResponse);
  rpc QueryICMPTrigger(QueryICMPTriggerRequest) returns (QueryICMPTriggerResponse);
  rpc RequireRandomPortToken(Empty) returns (RandomPortInfo);
  rpc QueryRandomPortTrigger(QueryRandomPortTriggerRequest) returns (RandomPortTriggerNotification);
  rpc QuerySupportedDnsLogPlatforms(Empty) returns (QuerySupportedDnsLogPlatformsResponse);

  // 获取 Tags
  rpc GetAvailableYakScriptTags(Empty) returns (Fields);
  rpc ForceUpdateAvailableYakScriptTags(Empty) returns (Empty);

  // 通用的漏洞检测技术方案
  rpc ExecYakitPluginsByYakScriptFilter(ExecYakitPluginsByYakScriptFilterRequest) returns (stream ExecResult);

  // GenerateYakCodeByPacket
  rpc GenerateYakCodeByPacket(GenerateYakCodeByPacketRequest) returns (GenerateYakCodeByPacketResponse);

  // CSRF Generator
  rpc GenerateCSRFPocByPacket(GenerateCSRFPocByPacketRequest) returns (GenerateCSRFPocByPacketResponse);

  // MITM 衍生功能：
  // Replacers 管理
  rpc ExportMITMReplacerRules(Empty) returns (ExportMITMReplacerRulesResponse);
  rpc ImportMITMReplacerRules(ImportMITMReplacerRulesRequest) returns (Empty);
  rpc GetCurrentRules(Empty) returns (MITMContentReplacers);
  rpc SetCurrentRules(MITMContentReplacers) returns (Empty);
  rpc QueryMITMReplacerRules(QueryMITMReplacerRulesRequest) returns (QueryMITMReplacerRulesResponse);
  rpc GenerateURL(GenerateURLRequest) returns (GenerateURLResponse);

  rpc ExtractDataToFile(stream ExtractDataToFileRequest) returns (stream ExtractDataToFileResult);

  // 尝试自动解码
  rpc AutoDecode(AutoDecodeRequest) returns (AutoDecodeResponse);

  rpc GetSystemProxy(Empty) returns (GetSystemProxyResult);
  rpc SetSystemProxy(SetSystemProxyRequest) returns (Empty);

  // 设置通用存储
  rpc GetKey(GetKeyRequest) returns (GetKeyResult);
  rpc SetKey(SetKeyRequest) returns (Empty);
  rpc DelKey(GetKeyRequest) returns (Empty);
  rpc GetAllProcessEnvKey(Empty) returns (GetProcessEnvKeyResult);
  rpc SetProcessEnvKey(SetKeyRequest) returns (Empty);

  rpc GetProjectKey(GetKeyRequest) returns (GetKeyResult);
  rpc SetProjectKey(SetKeyRequest) returns (Empty);

  // Online
  rpc GetOnlineProfile(Empty) returns (OnlineProfile);
  rpc SetOnlineProfile(OnlineProfile) returns (Empty);
  // 废弃接口
  rpc DownloadOnlinePluginById(DownloadOnlinePluginByIdRequest) returns (Empty);
  // 废弃接口
  rpc DownloadOnlinePluginByIds(DownloadOnlinePluginByIdsRequest) returns (Empty);
  // 废弃接口
  rpc DownloadOnlinePluginAll(DownloadOnlinePluginByTokenRequest) returns (stream DownloadOnlinePluginProgress);
  rpc DeletePluginByUserID(DeletePluginByUserIDRequest) returns (Empty);
  rpc DeleteAllLocalPlugins(Empty) returns (Empty);
  rpc GetYakScriptTagsAndType(Empty) returns (GetYakScriptTagsAndTypeResponse);
  rpc DeleteLocalPluginsByWhere(DeleteLocalPluginsByWhereRequest) returns (Empty);
  // 废弃接口
  rpc DownloadOnlinePluginByScriptNames(DownloadOnlinePluginByScriptNamesRequest) returns (DownloadOnlinePluginByScriptNamesResponse);
  // NewOnline 插件下载
  rpc DownloadOnlinePlugins(DownloadOnlinePluginsRequest) returns(stream DownloadOnlinePluginProgress);
  rpc DownloadOnlinePluginBatch(DownloadOnlinePluginsRequest) returns (Empty);
  rpc DownloadOnlinePluginByPluginName(DownloadOnlinePluginByScriptNamesRequest) returns (DownloadOnlinePluginByScriptNamesResponse);
  rpc DownloadOnlinePluginByUUID(DownloadOnlinePluginByUUIDRequest) returns (YakScript);

  rpc QueryOnlinePlugins(QueryOnlinePluginsRequest) returns(QueryOnlinePluginsResponse);


  // 新的扫描模式
  rpc ExecPacketScan(ExecPacketScanRequest) returns (stream ExecResult);

  rpc GetEngineDefaultProxy(Empty) returns (DefaultProxyResult);
  rpc SetEngineDefaultProxy(DefaultProxyResult) returns (Empty);

  // machine id
  rpc GetMachineID(Empty) returns (GetMachineIDResponse);

  // license
  rpc GetLicense(Empty) returns (GetLicenseResponse);
  rpc CheckLicense(CheckLicenseRequest) returns (Empty);

  // Response Body 的魔法操作
  rpc GetRequestBodyByHTTPFlowID(DownloadBodyByHTTPFlowIDRequest) returns (Bytes);
  rpc GetResponseBodyByHTTPFlowID(DownloadBodyByHTTPFlowIDRequest) returns (Bytes);
  rpc GetHTTPPacketBody(GetHTTPPacketBodyRequest) returns (Bytes);

  // 注册一个 Facades HTTP 响应
  rpc RegisterFacadesHTTP(RegisterFacadesHTTPRequest) returns (RegisterFacadesHTTPResponse);

  // 重置到恢复出厂设置
  rpc ResetAndInvalidUserData(ResetAndInvalidUserDataRequest) returns (Empty);

  // Yaklang Shell
  // 创建一个交互式 Shell
  rpc CreateYaklangShell(stream YaklangShellRequest) returns (stream YaklangShellResponse);

  // 接入标准输出和标准错误流
  rpc AttachCombinedOutput(AttachCombinedOutputRequest) returns (stream ExecResult);

  // 判断当前引擎对网卡是否有操作权限？
  // 主要是能否发包等敏感操作
  // Windows 判断是否是管理员即可 I Am Admin
  // Linux 和 MacOS 应该尝试 pcap 打开网卡就行
  rpc IsPrivilegedForNetRaw(Empty) returns (IsPrivilegedForNetRawResponse);
  rpc PromotePermissionForUserPcap(Empty) returns (Empty);

  // 操作项目的相关接口，通过设置 ProjectDatabase
  rpc SetCurrentProject(SetCurrentProjectRequest) returns (Empty);
  rpc GetCurrentProject(Empty) returns (ProjectDescription); // deprecated
  rpc GetCurrentProjectEx(GetCurrentProjectExRequest) returns (ProjectDescription);

  rpc GetProjects(GetProjectsRequest) returns (GetProjectsResponse);
  rpc NewProject(NewProjectRequest) returns (NewProjectResponse);
  rpc UpdateProject(NewProjectRequest) returns(NewProjectResponse);
  rpc IsProjectNameValid(IsProjectNameValidRequest) returns (Empty);
  rpc RemoveProject(RemoveProjectRequest) returns (Empty); // no implement 

  rpc DeleteProject(DeleteProjectRequest) returns (Empty);
  rpc GetDefaultProject(Empty) returns (ProjectDescription); // deprecated 
  rpc GetDefaultProjectEx(GetDefaultProjectExRequest) returns (ProjectDescription);
  rpc QueryProjectDetail(QueryProjectDetailRequest) returns (ProjectDescription);
  rpc GetTemporaryProject(Empty) returns (ProjectDescription); // deprecated 
  rpc GetTemporaryProjectEx(GetTemporaryProjectExRequest) returns (ProjectDescription);

  // 导入导出项目，带密码，带进度
  rpc ExportProject(ExportProjectRequest) returns (stream ProjectIOProgress);
  rpc ImportProject(ImportProjectRequest) returns (stream ProjectIOProgress);
  // 迁移旧数据库
  rpc MigrateLegacyDatabase(Empty) returns (Empty);

  // 从规则中提取数据
  rpc QueryMITMRuleExtractedData(QueryMITMRuleExtractedDataRequest) returns (QueryMITMRuleExtractedDataResponse);
  rpc ExportMITMRuleExtractedData(ExportMITMRuleExtractedDataRequest) returns (stream ExportMITMRuleExtractedDataResponse);
  /*
    ChaosMakerRule: Bas
  */
  rpc ImportChaosMakerRules(ImportChaosMakerRulesRequest) returns (Empty);
  rpc QueryChaosMakerRule(QueryChaosMakerRuleRequest) returns (QueryChaosMakerRuleResponse);
  rpc DeleteChaosMakerRuleByID(DeleteChaosMakerRuleByIDRequest) returns (Empty);
  rpc ExecuteChaosMakerRule(ExecuteChaosMakerRuleRequest) returns (stream ExecResult);

  // 这个接口是判断 BAS Agent 远程端口是否可用的，使用 Vulinbox ws agent 协议连接
  // ConnectVulinboxAgent is the same as IsRemoteAddrAvailable
  rpc IsRemoteAddrAvailable(IsRemoteAddrAvailableRequest) returns (IsRemoteAddrAvailableResponse);
  rpc ConnectVulinboxAgent(IsRemoteAddrAvailableRequest) returns (IsRemoteAddrAvailableResponse);

  // vulinbox agent 的操作接口
  rpc GetRegisteredVulinboxAgent(GetRegisteredAgentRequest) returns (GetRegisteredAgentResponse);
  rpc DisconnectVulinboxAgent(DisconnectVulinboxAgentRequest) returns (Empty);

  // CVE
  rpc IsCVEDatabaseReady(IsCVEDatabaseReadyRequest) returns (IsCVEDatabaseReadyResponse);
  rpc UpdateCVEDatabase(UpdateCVEDatabaseRequest) returns (stream ExecResult);
  rpc ExportsProfileDatabase(ExportsProfileDatabaseRequest) returns (stream ExecResult);
  rpc ImportsProfileDatabase(ImportsProfileDatabaseRequest) returns (stream ExecResult);

  rpc QueryCVE(QueryCVERequest) returns (QueryCVEResponse);
  rpc GetCVE(GetCVERequest) returns (CVEDetailEx);
  rpc SaveTextToTemporalFile(SaveTextToTemporalFileRequest) returns (SaveTextToTemporalFileResponse);

  // Screcorder
  rpc IsScrecorderReady(IsScrecorderReadyRequest) returns (IsScrecorderReadyResponse);
  rpc InstallScrecorder(InstallScrecorderRequest) returns (stream ExecResult);
  rpc StartScrecorder(StartScrecorderRequest) returns (stream ExecResult);
  rpc QueryScreenRecorders(QueryScreenRecorderRequest) returns (QueryScreenRecorderResponse);
  rpc DeleteScreenRecorders(QueryScreenRecorderRequest) returns (Empty);
  rpc UploadScreenRecorders(UploadScreenRecorderRequest) returns (Empty);
  rpc GetOneScreenRecorders(GetOneScreenRecorderRequest) returns (ScreenRecorder);
  rpc UpdateScreenRecorders(UpdateScreenRecorderRequest) returns (Empty);

  // Vulinbox
  rpc IsVulinboxReady(IsVulinboxReadyRequest) returns (IsVulinboxReadyResponse);
  rpc InstallVulinbox(InstallVulinboxRequest) returns (stream ExecResult);
  rpc StartVulinbox(StartVulinboxRequest) returns (stream ExecResult);
  rpc GenQualityInspectionReport(GenQualityInspectionReportRequest) returns (stream ExecResult);

  // 通过他可以构造一个 HTTP 请求
  // 这个请求可能是一个，也可能是一系列
  // 一般用来调试插件等
  rpc HTTPRequestBuilder(HTTPRequestBuilderParams) returns (HTTPRequestBuilderResponse);
  // rpc QueryHTTPRequestBuilder(QueryHTTPRequestBuilderRequest) returns (QueryHTTPRequestBuilderResponse);
  // rpc DeleteHTTPRequestBuilder(DeleteHTTPRequestBuilderRequest) returns (Empty);
  rpc DebugPlugin(DebugPluginRequest) returns (stream ExecResult);
  rpc SmokingEvaluatePlugin(SmokingEvaluatePluginRequest) returns (SmokingEvaluatePluginResponse);
  rpc SmokingEvaluatePluginBatch(SmokingEvaluatePluginBatchRequest) returns (stream SmokingEvaluatePluginBatchResponse);
  rpc GetSystemDefaultDnsServers(Empty) returns (DefaultDnsServerResponse);

  // 诊断网络发生的问题
  rpc DiagnoseNetwork(DiagnoseNetworkRequest) returns (stream DiagnoseNetworkResponse);
  rpc DiagnoseNetworkDNS(DiagnoseNetworkDNSRequest) returns (stream DiagnoseNetworkResponse);
  rpc TraceRoute(TraceRouteRequest) returns (stream TraceRouteResponse);

  // Global Network Config
  rpc GetGlobalNetworkConfig(GetGlobalNetworkConfigRequest) returns (GlobalNetworkConfig);
  rpc SetGlobalNetworkConfig(GlobalNetworkConfig) returns (Empty);
  rpc ResetGlobalNetworkConfig(ResetGlobalNetworkConfigRequest) returns (Empty);
  // Global Proxy Rules Config
  rpc GetGlobalProxyRulesConfig(Empty) returns (GlobalProxyRulesConfig);
  rpc SetGlobalProxyRulesConfig(SetGlobalProxyRulesConfigRequest) returns (Empty);
  rpc CheckProxyAlive(CheckProxyAliveRequest) returns (CheckProxyAliveResponse);
  rpc ValidP12PassWord(ValidP12PassWordRequest) returns (ValidP12PassWordResponse);

  // YAKURL
  rpc RequestYakURL(RequestYakURLParams) returns (RequestYakURLResponse);

  // 文件IO
  rpc ReadFile(ReadFileRequest) returns (stream ReadFileResponse);

  // Wireshark
  rpc GetPcapMetadata(PcapMetadataRequest) returns (PcapMetadata);
  rpc PcapX(stream PcapXRequest) returns (stream PcapXResponse);
  rpc QueryTrafficSession(QueryTrafficSessionRequest) returns (QueryTrafficSessionResponse);
  rpc QueryTrafficPacket(QueryTrafficPacketRequest) returns (QueryTrafficPacketResponse);
  rpc QueryTrafficTCPReassembled(QueryTrafficTCPReassembledRequest) returns (QueryTrafficTCPReassembledResponse);
  rpc ParseTraffic(ParseTrafficRequest) returns (ParseTrafficResponse);

  // 与前端交互的双工长连接，用于通知某些消息
  rpc DuplexConnection(stream DuplexConnectionRequest) returns (stream DuplexConnectionResponse);


  // 混合批量扫描
  rpc HybridScan(stream HybridScanRequest) returns (stream HybridScanResponse);
  rpc QueryHybridScanTask(QueryHybridScanTaskRequest) returns (QueryHybridScanTaskResponse);
  rpc DeleteHybridScanTask(DeleteHybridScanTaskRequest) returns (Empty);

  rpc GetSpaceEngineStatus(GetSpaceEngineStatusRequest) returns(SpaceEngineStatus);
  // 由于第三方应用配置改为从后端动态的获取表单字段名，所以弃用此接口改用GetSpaceEngineAccountStatusV2
  rpc GetSpaceEngineAccountStatus(GetSpaceEngineAccountStatusRequest) returns(SpaceEngineStatus);
  rpc GetSpaceEngineAccountStatusV2(ThirdPartyApplicationConfig) returns(SpaceEngineStatus);
  rpc FetchPortAssetFromSpaceEngine(FetchPortAssetFromSpaceEngineRequest) returns (stream ExecResult);

  // 表达式执行
  rpc EvaluateExpression(EvaluateExpressionRequest) returns (EvaluateExpressionResponse);
  rpc EvaluateMultiExpression(EvaluateMultiExpressionRequest) returns (EvaluateMultiExpressionResponse);

  // 第三方应用配置模板
  rpc GetThirdPartyAppConfigTemplate(Empty) returns (GetThirdPartyAppConfigTemplateResponse);

  // AI相关
  rpc CheckHahValidAiConfig(Empty) returns (GeneralResponse);
  rpc ListAiModel(ListAiModelRequest) returns (ListAiModelResponse);

  // 指纹库
  rpc GetFingerprint(GetFingerprintRequest) returns (GetFingerprintResponse);
  rpc AddFingerprint(AddFingerprintRequest) returns (AddFingerprintResponse);
  rpc ModifyFingerprint(ModifyFingerprintRequest) returns (ModifyFingerprintResponse);

  rpc QueryFingerprint(QueryFingerprintRequest) returns (QueryFingerprintResponse); // 查询指纹信息
  rpc DeleteFingerprint(DeleteFingerprintRequest) returns (DbOperateMessage); // 删除指纹
  rpc UpdateFingerprint(UpdateFingerprintRequest) returns (DbOperateMessage); // 更新单条指纹内容 指纹增改所属组信息使用此条
  rpc CreateFingerprint(CreateFingerprintRequest) returns (DbOperateMessage); // 创建指纹
  rpc RecoverBuiltinFingerprint(Empty) returns (DbOperateMessage); // 恢复内置指纹

  rpc CreateFingerprintGroup(FingerprintGroup) returns (DbOperateMessage); // 创建指纹组
  rpc GetAllFingerprintGroup(Empty) returns (FingerprintGroups); // 获取所有指纹组
  rpc RenameFingerprintGroup(RenameFingerprintGroupRequest) returns (DbOperateMessage); // 重命名指纹组
  rpc DeleteFingerprintGroup(DeleteFingerprintGroupRequest) returns (DbOperateMessage); // 删除指纹组


  // 指纹 与 组 工具接口
  rpc BatchUpdateFingerprintToGroup(BatchUpdateFingerprintToGroupRequest) returns (DbOperateMessage); // 批量更新 规则与组关系表
  rpc GetFingerprintGroupSetByFilter(GetFingerprintGroupSetRequest)returns (FingerprintGroups);


  // 导入导出指纹
  rpc ExportFingerprint(ExportFingerprintRequest) returns (stream DataTransferProgress);
  rpc ImportFingerprint(ImportFingerprintRequest) returns (stream DataTransferProgress);


  // 反弹shell命令生成
  rpc GetReverseShellProgramList(GetReverseShellProgramListRequest) returns (GetReverseShellProgramListResponse);
  rpc GenerateReverseShellCommand(GenerateReverseShellCommandRequest) returns (GenerateReverseShellCommandResponse);

  // SyntaxFlow Rule
  rpc QuerySyntaxFlowRule(QuerySyntaxFlowRuleRequest) returns (QuerySyntaxFlowRuleResponse);
  rpc CreateSyntaxFlowRule(CreateSyntaxFlowRuleRequest) returns (DbOperateMessage);
  rpc CreateSyntaxFlowRuleEx(CreateSyntaxFlowRuleRequest) returns (CreateSyntaxFlowRuleResponse);
  rpc UpdateSyntaxFlowRule(UpdateSyntaxFlowRuleRequest) returns (DbOperateMessage);
  rpc UpdateSyntaxFlowRuleEx(UpdateSyntaxFlowRuleRequest) returns (UpdateSyntaxFlowRuleResponse);
  rpc DeleteSyntaxFlowRule(DeleteSyntaxFlowRuleRequest) returns (DbOperateMessage);
  rpc CheckSyntaxFlowRuleUpdate(CheckSyntaxFlowRuleUpdateRequest) returns (CheckSyntaxFlowRuleUpdateResponse);
  rpc ApplySyntaxFlowRuleUpdate(ApplySyntaxFlowRuleUpdateRequest) returns (stream ApplySyntaxFlowRuleUpdateResponse);
  // SyntaxFlow Group
  rpc QuerySyntaxFlowRuleGroup(QuerySyntaxFlowRuleGroupRequest)returns (QuerySyntaxFlowRuleGroupResponse);
  rpc DeleteSyntaxFlowRuleGroup(DeleteSyntaxFlowRuleGroupRequest) returns (DbOperateMessage);
  rpc CreateSyntaxFlowRuleGroup(CreateSyntaxFlowGroupRequest) returns (DbOperateMessage);
  rpc UpdateSyntaxFlowRuleGroup(UpdateSyntaxFlowRuleGroupRequest) returns (DbOperateMessage);
  rpc UpdateSyntaxFlowRuleAndGroup(UpdateSyntaxFlowRuleAndGroupRequest) returns (DbOperateMessage);
  // 查找多个规则的交集组，一个规则则为其组本身
  rpc QuerySyntaxFlowSameGroup(QuerySyntaxFlowSameGroupRequest)returns (QuerySyntaxFlowSameGroupResponse);

  rpc SyntaxFlowRuleToOnline(SyntaxFlowRuleToOnlineRequest) returns (stream SyntaxFlowRuleOnlineProgress);
  rpc DownloadSyntaxFlowRule(DownloadSyntaxFlowRuleRequest) returns (stream SyntaxFlowRuleOnlineProgress);

  // syntaxflow scan
  rpc SyntaxFlowScan(stream SyntaxFlowScanRequest) returns (stream SyntaxFlowScanResponse);
  rpc QuerySyntaxFlowScanTask(QuerySyntaxFlowScanTaskRequest) returns (QuerySyntaxFlowScanTaskResponse);
  rpc DeleteSyntaxFlowScanTask(DeleteSyntaxFlowScanTaskRequest) returns (DbOperateMessage);
  // query result
  rpc QuerySyntaxFlowResult (QuerySyntaxFlowResultRequest) returns (QuerySyntaxFlowResultResponse);
  rpc DeleteSyntaxFlowResult (DeleteSyntaxFlowResultRequest) returns (DeleteSyntaxFlowResultResponse);
  //query ssa program
  rpc QuerySSAPrograms(QuerySSAProgramRequest)returns(QuerySSAProgramResponse);
  rpc UpdateSSAProgram(UpdateSSAProgramRequest)returns(DbOperateMessage);
  rpc DeleteSSAPrograms(DeleteSSAProgramRequest)returns(DbOperateMessage);
  // SSA Risk CURD
  rpc QuerySSARisks(QuerySSARisksRequest)returns(QuerySSARisksResponse);
  rpc QueryNewSSARisks(QueryNewSSARisksRequest) returns(QueryNewSSARisksResponse);
  rpc DeleteSSARisks(DeleteSSARisksRequest)returns(DbOperateMessage);
  rpc UpdateSSARiskTags(UpdateSSARiskTagsRequest)returns(DbOperateMessage);
  rpc GetSSARiskFieldGroup(Empty) returns (SSARiskFieldGroupResponse);
  rpc GetSSARiskFieldGroupEx(GetSSARiskFieldGroupRequest) returns(SSARiskFieldGroupResponse);
  rpc NewSSARiskRead(NewSSARiskReadRequest) returns (NewSSARiskReadResponse);
  rpc ExportSSARisk(ExportSSARiskRequest) returns(stream ExportSSARiskResponse);
  rpc ImportSSARisk(ImportSSARiskRequest) returns(stream ImportSSARiskResponse);
  // SSA risk diff
  rpc SSARiskDiff(SSARiskDiffRequest) returns (stream SSARiskDiffResponse);
  // SSA Risk Disposal CURD
  rpc CreateSSARiskDisposals(CreateSSARiskDisposalsRequest) returns (CreateSSARiskDisposalsResponse);
  rpc QuerySSARiskDisposals(QuerySSARiskDisposalsRequest) returns (QuerySSARiskDisposalsResponse);
  rpc UpdateSSARiskDisposals(UpdateSSARiskDisposalsRequest) returns (UpdateSSARiskDisposalsResponse);
  rpc DeleteSSARiskDisposals(DeleteSSARiskDisposalsRequest) returns (DeleteSSARiskDisposalsResponse);
  rpc GetSSARiskDisposal(GetSSARiskDisposalRequest) returns (GetSSARiskDisposalResponse);

  rpc SSARiskFeedbackToOnline(SSARiskFeedbackToOnlineRequest) returns (Empty);

  // SSA Report
  rpc GenerateSSAReport(GenerateSSAReportRequest) returns (GenerateSSAReportResponse);

  // SSA Project CRUD
  rpc CreateSSAProject(CreateSSAProjectRequest) returns (CreateSSAProjectResponse);
  rpc UpdateSSAProject(UpdateSSAProjectRequest) returns (UpdateSSAProjectResponse);
  rpc DeleteSSAProject(DeleteSSAProjectRequest) returns (DeleteSSAProjectResponse);
  rpc QuerySSAProject(QuerySSAProjectRequest) returns (QuerySSAProjectResponse);
  rpc MigrateSSAProject(MigrateSSAProjectRequest) returns (stream MigrateSSAProjectResponse);

  rpc GetAllPluginEnv(Empty) returns (PluginEnvData);
  rpc QueryPluginEnv(QueryPluginEnvRequest) returns (PluginEnvData);
  rpc CreatePluginEnv(PluginEnvData) returns (Empty); // create
  rpc SetPluginEnv(PluginEnvData) returns (Empty); // create or update
  rpc DeletePluginEnv(DeletePluginEnvRequest) returns (Empty);

  rpc GetAllFuzztagInfo (GetAllFuzztagInfoRequest) returns (GetAllFuzztagInfoResponse);
  rpc GenerateFuzztag (GenerateFuzztagRequest) returns (GenerateFuzztagResponse);

  // 导入导出SyntaxFlow规则
  rpc ExportSyntaxFlows(ExportSyntaxFlowsRequest) returns (stream SyntaxflowsProgress);
  rpc ImportSyntaxFlows(ImportSyntaxFlowsRequest) returns (stream SyntaxflowsProgress);

  // hot-patch template
  rpc CreateHotPatchTemplate(HotPatchTemplate) returns (CreateHotPatchTemplateResponse);
  rpc DeleteHotPatchTemplate(DeleteHotPatchTemplateRequest) returns (DeleteHotPatchTemplateResponse);
  rpc UpdateHotPatchTemplate(UpdateHotPatchTemplateRequest) returns (UpdateHotPatchTemplateResponse);
  rpc QueryHotPatchTemplate(HotPatchTemplateRequest) returns (QueryHotPatchTemplateResponse);
  rpc QueryHotPatchTemplateList(QueryHotPatchTemplateListRequest) returns (QueryHotPatchTemplateListResponse);

  // db common rpc
  rpc GroupTableColumn(GroupTableColumnRequest) returns (GroupTableColumnResponse);


  rpc UploadHotPatchTemplateToOnline(UploadHotPatchTemplateToOnlineRequest) returns (Empty);
  rpc DownloadHotPatchTemplate(DownloadHotPatchTemplateRequest) returns (Empty);


  // MITM hijack filter
  rpc SetMITMHijackFilter(SetMITMFilterRequest) returns (SetMITMFilterResponse);
  rpc GetMITMHijackFilter(Empty) returns (SetMITMFilterRequest);
  rpc ResetMITMHijackFilter(Empty) returns (SetMITMFilterRequest);

  // HTTPFlow
  rpc ExportHTTPFlowStream(ExportHTTPFlowStreamRequest) returns(stream ExportHTTPFlowStreamResponse);
  rpc ImportHTTPFlowStream(ImportHTTPFlowStreamRequest) returns(stream ImportHTTPFlowStreamResponse);

  // Note
  rpc CreateNote(CreateNoteRequest) returns (CreateNoteResponse);
  rpc UpdateNote(UpdateNoteRequest) returns (DbOperateMessage);
  rpc DeleteNote(DeleteNoteRequest) returns (DbOperateMessage);
  rpc QueryNote(QueryNoteRequest) returns (QueryNoteResponse);
  rpc SearchNoteContent(SearchNoteContentRequest) returns (SearchNoteContentResponse);
  rpc ImportNote(ImportNoteRequest) returns (stream ImportNoteResponse);
  rpc ExportNote(ExportNoteRequest) returns (stream ExportNoteResponse);

  // AI Task
  rpc StartAIReAct(stream AIInputEvent) returns(stream AIOutputEvent);
  rpc StartAITask(stream AIInputEvent) returns(stream AIOutputEvent);
  rpc QueryAITask(AITaskQueryRequest) returns (AITaskQueryResponse);
  rpc DeleteAITask(AITaskDeleteRequest) returns (DbOperateMessage);
  rpc QueryAIEvent(AIEventQueryRequest) returns (AIEventQueryResponse);
  rpc GetRandomAIMaterials(GetRandomAIMaterialsRequest) returns (GetRandomAIMaterialsResponse);

  rpc StartAITriage(stream AITriageInputEvent) returns(stream AIOutputEvent);

  // AI forge curd
  rpc CreateAIForge(AIForge) returns (DbOperateMessage);
  rpc UpdateAIForge(AIForge) returns (DbOperateMessage);
  rpc DeleteAIForge(AIForgeFilter) returns (DbOperateMessage);
  rpc QueryAIForge(QueryAIForgeRequest) returns (QueryAIForgeResponse);
  rpc GetAIForge(GetAIForgeRequest) returns (AIForge);

  // mcp server
  rpc StartMcpServer(StartMcpServerRequest) returns(stream StartMcpServerResponse);
  rpc GetToolSetList(Empty) returns(GetToolSetListResponse);

  rpc GetAIToolList(GetAIToolListRequest) returns(GetAIToolListResponse);
  rpc DeleteAITool(DeleteAIToolRequest) returns(DbOperateMessage);
  rpc SaveAITool(SaveAIToolRequest) returns(DbOperateMessage);
  rpc SaveAIToolV2(SaveAIToolRequest) returns(SaveAIToolV2Response);
  rpc UpdateAITool(UpdateAIToolRequest) returns(DbOperateMessage);
  rpc ToggleAIToolFavorite(ToggleAIToolFavoriteRequest) returns(ToggleAIToolFavoriteResponse);
  rpc AIToolGenerateMetadata(AIToolGenerateMetadataRequest) returns(AIToolGenerateMetadataResponse);

  // Local Model Management
  rpc IsLlamaServerReady(Empty) returns (IsLlamaServerReadyResponse);
  rpc IsLocalModelReady(IsLocalModelReadyRequest) returns (IsLocalModelReadyResponse);
  rpc InstallLlamaServer(InstallLlamaServerRequest) returns (stream ExecResult);
  rpc StartLocalModel(StartLocalModelRequest) returns (stream ExecResult);
  rpc StopLocalModel(StopLocalModelRequest) returns (GeneralResponse);

  rpc DownloadLocalModel(DownloadLocalModelRequest) returns (stream ExecResult);
  rpc GetSupportedLocalModels(Empty) returns (GetSupportedLocalModelsResponse);
  rpc AddLocalModel(AddLocalModelRequest) returns (GeneralResponse);
  rpc DeleteLocalModel(DeleteLocalModelRequest) returns (GeneralResponse);
  rpc UpdateLocalModel(UpdateLocalModelRequest) returns (GeneralResponse);
  rpc GetAllStartedLocalModels(Empty) returns (GetAllStartedLocalModelsResponse);
  rpc ClearAllModels(ClearAllModelsRequest) returns (GeneralResponse);

  rpc IsSearchVectorDatabaseReady(IsSearchVectorDatabaseReadyRequest) returns (IsSearchVectorDatabaseReadyResponse);
  rpc InitSearchVectorDatabase(InitSearchVectorDatabaseRequest) returns (stream ExecResult);
  rpc GetAllVectorStoreCollections(Empty) returns (GetAllVectorStoreCollectionsResponse);
  rpc GetAllVectorStoreCollectionsWithFilter(GetAllVectorStoreCollectionsWithFilterRequest) returns (GetAllVectorStoreCollectionsWithFilterResponse);
  rpc DeleteSearchVectorDatabase(DeleteSearchVectorDatabaseRequest) returns (GeneralResponse);
  rpc UpdateVectorStoreCollection(UpdateVectorStoreCollectionRequest) returns (GeneralResponse);
  rpc ListVectorStoreEntries(ListVectorStoreEntriesRequest) returns (ListVectorStoreEntriesResponse);
  rpc CreateVectorStoreEntry(CreateVectorStoreEntryRequest) returns (GeneralResponse);
  rpc GetDocumentByVectorStoreEntryID(GetDocumentByVectorStoreEntryIDRequest) returns (GetDocumentByVectorStoreEntryIDResponse);

  // 第三方应用管理
  rpc ListThirdPartyBinary(Empty) returns (ListThirdPartyBinaryResponse);
  rpc InstallThirdPartyBinary(InstallThirdPartyBinaryRequest) returns (stream ExecResult);
  rpc UninstallThirdPartyBinary(UninstallThirdPartyBinaryRequest) returns (GeneralResponse);
  rpc IsThirdPartyBinaryReady(IsThirdPartyBinaryReadyRequest) returns (IsThirdPartyBinaryReadyResponse);
  rpc StartThirdPartyBinary(StartThirdPartyBinaryRequest) returns (stream ExecResult);

  // 插件执行跟踪双向流服务
  rpc PluginTrace(stream PluginTraceRequest) returns (stream PluginTraceResponse);

  // Knowledge Base
  rpc GetKnowledgeBaseNameList(Empty) returns(GetKnowledgeBaseNameListResponse);
  rpc GetKnowledgeBase(GetKnowledgeBaseRequest) returns(GetKnowledgeBaseResponse);
  rpc GetKnowledgeBaseTypeList(Empty) returns(GetKnowledgeBaseTypeListResponse);
  rpc DeleteKnowledgeBase(DeleteKnowledgeBaseRequest) returns(GeneralResponse);
  rpc CreateKnowledgeBase(CreateKnowledgeBaseRequest) returns(GeneralResponse);
  rpc CreateKnowledgeBaseV2(CreateKnowledgeBaseV2Request) returns(CreateKnowledgeBaseV2Response);
  rpc UpdateKnowledgeBase(UpdateKnowledgeBaseRequest) returns(GeneralResponse);

  rpc DeleteKnowledgeBaseEntry(DeleteKnowledgeBaseEntryRequest) returns(GeneralResponse);
  rpc CreateKnowledgeBaseEntry(CreateKnowledgeBaseEntryRequest) returns(GeneralResponse);
  rpc UpdateKnowledgeBaseEntry(UpdateKnowledgeBaseEntryRequest) returns(GeneralResponse);
  rpc SearchKnowledgeBaseEntry(SearchKnowledgeBaseEntryRequest) returns(SearchKnowledgeBaseEntryResponse);
  rpc QueryKnowledgeBaseByAI(QueryKnowledgeBaseByAIRequest) returns(stream QueryKnowledgeBaseByAIResponse);

  rpc BuildVectorIndexForKnowledgeBase(BuildVectorIndexForKnowledgeBaseRequest) returns(GeneralResponse);
  rpc BuildVectorIndexForKnowledgeBaseEntry(BuildVectorIndexForKnowledgeBaseEntryRequest) returns(GeneralResponse);

  // Entity Repository
  rpc ListEntityRepository(Empty) returns(ListEntityRepositoryResponse);
  // Entity CRUD
  rpc QueryEntity(QueryEntityRequest) returns (QueryEntityResponse);
  rpc CreateEntity(Entity) returns (DbOperateMessage);
  rpc UpdateEntity(Entity) returns (DbOperateMessage);
  rpc DeleteEntity(DeleteEntityRequest) returns (DbOperateMessage);
  // Relationship CRUD
  rpc QueryRelationship(QueryRelationshipRequest) returns (QueryRelationshipResponse);
  rpc CreateRelationship(Relationship) returns (DbOperateMessage);
  rpc UpdateRelationship(Relationship) returns (DbOperateMessage);
  rpc DeleteRelationship(DeleteRelationshipRequest) returns (DbOperateMessage);
  rpc QuerySubERM(QuerySubERMRequest) returns (QuerySubERMResponse);
  rpc GenerateERMDot(GenerateERMDotRequest) returns (GenerateERMDotResponse);

  // Export and Import Knowledge Base
  rpc ExportKnowledgeBase(ExportKnowledgeBaseRequest) returns (stream GeneralProgress);
  rpc ImportKnowledgeBase(ImportKnowledgeBaseRequest) returns (stream GeneralProgress);

  rpc AddMCPServer(AddMCPServerRequest) returns (GeneralResponse);
  rpc DeleteMCPServer(DeleteMCPServerRequest) returns (GeneralResponse);
  rpc UpdateMCPServer(UpdateMCPServerRequest) returns (GeneralResponse);
  rpc GetAllMCPServers(GetAllMCPServersRequest) returns (GetAllMCPServersResponse);

  // RAG Collection Search
  rpc RAGCollectionSearch(RAGCollectionSearchRequest) returns (stream RAGCollectionSearchResponse);
}

message CreateKnowledgeBaseV2Request {
  string Name = 1;
  string Description = 2;
  string Type = 3;
  repeated string Tags = 4;
}

message CreateKnowledgeBaseV2Response {
  KnowledgeBaseInfo KnowledgeBase = 1;
  bool IsSuccess = 2;
  string Message = 3;
  string MessageType = 4;
}

message ExportKnowledgeBaseRequest {
  int64 KnowledgeBaseId = 1;
  string Name = 3;
  string TargetPath = 2;
}

message ImportKnowledgeBaseRequest {
  string NewKnowledgeBaseName = 1;
  string InputPath = 2;
}

message GeneralProgress {
  double Percent = 1;
  string Message = 2;
  string MessageType = 3;
}

message RAGCollectionSearchRequest {
  string CollectionName = 1;
  string Query = 2;
  uint64 Limit = 3;
  repeated string EnhancePlan = 4;
  repeated string DocumentType = 5;
  float SimilarityThreshold = 6; // 0.0 - 1.0
  int64 Concurrency = 7;
}

message RAGCollectionSearchResponse {
  string Type = 1; // knowledge / entity / relationship / khop
  KnowledgeBaseEntry Knowledge = 2;
  Entity Entity = 3;
  Relationship Relationship = 4;
  string KhopPath = 5;
  float Similarity = 6;
  string EnhancePlan = 7;
}

message AddMCPServerRequest {
  string Name = 1;
  string Type = 2;
  string URL = 3;
  string Command = 4;
  bool Enable = 5;
  repeated KVPair Envs = 6;
}

message DeleteMCPServerRequest {
  int64 ID = 1;
}

message UpdateMCPServerRequest {
  int64 ID = 1;
  string Name = 2;
  string Type = 3;
  string URL = 4;
  string Command = 5;
  bool Enable = 6;
  repeated KVPair Envs = 7;
}

// 支持分页查询
message GetAllMCPServersRequest {
  string Keyword = 1;
  int64 ID = 2;
  Paging Pagination = 3;
  bool IsEnable = 5;
  bool IsShowToolList = 4;
}

message MCPServerToolParamInfo {
  string Type = 1;
  string Description = 2;
  string Default = 3;
  bool Required = 4;
  string Name = 5;
}

message MCPServerTool {
  string Name = 1;
  string Description = 2;
  repeated MCPServerToolParamInfo Params = 3;
}

message MCPServer {
  int64 ID = 1;
  string Name = 2;
  string Type = 3;
  string URL = 4;
  string Command = 5;
  bool Enable = 7;
  repeated MCPServerTool Tools = 6;
  string ErrorMsg = 8;
  repeated KVPair Envs = 9;
}

message GetAllMCPServersResponse {
  repeated MCPServer MCPServers = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message EntityRepository {
  int64 ID = 1;
  string Name = 2;
  string Description = 3;
  string HiddenIndex = 4;
}

message ListEntityRepositoryResponse {
  repeated EntityRepository EntityRepositories = 1;
}

message Entity {
  uint64 ID = 1;
  string Type = 2;
  string Name = 3;
  string Description = 4;
  uint64 BaseID = 5;
  string BaseIndex = 9;
  repeated KVPair Attributes = 6;
  string  Rationale = 7;
  string  HiddenIndex = 8;
}

message EntityFilter {
  uint64  BaseID = 1;
  string BaseIndex = 6;
  string ReposName = 8;
  repeated uint64 IDs = 2;
  repeated string Types = 3;
  repeated string Names = 4;
  repeated string HiddenIndex = 5;
  repeated string RuntimeID = 7;
  repeated string Keywords = 9;
}

message QueryEntityRequest {
  EntityFilter Filter = 1;
  Paging Pagination = 2;
}

message QueryEntityResponse {
  repeated Entity Entities = 1;
  Paging Pagination = 2;
  uint64 Total = 3;
}

message DeleteEntityRequest {
  EntityFilter Filter = 1;
}

message Relationship {
  uint64 ID = 1;
  string Type = 2;
  uint64 SourceEntityID = 3;
  uint64 TargetEntityID = 4;
  repeated KVPair Attributes = 5;
  string Rationale = 6;

  string SourceEntityIndex = 7;
  string TargetEntityIndex = 8;

  string UUID = 9;
  string RepositoryUUID = 10;
}

message RelationshipFilter {
  uint64 BaseID = 1;

  string BaseIndex = 10;

  repeated uint64 IDs = 2;
  repeated string Types = 3;
  repeated uint64 SourceEntityIDs = 4;
  repeated uint64 TargetEntityIDs = 5;
  repeated uint64 AboutEntityIDs = 6; // Source or Target

  repeated string SourceEntityIndex = 7;
  repeated string TargetEntityIndex = 8;
  repeated string AboutEntityIndex = 9; // Source or Target

  repeated string UUIDS = 11;

  repeated string RuntimeID = 12;
}

message QueryRelationshipRequest {
  RelationshipFilter Filter = 1;
  Paging Pagination = 2;
}

message QueryRelationshipResponse {
  repeated Relationship Relationships = 1;
  Paging Pagination = 2;
  uint64 Total = 3;
}

message DeleteRelationshipRequest {
  RelationshipFilter Filter = 1;
}

message QuerySubERMRequest {
  EntityFilter Filter = 1;
  uint64 Depth = 2;
}

message QuerySubERMResponse {
  repeated Entity Entities = 1;
  repeated Relationship Relationships = 2;
}

message GenerateERMDotRequest {
  EntityFilter Filter = 1;
  uint64 Depth = 2;
}

message GenerateERMDotResponse {
  string Dot = 1;
}

message StartedLocalModelInfo {
  string Name = 1;
  string ModelType = 2;
  string Host = 3;
  int32 Port = 4;
}
message GetAllStartedLocalModelsResponse {
  repeated StartedLocalModelInfo Models = 1;
}

message ClearAllModelsRequest {
  bool DeleteSourceFile = 1;
}

message UpdateLocalModelRequest {
  string Name = 1;
  string ModelType = 2;
  string Description = 3;
  string Path = 4;
}

message AddLocalModelRequest {
  string Name = 1;
  string ModelType = 2;
  string Description = 3;
  string Path = 4;
}

message DeleteLocalModelRequest {
  string Name = 1;
  bool DeleteSourceFile = 2;
}

message StopLocalModelRequest {
  string ModelName = 1;
}

message LocalModelStatus {
  string Status = 2;
  string Host = 3;
  int32 Port = 4;
  string Model = 5;
  string ModelPath = 6;
  string LlamaServerPath = 7;
  int32 ContextSize = 8;
  bool ContBatching = 9;
  int32 BatchSize = 10;
  int32 Threads = 11;
  bool Detached = 12;
  bool Debug = 13;
  string Pooling = 14;
  int32 StartupTimeout = 15;
  repeated string Args = 16;
}

message ThirdPartyBinary {
  string Name = 1;
  bool SupportCurrentPlatform = 2;
  string Description = 3;
  string InstallPath = 4;
  string DownloadURL = 5;
}

message ListThirdPartyBinaryResponse {
  repeated ThirdPartyBinary Binaries = 1;
}

message InstallThirdPartyBinaryRequest {
  string Name = 1;
  string Proxy = 2;
  bool Force = 3;
}

message UninstallThirdPartyBinaryRequest {
  string Name = 1;
}

message IsThirdPartyBinaryReadyRequest {
  string Name = 1;
}

message IsThirdPartyBinaryReadyResponse {
  bool IsReady = 1;
  string Error = 2;
}

message StartThirdPartyBinaryRequest {
  string Name = 1;
  repeated string Args = 2;
}

message BuildVectorIndexForKnowledgeBaseEntryRequest {
  int64 KnowledgeBaseEntryId = 1;
  string KnowledgeBaseEntryHiddenIndex = 13;
  int64 KnowledgeBaseId = 12;

  string BaseUrl = 2;
  string ApiKey = 3;
  string Proxy = 4;

  string ModelName = 5;
  int32 Dimension = 6;
  int32 M = 7;
  float Ml = 8;
  int32 EfSearch = 9;
  int32 EfConstruct = 10;
  string DistanceFuncType = 11;

  string RelatedEntityUUIDS = 14;
}

message BuildVectorIndexForKnowledgeBaseRequest {
  int64 KnowledgeBaseId = 1;

  string BaseUrl = 2;
  string ApiKey = 3;
  string Proxy = 4;

  string ModelName = 5;
  int32 Dimension = 6;
  int32 M = 7;
  float Ml = 8;
  int32 EfSearch = 9;
  int32 EfConstruct = 10;
  string DistanceFuncType = 11;
}

message GetKnowledgeBaseNameListResponse {
  repeated string KnowledgeBaseNames = 1;
}

message KnowledgeBaseType{
  string Name = 1;
  string Description = 2;
  string Value = 3;
}


message GetKnowledgeBaseTypeListResponse{
  repeated KnowledgeBaseType KnowledgeBaseTypes = 1;
}

message GetKnowledgeBaseRequest {
  int64 KnowledgeBaseId = 1;
  string Keyword = 2;
  Paging Pagination = 3;
}

message KnowledgeBaseInfo {
  int64 ID = 1;
  string KnowledgeBaseName = 2;
  string KnowledgeBaseDescription = 3;
  string KnowledgeBaseType = 4;
  repeated string Tags = 5;
  bool IsImported = 6;
}

message GetKnowledgeBaseResponse {
  repeated KnowledgeBaseInfo KnowledgeBases = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}
message CreateKnowledgeBaseRequest {
  string KnowledgeBaseName = 1;
  string KnowledgeBaseDescription = 2;
  string KnowledgeBaseType = 3;
}

message UpdateKnowledgeBaseRequest {
  int64 KnowledgeBaseId = 1;
  string KnowledgeBaseName = 2;
  string KnowledgeBaseDescription = 3;
  string KnowledgeBaseType = 4;
  repeated string Tags = 5;
}

message DeleteKnowledgeBaseEntryRequest {
  int64 KnowledgeBaseEntryId = 1;
  string KnowledgeBaseEntryHiddenIndex = 3;
  int64 KnowledgeBaseId = 2;
}
message SearchKnowledgeBaseEntryFilter {
  int64 KnowledgeBaseId = 1;
  string Keyword = 2;
  repeated string HiddenIndex = 4;
  repeated string RelatedEntityUUIDS = 3;
}
message SearchKnowledgeBaseEntryRequest {
  int64 KnowledgeBaseId = 1;
  string Keyword = 2;
  SearchKnowledgeBaseEntryFilter Filter = 4;
  Paging Pagination = 3;
}

message QueryKnowledgeBaseByAIRequest {
  string Query = 1;
  string EnhancePlan = 2;
  int64 KnowledgeBaseID = 3;
  bool QueryAllCollections = 4;
  string AIService = 5;
}

message QueryKnowledgeBaseByAIResponse {
  string Message = 1;
  string MessageType = 2;
  string Data = 3;
}

message SearchKnowledgeBaseEntryResponse {
  repeated KnowledgeBaseEntry KnowledgeBaseEntries = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message CreateKnowledgeBaseEntryRequest {
  int64 KnowledgeBaseID = 1;
  string KnowledgeTitle = 2;
  string KnowledgeType = 3;
  int32 ImportanceScore = 4;
  repeated string Keywords = 5;
  string KnowledgeDetails = 6;
  string Summary = 7;
  int32 SourcePage = 8;
  repeated string PotentialQuestions = 9;
  repeated float PotentialQuestionsVector = 10;
}

message UpdateKnowledgeBaseEntryRequest {
  int64 KnowledgeBaseID = 1;
  int64 KnowledgeBaseEntryID = 2;
  string KnowledgeBaseEntryHiddenIndex = 11;
  string KnowledgeTitle = 3;
  string KnowledgeType = 4;
  int32 ImportanceScore = 5;
  repeated string Keywords = 6;
  string KnowledgeDetails = 7;
  string Summary = 8;
  int32 SourcePage = 9;
  repeated string PotentialQuestions = 10;
}

message KnowledgeBaseEntry {
  int64 ID = 1;
  int64 KnowledgeBaseId = 2;
  string KnowledgeTitle = 3;
  string KnowledgeType = 4;
  int32 ImportanceScore = 5;
  repeated string Keywords = 6;
  string KnowledgeDetails = 7;
  string Summary = 8;
  int32 SourcePage = 9;
  repeated string PotentialQuestions = 10;
  repeated float PotentialQuestionsVector = 11;
  string HiddenIndex = 12;
  string RelatedEntityUUIDS = 13;
}

message DeleteKnowledgeBaseRequest {
  int64 KnowledgeBaseId = 1;
  string Name = 2;
}

message DeleteSearchVectorDatabaseRequest {
  repeated string CollectionNames = 1;
}

message VectorStoreCollection{
  string Name = 1;
  string Description = 2;
  int64 ID = 3;
  string ModelName = 4;
  int32 Dimension = 5;
  int32 M = 6;
  float Ml = 7;
  int32 EfSearch = 8;
  int32 EfConstruct = 9;
  string DistanceFuncType = 10;
}

message ListVectorStoreEntriesFilter {
  int64 CollectionID = 1;
  string Keyword = 2;
  string CollectionName = 3;
}

message ListVectorStoreEntriesRequest {
  int64 CollectionID = 1;
  string Keyword = 2;
  Paging Pagination = 3;
  string CollectionName = 4;
  ListVectorStoreEntriesFilter Filter = 5;
}

message CreateVectorStoreEntryRequest {
  string UID = 1;
  string Content = 2;
  string Metadata = 3;
}

message VectorStoreEntry {
  int64 ID = 1;
  string UID = 2;
  string Content = 3;
  string Metadata = 4;
  repeated float Embedding = 5;
  string DocumentType = 6;
  repeated string RelatedEntities = 7;
  string EntityID = 8;
}


message ListVectorStoreEntriesResponse {
  repeated VectorStoreEntry Entries = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message GetDocumentByVectorStoreEntryIDRequest {
  int64 ID = 1;
}

message GetDocumentByVectorStoreEntryIDResponse {
  KnowledgeBaseEntry Document = 1;
}

message UpdateVectorStoreCollectionRequest {
  string Name = 1;
  string Description = 2;
  int64 ID = 3;
}

// 带分页
message GetAllVectorStoreCollectionsWithFilterRequest {
  string Keyword = 1;
  int64 ID = 2;
  Paging Pagination = 3;
}

message GetAllVectorStoreCollectionsWithFilterResponse {
  repeated VectorStoreCollection Collections = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message GetAllVectorStoreCollectionsResponse {
  repeated VectorStoreCollection Collections = 1;
}
message IsSearchVectorDatabaseReadyRequest{
  repeated string CollectionNames = 1;
}
message IsSearchVectorDatabaseReadyResponse {
  bool IsReady = 1;
  repeated string NotReadyCollectionNames = 2;
  string Message = 3;
}

message InitSearchVectorDatabaseRequest {
  string Proxy = 1;
  repeated string CollectionNames = 2;
}


message GetToolSetListResponse {
  repeated ToolSetInfo ToolSetList = 1;
  repeated ResourceSetInfo ResourceSetList = 2;
}

message ToolSetInfo {
  string Name = 1;
}

message ResourceSetInfo {
  string Name = 1;
}


message AIToolGenerateMetadataRequest {
  string ToolName = 1;
  string Content = 2;
}

message AIToolGenerateMetadataResponse {
  string Name = 1;
  string Description = 2;
  repeated string Keywords = 3;
}

message SaveAIToolRequest {
  string Name = 1;
  string Description = 2;
  string Content = 3;
  string ToolPath = 4;
  repeated string Keywords = 5;
}

message SaveAIToolV2Response{
  bool IsSuccess = 1;
  string Message = 2;
  AITool AITool = 3;
}

message UpdateAIToolRequest {
  int64 ID = 1;
  string Name = 2;
  string Description = 3;
  string Content = 4;
  string ToolPath = 5;
  repeated string Keywords = 6;
}


message DeleteAIToolRequest {
  repeated string ToolNames = 1;
  repeated int64 IDs = 2;
}

message ToggleAIToolFavoriteRequest {
  string ToolName = 1;
  int64 ID = 2;
}

message ToggleAIToolFavoriteResponse {
  bool IsFavorite = 1;
  string Message = 2;
}

message AITool {
  string Name = 1;
  string Description = 2;
  string Content = 3;
  string ToolPath = 4;
  repeated string Keywords = 5;
  bool IsFavorite = 6;
  int64 ID = 7;
  string VerboseName = 8; // 给用户看的展示名称
}

message GetAIToolListResponse {
  repeated AITool Tools = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message GetAIToolListRequest {
  string Query = 1;
  string ToolName = 2;
  int64 ToolID = 5;
  Paging Pagination = 3;
  bool OnlyFavorites = 4;
}
message AIOutputEvent {
  string CoordinatorId = 1;
  string Type = 2;
  string NodeId = 3;
  bool IsSystem = 4;
  bool IsStream = 5;
  bool IsReason = 6;
  bytes StreamDelta = 7;
  bool IsJson = 8;
  bool IsResult = 15;
  bytes Content = 9;
  int64 Timestamp = 10;
  string TaskIndex = 11;
  bool DisableMarkdown = 13;
  bool IsSync = 12; // 是否是同步消息
  string SyncID = 14; // 用于同步消息的 ID
  string EventUUID = 16; // 事件的唯一ID, used via stream stream-finished
  I18n NodeIdVerbose = 17; // 用于展示的节点ID，可能是节点名称
  string ContentType = 18; // markdown / yaklang_code / plain_code
  string CallToolID = 19; // 如果是调用工具相关的事件，那么这里是调用的ID
  string AIService = 20; // 如果是 AI 服务相关的事件，那么这里是 AI 服务的名称
  string TaskUUID = 21; // 任务的唯一ID
}

message I18n {
  string Zh = 1;
  string En = 2;
}

message AIInputEvent {
  bool IsStart = 1;

  bool IsConfigHotpatch = 8;
  string HotpatchType = 9;
  // 如果是配置热补丁，那么 Params 就是热补丁的参数
  AIStartParams Params = 2;

  bool IsInteractiveMessage = 3;
  string InteractiveId = 4;
  string InteractiveJSONInput = 5;

  bool IsSyncMessage = 6;
  string SyncType = 7;
  string SyncJsonInput = 10;
  string SyncID = 13; // SyncID for sync message

  bool IsFreeInput = 11;
  string FreeInput = 12;
  repeated string AttachedFilePath = 14;
}


message AITriageInputEvent {
  bool IsStart = 1;
  AIStartParams Params = 2;

  bool IsInteractiveMessage = 3;
  string InteractiveId = 4;
  string InteractiveJSONInput = 5;

  bool IsFreeInput = 6;
  string FreeInput = 7;
}


message McpConfig {
  string Type = 1;
  string Key = 2;
  string Url = 3;
}

message AIStartParams {
  // if set will try recovery
  string CoordinatorId = 17;
  int64  Sequence = 18;

  repeated McpConfig McpServers = 1;

  string UserQuery = 2;

  // allow ai to use the fs
  bool EnableSystemFileSystemOperator = 3;
  bool UseDefaultAIConfig = 4;

  // Forge 就是 AI 模版
  string ForgeName = 5;
  repeated ExecParamItem ForgeParams = 6;

  // 是否禁用人机交互（AI 可能会主动问人问题）
  // 在 AI ReAct 中，他对应的是 EnableUserInteract
  // 在 AI Coordinator 中，还是原来的样子
  bool DisallowRequireForUserPrompt = 7;

  // Review 政策
  // 一般来说，如果 Review Handler 被 Forge 接管了，这个就不应该可以设置。
  // 普通的 Forge 并不会设置 Review 政策
  // ReviewPolicy 可选的选项如下：
  // 1. manual (全手动，大事小事所有的事情都由人来决策)
  // 2. yolo (全自动，所有的事情，都直接执行，无需参与 - 效果差，危险程度高)
  // 3. ai (AI 来进行初步决策，如果AI觉得风险程度比较高，则转交给人)
  string ReviewPolicy = 8;
  // 如果 Review 交给 AI 来做的话，那么就会涉及到一个风险打分
  // AIReviewRiskControlScore 就是低于这个分数，AI 自动同意。
  // 如果高于这个分数，转成手动。
  double AIReviewRiskControlScore = 81;

  // 禁用任何外部工具，这就是一个纯聊天机器了，一般没啥用了
  bool DisableToolUse = 9;

  // 默认是3，一般是说如果远端AI不稳定（网络原因）的时候，某一次对话重试几次？
  int64 AICallAutoRetry = 10;

  // 默认5，AI如果回答质量不高的时候，调大AITransactionRetry可以有效重试回答。
  int64 AITransactionRetry = 11;

  // 是否启用AI搜索本地工具的功能？
  bool EnableAISearchTool = 12;

  // 是否禁用AI搜索forge功能
  bool DisableAISearchForge = 32;

  // 是否启用AI搜索互联网搜索引擎的功能？
  bool EnableAISearchInternet = 13;

  repeated string IncludeSuggestedToolNames = 14;
  repeated string IncludeSuggestedToolKeywords = 16;
  repeated string ExcludeToolNames = 15;

  // ollama 本地模型部署可以使用 /nothink 关闭，使用这个选项可以移除 qwen3 的思考模式
  bool EnableQwenNoThinkMode = 19;

  // 在任务规划的时候，AI 是否被允许主动问用户问题
  bool AllowPlanUserInteract = 20;

  // 在任务规划的时候，如果AI允许问用户问题，那么最多问几次？
  int64 PlanUserInteractMaxCount = 23;

  // 是否允许生成报告，默认不允许
  bool AllowGenerateReport = 24;

  int64 TaskMaxContinueCount = 25;

  // 选择 AI 服务
  string AIService = 26;

  int64 ReActMaxIteration = 27;

  // 限制 Timeline 的最大条目和最大内容大小（bytes）
  int64 TimelineItemLimit = 28; // 已经废弃，功能不可用了，只需要关注 TimelineContentSizeLimit 就好
  int64 TimelineContentSizeLimit = 29;

  // 用户交互的最大次数限制,超过这个次数，AI 将不再被允许问用户问题
  int64 UserInteractLimit = 30;

  // timeline sessionID  用于多轮对话保持上下文
  string TimelineSessionID = 31;
}

message AITaskFilter {
  repeated string Name = 1;
  repeated string Keyword = 2;
  repeated string ForgeName = 3;
  repeated string CoordinatorId = 5;
}

message AIEventFilter {
  repeated string EventUUIDS = 1;
  repeated string  EventType = 2;
  repeated string CoordinatorId = 3;
  repeated string TaskIndex = 4;
  repeated string TaskUUID = 5;
}


message AIEventQueryRequest {
  AIEventFilter Filter = 1;
  string  ProcessID = 2;
}

message AIEventQueryResponse {
  repeated AIOutputEvent Events = 1;
}

message AITaskQueryRequest {
  Paging Pagination = 1;
  AITaskFilter Filter = 2;
}

message AITaskQueryResponse {
  Paging Pagination = 1;
  repeated AITask Data = 2;
  int64 Total = 3;
}

message AITaskDeleteRequest {
  AITaskFilter Filter = 1;
}

message GetRandomAIMaterialsRequest {
  int64 Limit = 1;
}

message GetRandomAIMaterialsResponse {
  repeated KnowledgeBaseEntry KnowledgeBaseEntries = 1;
  repeated AITool AITools = 2;
  repeated AIForge AIForges = 3;
}

message AITask {
  string CoordinatorId = 1;
  string Name = 2;
  int64 Seq = 3;
  string UserInput = 4;
  string ForgeName = 5;
}

message AIForgeFilter {
  string ForgeName = 1;
  repeated string ForgeNames = 11;
  string ForgeType = 2; // enum: yak or config
  string Keyword = 3;
  // tag
  repeated string Tag = 4;
  int64 Id = 5;
  bool ShowTemporary = 6; // 是否展示临时 forge，默认不展示
}

message AIForge {
  int64 Id = 1;
  string ForgeName = 2;
  string ForgeContent = 3; // yak type is yak script, config type is empty
  string ForgeType = 4; // yak or config
  string Description = 5;
  string ParamsUIConfig = 6; // json config for UI
  string Params = 7; // cli parameters
  string UserPersistentData = 8; // for user preferences
  repeated string ToolNames = 9;
  repeated string ToolKeywords = 10;
  string Action = 11;
  repeated string Tag = 12;
  string InitPrompt = 13; // 初始提示语
  string PersistentPrompt = 14; // 持久化提示语
  string PlanPrompt = 15; // 计划提示语
  string ResultPrompt = 16; // 结果提示语
  string ForgeVerboseName = 17; // 给用户看的展示名称
}

message QueryAIForgeRequest {
  Paging Pagination = 1;
  AIForgeFilter Filter = 2;
}

message QueryAIForgeResponse {
  Paging Pagination = 1;
  repeated AIForge Data = 2;
  int64 Total = 3;
}

message GetAIForgeRequest {
  int64 ID = 1;
  string ForgeName = 2;
}

message StartMcpServerRequest {
  // listen host
  string Host = 1;
  // listen port
  int32 Port = 2;
  // enable tool sets, split by ','
  repeated string Tool = 3;
  // disable tool sets, split by ','
  repeated string DisableTool = 4;
  // enable resource sets, split by ','
  repeated string Resource = 5;
  // disable resource sets, split by ','
  repeated string DisableResource = 6;
  // add the dynamic Yak script as a tool to the MCP server
  repeated string Script = 7;
  // enable all tool sets
  bool EnableAll = 8;
  // enable yak ai tool
  bool EnableYakAITool = 9;
}

message StartMcpServerResponse {
  // server status: "starting", "running", "stopped", "error"
  string Status = 1;
  // server message or error message
  string Message = 2;
  // server URL
  string ServerUrl = 3;
}

message GetSpaceEngineAccountStatusRequest {
  string Type = 1;
  string Key = 2;
  string Account = 3;
  string Domain = 4;
}

message GetSpaceEngineStatusRequest {
  string Type = 1;
}

message SpaceEngineStatus {
  string Type = 1;
  string Status = 2;
  string Info = 3;
  bytes Raw = 4;
  int64 Used = 5;
  int64 Remain = 6;
}

message FetchPortAssetFromSpaceEngineRequest {
  // zoomeye / hunter / fofa
  string Type = 1;
  string Filter = 2;
  int64 MaxPage = 3;
  int64 MaxRecord = 4;
  // page limit
  int64 PageSize = 5;
  bool ScanBeforeSave = 6;
  string Proxy = 7;
  int64 Concurrent = 8;
  uint32 RandomDelay = 9;
  uint32 RetryTimes = 10;
}

message DeleteHybridScanTaskRequest {
  string TaskId = 1;
  bool DeleteAll = 2;
  HybridScanTaskFilter Filter = 3;
}

message HybridScanTask {
  int64 Id = 1;
  int64 CreatedAt = 2;
  int64 UpdatedAt = 3;
  string TaskId = 4;
  string Status = 5; // executing / paused / done
  // exec status
  int64 TotalTargets = 6;
  int64 TotalPlugins = 7;
  int64 TotalTasks = 8;
  int64 FinishedTasks = 9;
  int64 FinishedTargets = 10;
  string FirstTarget = 11;
  string Reason = 12;
}

message QueryHybridScanTaskResponse {
  Paging Pagination = 1;
  repeated HybridScanTask Data = 2;
  int64 Total = 3;
}

message QueryHybridScanTaskRequest {
  Paging Pagination = 1;
  int64 FromId = 2;
  int64 UntilId = 3;
  string Status = 4;
  HybridScanTaskFilter Filter = 5;
}

message HybridScanTaskFilter {
  repeated string TaskId = 1;
  repeated string Status = 2;
  string Target = 3;
  int64 FromId = 4;
  int64  UntilId = 5;
  repeated string HybridScanTaskSource = 6;
}

message HybridScanResponse {
  // 计算整体任务进度等信息
  int64 TotalTargets = 1;
  int64 TotalPlugins = 2;
  int64 TotalTasks = 3;
  int64 FinishedTasks = 4;
  int64 FinishedTargets = 5;
  int64 ActiveTasks = 6;
  int64 ActiveTargets = 7;

  // 混合扫描任务ID，一般用来恢复任务或者暂停任务
  string HybridScanTaskId = 8;

  string CurrentPluginName = 9;

  ExecResult ExecResult = 10;

  // 这字段表示的是，正在执行的任务可以展示出来
  HybridScanUpdateActiveTaskTable UpdateActiveTask = 11;

  // 任务配置  废弃 使用 HybridScanConfig
  string ScanConfig = 12; // json序列化会有base64

  // 任务状态
  string Status = 13;

  // task config
  HybridScanRequest HybridScanConfig = 14;
}

message HybridScanUpdateActiveTaskTable {
  // create: 这个任务正在执行，推入栈中
  // remove: 这个任务执行完毕，弹出栈
  string Operator = 1;

  string Index = 2;
  bool IsHttps = 3;
  bytes HTTPRequest = 4;
  string Url = 6;
  string PluginName = 5;
}

// 输入目标，可以通过 input/file + template 构建可能带认证或其他内容的模版
message HybridScanInputTarget {
  string Input = 1;
  repeated string InputFile = 2;
  HTTPRequestBuilderParams HTTPRequestTemplate = 3;
}

// 输入插件：幂等的，相同的参数，结果是一致的，这样通过记录索引就能恢复进度
message HybridScanPluginConfig {
  repeated string PluginNames = 1;
  QueryYakScriptRequest Filter = 2;
}

message HybridScanRequest {
  // 控制帧字段
  bool Control = 9;
  // new: 新任务
  // resume: 恢复任务
  // pause: 暂停任务
  // stop: 停止任务
  // status: 查询任务状态
  string HybridScanMode = 8;
  string ResumeTaskId = 1;

  // 其他参数
  int64 Concurrent = 2;
  float TotalTimeoutSecond = 3;
  string Proxy = 4;
  float SingleTimeoutSecond = 5;
  bool Detach = 10; // 背后执行，就算进程结束了，也会执行，不太关心 context

  // 新任务
  HybridScanPluginConfig Plugin = 6;
  HybridScanInputTarget Targets = 7;

  // hybridScanTaskSource
  string HybridScanTaskSource = 11;
}

message DuplexConnectionRequest {
  bytes Data = 1;
  string MessageType = 2;
  int64 Timestamp = 3;
}

message DuplexConnectionResponse {
  bytes Data = 1;
  string MessageType = 2;
  int64 Timestamp = 3;
}

message PcapMetadataRequest {

}

message PcapMetadata {
  repeated NetInterface AvailablePcapDevices = 1;
  repeated KVPair AvailableSessionTypes = 2;
  repeated KVPair AvailableLinkLayerTypes = 3;
  repeated KVPair AvailableNetworkLayerTypes = 4;
  repeated KVPair AvailableTransportLayerTypes = 5;

  // AutoDetect Public Net If
  NetInterface DefaultPublicNetInterface = 6;
}

message QueryTrafficPacketRequest {
  Paging Pagination = 1;

  int64 TimestampNow = 2;
  string SessionId = 3;
  string LinkLayerTypes = 4;
  string NetworkLayerTypes = 5;
  string TransportLayerTypes = 6;
  string ApplicationLayerTypes = 7;
  string SrcIP = 8;
  string DstIP = 9;
  string SrcPort = 10;
  string DstPort = 11;

  int64 FromId = 12;
}

message QueryTrafficTCPReassembledRequest {
  Paging Pagination = 1;

  bool FromNow = 2; // ignore it
  string SessionId = 3;

  int64 FromId = 4;
  int64 UntilId = 5;
  int64 TimestampNow = 6;
}

message TrafficSession {
  int64 Id = 1;

  string SessionType = 2;
  string Uuid = 3;
  string DeviceName = 4;
  string DeviceType = 5;

  bool IsLinkLayerEthernet = 6;
  string LinkLayerSrc = 7;
  string LinkLayerDst = 8;

  bool IsIpv4 = 9;
  bool IsIpv6 = 10;
  string NetworkSrcIP = 11;
  string NetworkDstIP = 12;

  bool IsTcpIpStack = 13;
  int64 TransportLayerSrcPort = 14;
  int64 TransportLayerDstPort = 15;

  bool IsTCPReassembled = 16;
  bool IsHalfOpen = 17;
  bool IsClosed = 18;
  bool IsForceClosed = 19;

  bool HaveClientHello = 20;
  string SNI = 21;
}

message QueryTrafficSessionResponse {
  repeated TrafficSession Data = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message TrafficPacket {
  string LinkLayerType = 1;
  string NetworkLayerType = 2;
  string TransportLayerType = 3;
  string ApplicationLayerType = 4;
  bytes Payload = 5;
  bytes Raw = 6;

  string EthernetEndpointHardwareAddrSrc = 7;
  string EthernetEndpointHardwareAddrDst = 8;
  bool IsIpv4 = 9;
  bool IsIpv6 = 10;
  string NetworkEndpointIPSrc = 11;
  string NetworkEndpointIPDst = 12;
  int64 TransportEndpointPortSrc = 13;
  int64 TransportEndpointPortDst = 14;

  string SessionId = 15;
  int64 Id = 16;
  string Protocol = 17;
  string Info = 18;
}

message QueryTrafficPacketResponse {
  repeated TrafficPacket Data = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message TrafficTCPReassembled {
  int64 Id = 1;
  string SessionUuid = 2;
  bytes Raw = 3;
  int64 Seq = 4;
  int64 Timestamp = 5;
  string Source = 6;
  string Destination = 7;
  string Protocol = 8;
}

message QueryTrafficTCPReassembledResponse {
  repeated TrafficTCPReassembled Data = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message QueryTrafficSessionRequest {
  Paging Pagination = 1;

  // active traffic
  bool FromNow = 2; // ignore it, bad field

  int64 FromId = 3;
  int64 UntilId = 4;
  int64 TimestampNow = 5;
}

message PcapXRequest {
  // first request
  repeated string NetInterfaceList = 1;
  double TimeoutFloat = 2;
  SuricataConfig SuricataLoader = 3;
}

message SuricataConfig {

}

message PcapXResponse {
  int64 PacketFrameCounter = 1;
  int64 NetInterfaceTransferKBPerSeconds = 2;
  int64 TCPReassembledCount = 3;
  int64 TrafficSessionCount = 4;
}




message RequestYakURLParams {

  // files:
  // GET: means fetch details
  // POST: means update
  // PUT: means create
  // DELETE: means delete
  // HEAD: means check
  string Method = 1;

  YakURL Url = 2;

  bytes Body = 3; // 用于存储文件的内容
  int64 Page = 4;

  int64 PageSize = 5;

}

message YakURL {
  // YakURL is abstract general fs loader system
  // URL means schema://user:pass@location(:port)/path?query
  string FromRaw = 1;
  // means: file/webshell-.../directory
  string Schema = 2;
  string User = 3;
  string Pass = 4;
  string Location = 5;
  string Path = 6;
  repeated KVPair Query = 7;
}

message YakURLResource {
  // file / bytes
  string ResourceType = 1;
  string VerboseType = 2;

  // path filename
  string ResourceName = 3;
  string VerboseName = 4;

  int64 Size = 5;
  string SizeVerbose = 6;

  // Modified
  int64 ModifiedTimestamp = 8;

  // General URL
  string Path = 9;
  string YakURLVerbose = 10;
  YakURL Url = 11;

  repeated KVPair Extra = 12;

  bool HaveChildrenNodes = 13;
}

message RequestYakURLResponse {
  int64 Page = 1;
  int64 PageSize = 2;
  int64 Total = 3;
  repeated YakURLResource Resources = 4;
}

message PacketPrettifyHelperRequest {
  bytes Packet = 1;

  // SetReplaceBody: replace body for prettier
  bool SetReplaceBody = 2;
  bytes Body = 3;
}

message PacketPrettifyHelperResponse {
  // 处理后的 Packet
  bytes Packet = 1;
  string ContentType = 2;
  bool IsImage = 3;
  bytes ImageHtmlTag = 4;
  bytes Body = 5;
}

message DiagnoseNetworkDNSRequest {
  string Domain = 1;
}

message ResetGlobalNetworkConfigRequest {

}

message GetGlobalNetworkConfigRequest {

}

message ValidP12PassWordRequest {
  bytes Pkcs12Bytes = 1;
  bytes Pkcs12Password = 2;
}

message ValidP12PassWordResponse {
  bool IsSetPassWord = 1;
}

message GlobalNetworkConfig {
  // Config DNS
  bool DisableSystemDNS = 1;
  repeated string CustomDNSServers = 2;
  bool DNSFallbackTCP = 3;
  bool DNSFallbackDoH = 4;
  repeated string CustomDoHServers = 5;

  // certificates
  repeated Certificate ClientCertificates = 6;

  // network
  repeated string DisallowIPAddress = 7;
  repeated string DisallowDomain = 8;

  // default proxy
  repeated string GlobalProxy = 9;
  bool EnableSystemProxyFromEnv = 10;

  // default skip save HTTPFlow
  bool SkipSaveHTTPFlow = 11;

  // 第三方APIKey获取
  repeated ThirdPartyApplicationConfig AppConfigs = 12;

  // http auth info
  repeated AuthInfo AuthInfos = 13;

  // syn扫描选择的网卡
  string SynScanNetInterface = 14;

  repeated string ExcludePluginScanURIs = 15;
  repeated string IncludePluginScanURIs = 16;

  // AI Primary Config 首选 AI 配置项
  // openai / chatglm
  string PrimaryAIType = 17;

  repeated string AiApiPriority = 18;

  // 开启数据库同步存储
  bool DbSaveSync = 19;

  // 插件执行配置
  float CallPluginTimeout = 20;

  uint64 MinTlsVersion = 21;
  uint64 MaxTlsVersion = 22;
  uint64 MaxContentLength = 23;
}

message ProxyEndpoint {
  string Id = 1;
  string Name = 2;
  string Url = 3;
  string UserName = 4;
  string Password = 5;
  bool Disabled = 6;
}

message CheckProxyAliveRequest {
  string EndpointId = 1;
  // 临时代理串，如 http://user:pass@ip:port，如果提供则优先使用，不依赖 EndpointId
  string Proxy = 2;
  // 通过代理需要访问的目标地址，可以是 URL 或 host:port
  string Target = 3;
  // 可选超时时间，默认 5 秒
  int64 TimeoutSeconds = 4;
}

message CheckProxyAliveResponse {
  bool Ok = 1;
  string Reason = 2;
  string Proxy = 3;
  string Target = 4;
  int64 CostMs = 5;
}

message ProxyRoute {
  string Id = 1;
  string Name = 2;
  repeated string Patterns = 3;
  repeated string EndpointIds = 4;
  bool Disabled = 5;
}

message GlobalProxyRulesConfig {
  repeated ProxyEndpoint Endpoints = 1;
  repeated ProxyRoute Routes = 2;
}

message SetGlobalProxyRulesConfigRequest {
  GlobalProxyRulesConfig Config = 1;
}

message AuthInfo {
  string AuthUsername = 1;
  string AuthPassword = 2;
  string AuthType = 3;
  string Host = 4;
  bool Forbidden = 5;
}

message ThirdPartyApplicationConfig {
  // zoomeye / hunter / shodan / fofa / github / openai / token
  string Type = 1;
  string APIKey = 2;
  string UserIdentifier = 3;
  string UserSecret = 4;
  string Namespace = 5;
  string Domain = 6;
  string WebhookURL = 7;
  repeated KVPair ExtraParams = 8;
}

message DiagnoseNetworkRequest {
  double NetworkTimeout = 1;

  // 想要连接或扫描的目标是否都可达？
  // 网络是否可达？网管是什么
  // 如果是一个主机的话，他的 TCP 是否开放？
  // 如果包含域名的话，他的解析结果是什么？不存在？还是本地解析？
  // 多个服务器解析到同一个 IP？
  string ConnectTarget = 2;

  // 代理是否配置正确？
  string Proxy = 3;
  string ProxyAuthUsername = 4;
  string ProxyAuthPassword = 5;
  string ProxyToAddr = 8;

  string Domain = 6;
  repeated string DNSServers = 7;
}

message DiagnoseNetworkResponse {
  string Title = 1;
  string DiagnoseType = 2;
  string DiagnoseResult = 3;
  // info/verbose
  // warning
  string LogLevel = 5;
}

message DisconnectVulinboxAgentRequest {
  string Addr = 1;
}

message GetRegisteredAgentRequest {

}

message GetRegisteredAgentResponse {
  repeated IsRemoteAddrAvailableResponse Agents = 1;
}

message SmokingEvaluatePluginRequest {
  repeated HTTPRequestBuilderParams Requests = 1;

  // 只支持插件名评估
  string PluginName = 2;

  string Code = 3;
  // "syntaxflow" | "nuclei" | "mitm" | "port-scan" | "codec" | "yak"
  string PluginType = 4;
}


message SmokingEvaluateResult {
  string Item = 1;
  string Suggestion = 2;
  bytes ExtraInfo = 3;
  Range Range = 4;
  string Severity = 5; // Error || Warning
}

message SmokingEvaluatePluginResponse {
  int64 Score = 1;
  repeated SmokingEvaluateResult Results = 2;
}


message IsVulinboxReadyRequest {

}

message IsVulinboxReadyResponse {
  bool Ok = 1;
  string Reason = 2;
}

message InstallVulinboxRequest {
  string Proxy = 1;
}

message StartVulinboxRequest {
  // 默认应该是 127.0.0.1
  string Host = 1;
  // 默认应该是 8787
  string Port = 2;
  // 不启用 HTTPS
  bool NoHttps = 3;
  // 安全模式：不启用命令执行靶场
  bool SafeMode = 4;
}

message GenQualityInspectionReportRequest {
  repeated string ScriptNames = 1;
  string TaskName = 2;
}

message DebugPluginRequest {
  string Code = 1;
  string PluginType = 2;

  string Input = 3;
  HTTPRequestBuilderParams HTTPRequestTemplate = 4;
  repeated KVPair ExecParams = 5;
  HybridScanPluginConfig LinkPluginConfig = 6;

  // plugin name, if not empty, will use code
  string PluginName = 7;

  // runtime id ,if empty, will create a new runtime
  string RuntimeId = 8;

  // 是否在发送请求前渲染 fuzztag（如 {{int(1-100)}}）
  // 如果为 true，会先渲染 fuzztag 再发送请求
  // 默认为 false，保持原有行为
  bool RenderFuzzTag = 9;
}

message HTTPRequestBuilderResult {
  bool IsHttps = 1;
  string Url = 2;
  bytes HTTPRequest = 3;
}

message HTTPRequestBuilderResponse {
  repeated HTTPRequestBuilderResult Results = 1;
  string Templates = 2;
}

message HTTPRequestBuilderParams {
  bool IsRawHTTPRequest = 1;
  bool IsHttps = 2;
  bytes RawHTTPRequest = 3;

  // fields
  string Method = 4;

  // path 增强型
  repeated string Path = 6;
  repeated KVPair GetParams = 9;

  repeated KVPair Headers = 7;
  repeated KVPair Cookie = 8;

  // body 增强
  bytes Body = 10;
  repeated KVPair PostParams = 11;
  repeated KVPair MultipartParams = 12;
  repeated KVPair MultipartFileParams = 13;

  bool IsHttpFlowId = 14;
  repeated int64 HTTPFlowId = 15;
}

message ScreenRecorder {
  int64 Id = 1;
  string Filename = 2;
  string NoteInfo = 3;
  string Project = 4;
  int64 CreatedAt = 5;
  int64 UpdatedAt = 6;
  string VideoName = 7;
  string Cover = 8;
  string Duration = 9;
  bool  Before = 10;
  bool After = 11;
}

message QueryScreenRecorderRequest {
  string Project = 1;
  Paging Pagination = 2;
  string Keywords = 3;
  repeated int64 Ids = 4;
}

message UploadScreenRecorderRequest{
  string Project = 1;
  string Token = 2;
  string Keywords = 3;
  repeated int64 Ids = 4;
}

message GetOneScreenRecorderRequest {
  int64 Id = 1;
  string Order = 2;
}

message UpdateScreenRecorderRequest {
  int64 Id = 1;
  string VideoName = 2;
  string NoteInfo = 3;
}

message QueryScreenRecorderResponse {
  repeated ScreenRecorder Data = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message StartScrecorderRequest {
  int64 Framerate = 1;
  string ResolutionSize = 2;
  double CoefficientPTS = 3;
  bool DisableMouse = 4;
}

message InstallScrecorderRequest {
  string Proxy = 1;
}

message IsScrecorderReadyRequest {

}

message IsScrecorderReadyResponse {
  bool Ok = 1;
  string Reason = 2;
}

message GetCVERequest {
  string CVE = 1;
}

message QueryCVERequest {
  Paging Pagination = 1;
  // NETWORK/LOCAL/ADJACENT_NETWORK/PHYSICAL
  string AccessVector = 2;
  // HIGH/MIDDLE/LOW
  string AccessComplexity = 3;
  string CWE = 4;
  string Year = 5;
  string Severity = 6;
  double Score = 7;
  string Product = 8;

  // by published_date
  string AfterYear = 9;
  bool ChineseTranslationFirst = 10;
  string Keywords = 11;
}

message CWEDetail {
  string CWE = 1;
  string Name = 2;
  string NameZh = 3;
  //  repeated CWEDetail InterTo = 4;

  string Status = 5;
  bool Stable = 6;
  bool Incomplete = 7;
  string Description = 8;
  string DescriptionZh = 9;
  string LongDescription = 10;
  string LongDescriptionZh = 11;
  repeated string RelativeLanguage = 12;
  string Solution = 13;
  repeated string RelativeCVE = 14;
}

message CVEDetailEx {
  CVEDetail CVE = 1;
  repeated CWEDetail CWE = 2;
}

message CVEDetail {
  string CVE = 1;
  string DescriptionZh = 2;
  string DescriptionOrigin = 3;
  string Title = 4;
  string Solution = 5;
  string References = 6;
  string AccessVector = 7;
  string AccessComplexity = 8;
  string Authentication = 9;
  string ConfidentialityImpact = 10;
  string IntegrityImpact = 11;
  string AvailabilityImpact = 12;
  string Severity = 14;
  int64 PublishedAt = 15;
  string CWE = 16;
  string CVSSVersion = 17;
  string CVSSVectorString = 18;
  double BaseCVSSv2Score = 19;
  double ExploitabilityScore = 20;
  bool ObtainAllPrivileged = 21;
  bool ObtainUserPrivileged = 22;
  bool ObtainOtherPrivileged = 23;
  bool UserInteractionRequired = 24;
  string Product = 25;
  int64  UpdatedAt = 26;
  int64  LastModifiedData = 27;
}

message QueryCVEResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated CVEDetail Data = 3;
}

message SaveTextToTemporalFileRequest {
  bytes Text = 1;
}

message SaveTextToTemporalFileResponse {
  string FileName = 1;
}

message ImportChaosMakerRulesRequest {
  string Content = 1;
  // suricata / http-request / icmp
  string RuleType = 2;
  bool AIDecoration = 3;
  string Domain = 4;
  string Proxy = 5;
  string Key = 6;
}

message ChaosMakerRuleGroup {
  string Title = 1;
  string Description = 2;
  string Keywords = 3;
  repeated string Protocols = 4;
  string Solution = 5;
}

message IsRemoteAddrAvailableRequest {
  string Addr = 1;
  int64 Timeout = 2;
  string Probe = 3;
}

message IsRemoteAddrAvailableResponse {
  string Addr = 1;
  bool IsAvailable = 2;
  string Reason = 3;
  string Status = 4;

  int64 PingCount = 5;
  int64 RequestCount = 6;

  int64 LastActiveAt = 7;
}

message ExecuteChaosMakerRuleRequest {
  repeated ChaosMakerRuleGroup Groups = 1;
  repeated string ExtraOverrideDestinationAddress = 2;

  // 随机延迟
  int64 Concurrent = 3;
  int32 TrafficDelayMinSeconds = 4;
  int32 TrafficDelayMaxSeconds = 5;

  // 额外重复，如果为 -1 认为是永久重复
  int64 ExtraRepeat = 6;

  // 每组流量之间重复的次数
  int64 GroupGapSeconds = 7;
}

message ChaosMakerRule {
  int64 Id = 1;
  string RawTrafficBeyondIpPacketBase64 = 2;
  string RawTrafficBeyondLinkLayerBase64 = 3;
  string RawTrafficBeyondHttpBase64 = 4;
  string RuleType = 5;
  string SuricataRaw = 6;
  string Protocol = 7;
  string Action = 8;
  string Name = 9;
  string NameZh = 10;
  string ClassType = 11;
  string ClassTypeZh = 12;
  string Group = 13;
  string Keywords = 15;
  string KeywordsZh = 16;
  string Description = 17;
  string DescriptionZh = 18;
  repeated string CVE = 19;
}

message QueryChaosMakerRuleResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated ChaosMakerRule Data = 3;
}

message DeleteChaosMakerRuleByIDRequest {
  int64 Id = 1;
}

message QueryChaosMakerRuleRequest {
  Paging Pagination = 1;
  string RuleType = 2;
  repeated string Keywords = 3;

  // offset
  int64 FromId = 4;
  int64 UntilId = 5;
}

message ImportsProfileDatabaseRequest {
  string LocalProfileFile = 1;
}

message ExportsProfileDatabaseRequest {
  string LocalProfileFile = 1;
}

message UpdateCVEDatabaseRequest {
  string Proxy = 1;
  bool JustUpdateLatestCVE = 2;
}

message IsCVEDatabaseReadyResponse {
  bool Ok = 1;
  string Reason = 2;
  bool ShouldUpdate = 3;
}

message IsCVEDatabaseReadyRequest {

}

message MITMRuleExtractedData {
  int64 Id = 1;
  int64 CreatedAt = 2;
  string SourceType = 3;
  string TraceId = 4;
  string Regexp = 5;
  string RuleName = 6;
  string Data = 7;
  int64 Index = 8;
  int64 Length = 9;
  bool IsMatchRequest = 10;
}

message QueryMITMRuleExtractedDataResponse {
  repeated MITMRuleExtractedData Data = 1;
  int64 Total = 2;
  Paging Pagination = 3;
}

message QueryMITMRuleExtractedDataRequest {
  Paging Pagination = 1;
  string HTTPFlowHash = 2;
  string HTTPFlowHiddenIndex = 3;
  ExtractedDataFilter Filter = 4;
  bool OnlyName = 5;
}

message ExtractedDataFilter {
  repeated string TraceID = 1;
  repeated string RuleVerbose = 2;
  repeated int64 AnalyzedIds = 3;
}

message ExportMITMRuleExtractedDataRequest {
  ExtractedDataFilter Filter = 1;
  string ExportFilePath = 2;
  string Type = 3; // csv/json 默认为csv
}

message ExportMITMRuleExtractedDataResponse {
  string ExportFilePath = 1;
  double Percent = 2;
  string Verbose = 4;
}


message ExportProjectRequest {
  string ProjectName = 1;
  string Password = 2;
  int64 Id = 3;
}

message ProjectIOProgress {
  string TargetPath = 1;

  // 如果未完成，这个是百分比 0-1.0
  double Percent = 2;

  // 展示的提示语，可能是中断原因或者错误原因之类的
  string Verbose = 4;
}

message ImportProjectRequest {
  string LocalProjectName = 1;
  string ProjectFilePath = 2;
  string Password = 3;
  int64 FolderId = 4;
  int64 ChildFolderId = 5;
  string Type = 6;  // "project"(yakit) | "ssa_project"(irify)
}

message IsPrivilegedForNetRawResponse {
  bool IsPrivileged = 1;
  string Advice = 2;
  string AdviceVerbose = 3;
}

message RemoveProjectRequest {
  string ProjectName = 1;
}

message IsProjectNameValidRequest {
  string ProjectName = 1;
  int64 FolderId = 2;
  int64 ChildFolderId = 3;
  string Type = 4;
}

message NewProjectRequest {
  string ProjectName = 1;
  string Description = 2;
  int64 FolderId = 3;
  int64 ChildFolderId = 4;
  string Type = 5;
  int64  Id = 6;
  string Database = 7;
  string ExternalModule = 8;
  string ExternalProjectCode = 9;
}

message NewProjectResponse {
  int64 Id = 1;
  string ProjectName = 2;
}

message GetProjectsRequest {
  string ProjectName = 1;
  string Description = 2;
  Paging Pagination = 3;
  int64 FolderId = 4;
  int64 ChildFolderId = 5;
  // this type is filter ""(all) | "project"(yakit) | file(only-folder) | "ssa_project"(irify)
  string Type = 6;
  // this type effect response.ProjectTotal, this type mark kind of frontend 
  // "project"(yakit) | "ssa_project"(irify)
  string FrontendType = 7;
  int64 AfterUpdatedAt = 8;
  string ExternalModule = 9;
  string ExternalProjectCode = 10;
}

message ProjectDescription {
  string ProjectName = 1;
  string Description = 2;

  int64 Id = 3;
  string DatabasePath = 4;

  // 创建时间
  int64 CreatedAt = 5;

  int64 FolderId = 6;
  int64 ChildFolderId = 7;
  string Type = 8;
  int64 UpdateAt = 9;
  string FolderName = 10;
  string ChildFolderName = 11;
  string FileSize = 12;
  string ExternalModule = 13;
  string ExternalProjectCode = 14;
}

message GetProjectsResponse {
  repeated ProjectDescription Projects = 1;
  Paging Pagination = 2;
  int64 Total = 3;
  int64 TotalPage = 4;
  int64 ProjectToTal = 9;
}

message SetCurrentProjectRequest {
  // ProjectName
  string ProjectName = 1;
  int64 Id = 2;
  string Type = 3; // "project"(yakit) | "ssa_project"(irify)
}

message GetCurrentProjectExRequest {
  string Type = 1;  // "project"(yakit) | "ssa_project"(irify)
}


message DeleteProjectRequest {
  int64 Id = 1;
  bool IsDeleteLocal = 2;
  string Type = 3;  // "project"(yakit) | "ssa_project"(irify)
}

message GetDefaultProjectExRequest {
  string Type = 1;  // "project"(yakit) | "ssa_project"(irify)
}

message QueryProjectDetailRequest {
  int64 Id = 1;
}


message GetTemporaryProjectExRequest{
  string Type = 1;  // "project"(yakit) | "ssa_project"(irify)
}


message AttachCombinedOutputRequest {

}

message YaklangShellRequest {
  string Input = 1;
}

message YaklangShellKVPair {
  string Key = 1;
  bytes Value = 2;
  string ValueVerbose = 3;
  int64 SymbolId = 4;
}

message YaklangShellResponse {
  ExecResult RawResult = 1;
  repeated YaklangShellKVPair Scope = 2;
}

message ResetAndInvalidUserDataRequest {

}

message RegisterFacadesHTTPRequest {
  // 这个优先级比较高，如果有这个的话，他的响应应该像是
  // /_yakit/history/<id>
  int64 HTTPFlowID = 1;

  // 散装 HTTPFlow
  bytes HTTPResponse = 2;
  string Url = 3;
}

message RegisterFacadesHTTPResponse {
  // http(s)://localhost:<facadesport>/...
  string FacadesUrl = 1;
}

message GetHTTPPacketBodyRequest {
  string Packet = 1;
  bytes PacketRaw = 2;
  bool ForceRenderFuzztag = 3;
}

message DownloadBodyByHTTPFlowIDRequest {
  int64 Id = 1;
}

message Bytes {
  bytes Raw = 1;
}

message ExtractDataResponse {
  string Token = 1;
  bytes Extracted = 2;
}

message SaveFuzzerLabelRequest {
  repeated FuzzerLabel Data = 1;
}

message QueryFuzzerLabelResponse {
  repeated FuzzerLabel Data = 1;
}

message FuzzerLabel {
  int64 Id = 1;
  string Label = 2;
  string Description = 3;
  string DefaultDescription = 4;
  string Hash = 5;
}

message DeleteFuzzerLabelRequest {
  string Hash = 1;
}

message SaveFuzzerConfigRequest {
  repeated FuzzerConfig Data = 1;
}

message QueryFuzzerConfigRequest {
  Paging Pagination = 1;
  repeated string PageId = 2;
}

message QueryFuzzerConfigResponse {
  repeated FuzzerConfig Data = 1;
}

message FuzzerConfig {
  string PageId = 1;
  string Type = 2;
  string Config = 3;
}

message DeleteFuzzerConfigRequest {
  repeated string PageId = 1;
  bool DeleteAll = 2;
}

message ExtractDataRequest {
  bytes Data = 1;

  // regexp mode -> regexp between 模式
  string Mode = 2;

  // 根据前后缀提取
  string PrefixRegexp = 3;
  string SuffixRegexp = 4;

  // 根据一个正则提取
  string MatchRegexp = 5;

  // Token 用来标注这个数据是谁的，一般可以用来处理提取的数据
  string Token = 6;

  // 如果不再有数据了，设置这个 flag
  bool End = 7;
}

message GenerateExtractRuleRequest {
  // 要提取规则的样例数据
  bytes Data = 1 ;
  // 选择的文本
  bytes Selected = 2;
  // 选择前后缀的偏移量
  int64 OffsetSize = 3;
}

message GenerateExtractRuleResponse {
  string PrefixRegexp = 1;
  string SuffixRegexp = 2;
  string SelectedRegexp = 3;
}

message GetMachineIDResponse {
  string MachineID = 1;
}

message QueryHTTPFuzzerResponseByTaskIdRequest {
  // 用来索引对应的请求
  int64 TaskId = 1;
  string FuzzRequestToken = 2;

  // 上一个请求的时间戳
  int64 LastResponseTimestamp = 3;

  Paging Pagination = 4;
}

message QueryHTTPFuzzerResponseByTaskIdResponse {
  Paging Pagination = 1;
  repeated FuzzerResponse Data = 2;
  int64 Total = 3;
  int64 TotalPage = 4;
}

message QueryWebsocketFlowByHTTPFlowWebsocketHashRequest {
  string WebsocketRequestHash = 1;
  Paging Pagination = 2;
}

message DeleteWebsocketFlowByHTTPFlowWebsocketHashRequest {
  string WebsocketRequestHash = 1;
}

message ClientWebsocketRequest {
  bool IsTLS = 1;
  bytes UpgradeRequest = 2;

  // 要发送到服务器的请求
  bytes ToServer = 3;
  repeated string Encode = 4;

  // 是否允许 fuzz 标签渲染，然后发送
  bool AllowToFuzz = 5;
  int64 TotalTimeoutSeconds = 6;

  string Proxy = 7;
}

message ClientWebsocketResponse {
  // 切换协议是否成功
  bool SwitchProtocolSucceeded = 2;

  // 是 Websocket 数据帧吗？
  bool IsDataFrame = 1;
  // 服务器端返回还是？
  bool FromServer = 4;
  // 编码是啥样的？
  repeated string GuessEncode = 5;

  // 其他状态，以及出现问题的原因
  string StatusVerbose = 6;
  string ReasonVerbose = 7;

  // DataLength
  int64 DataLength = 8;
  bytes Data = 9;

  bool IsJson = 10;
  bool IsProtobuf = 11;

  int64 DataFrameIndex = 12;
  string WebsocketHash = 13;

  // 设置大小
  string DataSizeVerbose = 14;
  string DataVerbose = 15;

  // 升级
  bool IsUpgradeResponse = 16;
  bytes UpgradeResponse = 17;
}

message DefaultProxyResult {
  string Proxy = 1;
}

message ExecPacketScanRequest {
  // 选择 HTTPFlow 进行扫描
  repeated int64 HTTPFlow = 1;
  bytes HTTPRequest = 2;
  bool HTTPS = 3;

  // 允许数据包的 Fuzz 打开
  bool AllowFuzzTag = 5;

  // 扫描进程总超时
  int64 TotalTimeoutSeconds = 6;
  // 默认发包的 Timeout
  int64 Timeout = 7;

  // 并发
  int64 PluginConcurrent = 8;
  int64 PacketConcurrent = 9;

  // 插件列表
  repeated string PluginList = 10;

  // 设置代理
  string Proxy = 11;
}

message Range {
  string Code = 1;
  int64 StartLine = 2;
  int64 StartColumn = 3;
  int64 EndLine = 4;
  int64 EndColumn = 5;
}

message YaklangInspectInformationRequest {
  string YakScriptType = 1;
  string YakScriptCode = 2;
  Range Range = 3;
}

message YaklangLanguageSuggestionRequest {
  string InspectType = 1;// completion(补全) / hover(提示) / signature(签名) / definition(找定义) / reference(找引用)

  // {
  // from source code : support all InspectType
  string YakScriptType = 2;
  string YakScriptCode = 3;
  // }

  Range Range = 4; // selected range
  string ModelID = 5; // monaco model id

  // {
  // from database : support getReference
  // if set this progranName will use this from database
  string ProgramName = 6;
  string FileName = 7;
  // }
}


// message RiskInfo {
//   string Type = 1;
//   string TypeVerbose = 3;
//   string Level = 2;
//   string Cve = 4;
// }


message YaklangInformationKV {
  string Key = 1;
  bytes Value = 2;
  repeated YaklangInformationKV Extern = 3;
}

message YaklangInformation {
  string Name = 1;
  repeated YaklangInformationKV Data = 2;
}

message YaklangLanguageSuggestionResponse {
  repeated SuggestionDescription SuggestionMessage = 1;
}

message YaklangLanguageFindResponse {
  string URI = 1;
  repeated Range Ranges = 2;
}

message YaklangInspectInformationResponse {
  repeated YaklangInformation Information = 1;
  repeated YakScriptParam CliParameter = 2;
  repeated YakRiskInfo RiskInfo = 3;
  repeated YakUIInfo UIInfo = 4;
  repeated string Tags = 5;
  repeated string PluginEnvKey = 6;
}

message YakUIInfo {
  string Typ = 1;
  repeated string Effected = 2;
  string WhenExpression = 3;
}

message YakRiskInfo {
  string Level = 1;
  string TypeVerbose = 2;
  string CVE = 3;
  string Description = 4;
  string Solution = 5;
}


message YaklangGetCliCodeFromDatabaseResponse {
  string Code = 1;
  bool NeedHandle = 2;
}

message YaklangGetCliCodeFromDatabaseRequest {
  string ScriptName = 1;

}

message StaticAnalyzeErrorRequest {
  bytes Code = 1;
  string PluginType = 2; // "yak" "mitm" "port-scan" "codec" "syntaxflow"
}

message YaklangCompileAndFormatRequest {
  string Code = 1;
}


message YaklangCompileAndFormatResponse {
  string Code = 1;
  repeated StaticAnalyzeErrorResult Errors = 2;
}

message StaticAnalyzeErrorResult {
  bytes Message = 1;
  int64 StartLineNumber = 2;
  int64 EndLineNumber = 3;
  int64 StartColumn = 4;
  int64 EndColumn = 5;
  bytes RawMessage = 6;
  string Severity = 7;
  string Tag = 8;
}

message StaticAnalyzeErrorResponse {
  repeated StaticAnalyzeErrorResult Result = 1;
}

message SavePayloadProgress {
  double Progress = 1; // 进度

  int64 HandledBytes = 2;          // old
  string HandledBytesVerbose = 3;          // old
  int64 TotalBytes = 4;          // old
  string TotalBytesVerbose = 5;          // old
  double CostDuration = 6;          // old

  string CostDurationVerbose = 7; // 耗时
  string Speed = 8;// 速度
  string RestDurationVerbose = 9;// 剩余时间
  string Message = 10;
}

message ExportPayloadBatchRequest {
  string Group = 1;
  string SavePath = 2;
}

message UploadPayloadToOnlineRequest {
  string Token = 1;
  string Group = 2;
  string Folder = 3;
}

message DownloadPayloadRequest {
  string Token = 1;
  string Group = 2;
  string Folder = 3;
}

message DownloadProgress {
  double Progress = 1;
  string Message = 2;
  string MessageType = 3;
}

message DeletePluginByUserIDRequest {
  int64 UserID = 1;
  string OnlineBaseUrl = 2;
}

message ExportPayloadDBAndFileRequest {
  repeated string Groups = 1;
  string SavePath = 2;
}

message DeleteLocalPluginsByWhereRequest {
  string Keywords = 1;
  string Type = 2;
  int64  UserId = 3;
  string UserName = 4;
  repeated int64 Ids = 5;
  string Tags = 6;
  repeated string Groups = 7;
}

message DownloadOnlinePluginProgress {
  // 进度
  double Progress = 1;
  string Log = 2;
}

message DownloadOnlinePluginByTokenRequest {
  string Token = 1;
  bool BindMe = 2;
  string Keywords = 3;
  string PluginType = 4;
  string Status = 5;
  string IsPrivate = 6;
  string Tags = 7;
  string UserName = 8;
  int64  UserId = 9;
  string TimeSearch = 10;
  string Group = 11;
}

message DownloadOnlinePluginByIdRequest {
  int64 OnlineID = 1;
  string Token = 2;
  string UUID = 3;
}

message DownloadOnlinePluginByIdsRequest {
  repeated int64 OnlineIDs = 1;
  string Token = 2;
  repeated string UUID = 3;
}

message DownloadOnlinePluginsRequest {
  string Token = 1;
  repeated bool IsPrivate = 2;
  string  Keywords = 3;
  repeated string PluginType = 4;
  repeated string  Tags = 5;
  string   UserName = 6;
  int64  UserId = 7;
  string TimeSearch = 8;
  repeated string Group = 9;
  string   ListType = 10;
  repeated int64 Status = 11;
  repeated string UUID = 12;
  repeated string ScriptName = 13;
  repeated string ExcludeTypes = 14;
  string FieldKeywords = 15;
  repeated bool Official = 16;
}

message QueryPluginGroup {
  bool UnSetGroup = 1;
  repeated string Group = 2;
}

message DownloadOnlinePluginByScriptNamesRequest {
  repeated string ScriptNames = 1;
  string Token = 2;
}

message DownloadOnlinePluginByScriptNamesResponse {
  repeated DownloadOnlinePluginByScriptName Data = 1;
}

message DownloadOnlinePluginByScriptName {
  string ScriptName = 1;
  int64 Id = 2;
  string HeadImg = 3;
}

message DownloadOnlinePluginByUUIDRequest {
  string UUID = 1;
  string Token = 2;
}

message QueryOnlinePluginsRequest {
  Paging Pagination = 1;
  DownloadOnlinePluginsRequest Data = 2;
}

message QueryOnlinePluginsResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated OnlinePlugin Data = 3;
}

message OnlinePlugin {
  int64 Id = 1;
  int64 UpdatedAt = 2;
  int64 CreatedAt = 3;
  string Content = 4;
  string Type = 5;
  repeated YakScriptParam Params = 6;
  bool IsPrivate = 7;
  string ScriptName = 8;
  string Help = 9;
  string Author = 10;
  string Tags = 11;
  bool EnablePluginSelector = 12;
  string PluginSelectorTypes = 13;
  string UUID = 14;
  string HeadImg = 15;
  bool Official = 16;
  string Group = 17;
  bool IsCorePlugin = 18;
  // 协作者
  repeated Collaborator CollaboratorInfo = 19;
  repeated YakRiskInfo RiskInfo = 20;
  repeated string PluginEnvKey = 21;
}

message OnlineProfile {
  string BaseUrl = 1;
  string Password = 2;
  string Proxy = 3;
  bool   IsCompany = 4;
}

message SetKeyRequest {
  string Key = 1;
  string Value = 2;
  int64 TTL = 3;
}

message GetKeyRequest {
  string Key = 1;
}

message GetKeyResult {
  string Value = 1;
}

message GeneralStorage {
  string Key = 1;
  string Value = 2;
  int64 ExpiredAt = 3;
  bool ProcessEnv = 4;
  string Verbose = 5;
  string Group = 6;
}

message GetProcessEnvKeyResult {
  repeated GeneralStorage Results = 1;
}

message SetSystemProxyRequest {
  string HttpProxy = 1;
  bool Enable = 2;
}

message GetSystemProxyResult {
  string CurrentProxy = 1;
  bool Enable = 2;
}

// --- Deprecated interface--
message GetExecBatchYakScriptUnfinishedTaskByUidRequest {
  string Uid = 1;
}

message RecoverExecBatchYakScriptUnfinishedTaskRequest {
  string Uid = 1;
}

message ExecBatchYakScriptUnfinishedTask {
  double Percent = 1;
  int64 CreatedAt = 2;
  string Uid = 3;
  string YakScriptOnlineGroup = 4;
  string TaskName = 5;
}

message SimpleDetectUnfinishedTask {
  double Percent = 1;
  int64 CreatedAt = 2;
  string Uid = 3;
  string YakScriptOnlineGroup = 4;
  string TaskName = 5;
  int64  LastRecordPtr = 6;
}

message GetExecBatchYakScriptUnfinishedTaskResponse {
  repeated ExecBatchYakScriptUnfinishedTask Tasks = 1;
}

message GetSimpleDetectUnfinishedTaskResponse {
  repeated SimpleDetectUnfinishedTask Tasks = 1;
}
// -------------------

message UnfinishedTaskFilter {
  repeated string RuntimeId = 1;
  repeated string ProgressSource = 2;
  string TaskName = 3; // support fuzzy search
  string Target = 4; // support fuzzy search
}

message QueryUnfinishedTaskRequest {// query unfinished task list ,just brief info
  Paging Pagination = 1;
  UnfinishedTaskFilter Filter = 2;
}

message DeleteUnfinishedTaskRequest {
  UnfinishedTaskFilter Filter = 1;
}

message UnfinishedTask {
  double Percent = 1;
  int64 CreatedAt = 2;
  string RuntimeId = 3;
  string YakScriptOnlineGroup = 4;
  string TaskName = 5;
  int64  LastRecordPtr = 6;
  string Target = 7;
}

message QueryUnfinishedTaskResponse {// brief information for unfinished task
  repeated UnfinishedTask Tasks = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message GetUnfinishedTaskDetailByIdRequest {// get unfinished task detail by runtime id, get task start param or last record
  string RuntimeId = 1;
}

message RecoverUnfinishedTaskRequest {// recover unfinished simple detect task by runtime id
  string RuntimeId = 1;
}

message FixUploadPacketRequest {
  bytes Request = 1;
}

message FixUploadPacketResponse {
  bytes Request = 1;
}

message IsMultipartFormDataRequestResult {
  bool IsMultipartFormData = 1;
}

message AutoDecodeRequest {
  string Data = 1;
  repeated AutoDecodeResult ModifyResult = 2;
}

message AutoDecodeResult {
  string Type = 1;
  string TypeVerbose = 2;
  bytes Origin = 3;
  bytes Result = 4;
  bool Modify = 5;
}

message AutoDecodeResponse {
  repeated AutoDecodeResult Results = 1;
}

message ExtractDataToFileResult {
  string FilePath = 1;
}

message GetYakScriptTagsResponse {
  repeated Tags Tag = 1;
}

message Tags {
  string Value = 1;
  int32 Total = 2;
}

message QueryYakScriptLocalAndUserRequest {
  string OnlineBaseUrl = 1;
  int64 UserId = 2;
}

message QueryYakScriptLocalAndUserResponse {
  repeated YakScript Data = 1;
}

message QueryYakScriptByOnlineGroupRequest {
  string OnlineGroup = 1;
}

message QueryYakScriptByNamesRequest {
  repeated string YakScriptName = 1;
}

message QueryYakScriptByIsCoreRequest {
  bool IsCorePlugin = 1;
}

message QueryYakScriptByNamesResponse {
  repeated YakScript Data = 1;
}

message QueryYakScriptByIsCoreResponse {
  repeated YakScript Data = 1;
}

message QueryYakScriptRiskDetailByCWERequest {
  string CWEId = 1;
}

message QueryYakScriptRiskDetailByCWEResponse {
  string CWEId = 1;
  string RiskType = 2;
  string Description = 3;
  string CWESolution = 4;
}

message YakScriptRiskTypeListResponse {
  repeated RiskTypeLists Data = 1;
}

message RiskTypeLists {
  string RiskType = 1;
  string CWEId = 2;
}

message ExtractDataToFileRequest {
  bool JsonOutput = 1;
  bool CSVOutput = 2;
  string DirName = 3;

  map<string, ExtractableData> Data = 4;
  string FileNamePattern = 5;

  // 当没有数据的时候，执行这个即可
  bool Finished = 6;
}

message ExtractableData {
  string StringValue = 1;
  bytes BytesValue = 2;
}

message MITMContentReplacers {
  repeated MITMContentReplacer Rules = 1;
}

message ImportMITMReplacerRulesRequest {
  bytes JsonRaw = 1;
  bool ReplaceAll = 2;
}

message ExportMITMReplacerRulesResponse {
  bytes JsonRaw = 1;
}

message ExecYakitPluginsByYakScriptFilterRequest {
  QueryYakScriptRequest Filter = 1;

  // 这个 Target 很复杂，URL / IP / CIDR / Host / Host:port
  string Target = 2;
  string Ports = 3;
  string TargetFile = 5;

  repeated ExecParamItem ExtraParams = 4;
}

message GenerateYakCodeByPacketRequest {
  bool IsHttps = 1;
  bytes Request = 2;
  enum Template {
    Ordinary = 0;
    Batch = 1;
  }
  Template CodeTemplate = 3;
}

message GenerateCSRFPocByPacketRequest {
  bool IsHttps = 1;
  bytes Request = 2;
}

message GenerateCSRFPocByPacketResponse {
  bytes Code = 1;
}

message GenerateYakCodeByPacketResponse {
  bytes Code = 1;
}

message QueryReportRequest {
  int64 Id = 1;
  string Hash = 2;
  string Type = 3;  // "project"(yakit) | "ssa_project"(irify)
}

message DeleteReportRequest {
  int64 Id = 1;
  string Hash = 2;
  QueryReportsRequest Filter = 3;
  repeated int64 IDs = 4;
  bool DeleteAll = 5;
  string Type = 6;  // "project"(yakit) | "ssa_project"(irify)
}

message QueryReportsResponse {
  repeated Report Data = 1;
  int64 Total = 2;
  Paging Pagination = 3;
}

message QueryReportsRequest {
  Paging Pagination = 1;
  string Owner = 2;
  string From = 3;
  string Keyword = 4;
  string Title = 5;
  string Type = 6;  // "project"(yakit) | "ssa_project"(irify)
}

message Report {
  string Title = 1;
  uint64 PublishedAt = 2;
  string Hash = 3;
  uint64 Id = 4;
  string Owner = 5;
  string From = 6;
  string JsonRaw = 7;
}

message SetTagForHTTPFlowRequest {
  int64 Id = 1;
  string Hash = 2;
  repeated string Tags = 3;
  repeated CheckSetTagsHTTPFlow CheckTags = 4;
}

message CheckSetTagsHTTPFlow {
  int64 Id = 1;
  string Hash = 2;
  repeated string Tags = 3;
}

message RequireICMPRandomLengthResponse {
  int32 Length = 1;
  string ExternalHost = 2;
}

message RandomPortTriggerNotification {
  string RemoteAddr = 1;
  string RemoteIP = 2;
  int32 RemotePort = 3;
  int32 LocalPort = 4;
  repeated string History = 5;
  int32 CurrentRemoteCachedConnectionCount = 6;
  int32 LocalPortCachedHistoryConnectionCount = 7;
  int64 TriggerTimestamp = 8;
  int64 Timestamp = 9;
}

message QueryRandomPortTriggerRequest {
  string Token = 1;
}

message RandomPortInfo {
  string Token = 1;
  string Addr = 2;
  int32 Port = 3;
}

message DeleteHistoryHTTPFuzzerTaskRequest {
  int32 Id = 1;
  string WebFuzzerIndex = 2;
}

message RiskTableStats {
  // 最近一次更新的漏洞信息
  int64 LatestCreatedAtTimestamp = 1;

  Fields RiskTypeStats = 2;
  Fields RiskLevelStats = 3;
}

message MITMCert {
  bytes CaCerts = 1;
  string LocalFile = 2;
}

message FieldName {
  string Name = 1;
  string Verbose = 2;
  int32 Total = 3;

  // 比上一次的增量/变化量
  int32 Delta = 4;
}

message Fields {
  repeated FieldName Values = 1;
}
//获取Gadget的Options
message YsoOption{
  string Name = 1;
  string NameVerbose = 2;
  string Help = 3;
}
message YsoOptionsWithVerbose{
  repeated YsoOption Options = 1;
}
//已弃用
message YsoOptions{
  repeated string Names = 1;
}
//类生成器的参数
message YsoClassGeneraterOptionsWithVerbose{
  string Key = 1;
  string KeyVerbose = 2;
  string Help = 3;
  string Value = 4;
  string Type = 5;
  map<string, YsoClassOptionsResponseWithVerbose> BindOptions = 6;
}
message YsoClassOptionsResponseWithVerbose{
  repeated YsoClassGeneraterOptionsWithVerbose Options = 1;
}
//已弃用
message YsoClassGeneraterOptions{
  string Key = 1;
  string Value = 2;
  string Type = 3;
}
//已弃用
message YsoClassOptionsResponse{
  repeated YsoClassGeneraterOptions Options = 1;
}
//生成代码和字节码
message YsoOptionsRequerstWithVerbose{
  string Gadget = 1;
  string Class = 2;
  repeated YsoClassGeneraterOptionsWithVerbose Options = 3;
}
//已弃用
message YsoOptionsRequerst{
  string Gadget = 1;
  string Class = 2;
  repeated YsoClassGeneraterOptions Options = 3;
}
message YsoBytesObject{
  bytes Data = 1;
}
message YsoDumpResponse{
  string Data = 1;
}

message YsoCodeResponse{
  string Code = 1;
}
message YsoBytesResponse{
  string FileName = 1;
  bytes Bytes = 2;
}
message BytesToBase64Request{
  bytes Bytes = 1;
}
message BytesToBase64Response{
  string Base64 = 1;
}
message QueryICMPTriggerRequest {
  int32 Length = 1;
}

message QueryICMPTriggerResponse {
  repeated ICMPTriggerNotification Notification = 1;
}

message QuerySupportedDnsLogPlatformsResponse{
  repeated string Platforms = 1;
}

message ICMPTriggerNotification {
  int32 Size = 1;
  string CurrentRemoteAddr = 2;
  repeated string Histories = 3;
  int32 CurrentRemoteCachedConnectionCount = 4;
  int32 SizedCachedHistoryConnectionCount = 5;
  int64 TriggerTimestamp = 7;
  int64 Timestamp = 8;
}

message GetHistoryHTTPFuzzerTaskRequest {
  int32 Id = 1;
}


message HistoryHTTPFuzzerTaskDetail {
  HistoryHTTPFuzzerTask BasicInfo = 1;
  FuzzerRequest OriginRequest = 2;
}

message HistoryHTTPFuzzerTask {
  int32 Id = 1;
  int64 CreatedAt = 2;
  int32 HTTPFlowTotal = 3;
  int32 HTTPFlowSuccessCount = 4;
  int32 HTTPFlowFailedCount = 5;
  string Host = 6;
  int32  Port = 7;
}

message HistoryHTTPFuzzerTasks {
  repeated HistoryHTTPFuzzerTask Tasks = 1;
}

message HistoryHTTPFuzzerTasksResponse {
  repeated HistoryHTTPFuzzerTaskDetail Data = 1;
  int64 Total = 2;
  int64 TotalPage = 3;
  Paging Pagination = 4;
}

message QueryHistoryHTTPFuzzerTaskExParams {
  Paging Pagination = 1;
  string Keyword = 2;
  string FuzzerTabIndex = 3;
}

message ExecutePacketYakScriptParams {
  string ScriptName = 1;
  bool IsHttps = 2;
  bytes Request = 3;
  bytes Response = 4;
}

message ExecuteBatchPacketYakScriptParams {
  repeated string ScriptName = 1;
  bool IsHttps = 2;
  bytes Request = 3;
  bytes Response = 4;

  // 并发
  int32 Concurrent = 5;
  // 设置单个超时时间
  double PerTaskTimeout = 6;
}


// WebShell
enum ShellType {
  Behinder = 0;
  Godzilla = 1;
  YakShell = 2;
}

enum ShellScript {
  JSP = 0;
  JSPX = 1;
  ASP = 2;
  ASPX = 3;
  PHP = 4;
}
enum EncMode {
  Raw = 0;
  Base64 = 1;
  AesRaw = 2;
  AesBase64 = 3;
  XorRaw = 4;
  XorBase64 = 5;
}

message WebShell {
  int64 Id = 1;
  string Url = 2;
  string Pass = 3;
  string SecretKey = 4;
  string EncMode = 5;
  string Charset = 6;
  string ShellType = 7;
  string ShellScript = 8;
  bool Status = 9;
  string Tag = 10;
  //    Proxy
  string Proxy = 11;
  map<string, string> Headers = 12;
  string Remark = 13;
  int64 CreatedAt = 14;
  int64 UpdatedAt = 15;
  string PacketCodecName = 16;
  string PayloadCodecName = 17;
  map<string, string> Posts = 18;
  ShellOptions ShellOptions = 19;
  string Os = 20;
  string ResDecMOde = 21; //解密方式
}

message ShellGenerate{
  EncMode EncMode = 1;
  ShellScript Script = 2;
  string Pass = 3;
  bool Confuse = 4;  //是否混淆
  bool IsSession = 5;
}

message ShellOptions{
  int64 RetryCount = 1; //重新时间
  int64 Timeout = 2; //超时时间
  int64 BlockSize = 3; //分块大小
  int64 MaxSize = 4; //上传的最大包（M）
  int64 UpdateTime = 5; //更新时间，当是session-mode的时候涉及到session过期的问题
  bool IsSession = 6; //是否是session类型
}

message WebShellRequest {
  int64 Id = 1;
}

message WebShellResponse {
  bool State = 1;
  bytes Data = 2;
}

message QueryWebShellsRequest {
  Paging Pagination = 1;
  string Tag = 2;
}

message QueryWebShellsResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated WebShell Data = 3;
}

message UpdateWebShellRequest {
  int64 Id = 1;
  string Url = 2;
  string Pass = 3;
  string SecretKey = 4;
  string EncMode = 5;
  string Charset = 6;
  string ShellType = 7;
  string ShellScript = 8;
  string Tag = 10;
  ShellOptions ShellOptions = 11;
  string Os = 12;
  string ResDataMOde = 13;
  map<string, string> Headers = 14;
  map<string, string> Posts = 15;

}

message DeleteWebShellRequest {
  int64 Id = 1;
  repeated int64 Ids = 2;
}


message YakDNSLogBridgeAddr {
  string DNSLogAddr = 1;
  string DNSLogAddrSecret = 2;
  string DNSMode = 3;
  bool UseLocal = 4;
  bool UseRemote = 5;
}

message RequireDNSLogDomainByScriptRequest {
  string Token = 1;
  string ScriptName = 2;
}

message QueryDNSLogByTokenRequest {
  string Token = 1;
  string DNSLogAddr = 2;
  string DNSMode = 3;
  bool UseLocal = 4;
  bool UseRemote = 5;
}

message QueryDNSLogByTokenResponse {
  repeated DNSLogEvent Events = 1;
}

message DNSLogEvent {
  string DNSType = 1;
  string Token = 2;
  string Domain = 3;
  string RemoteAddr = 4;
  string RemoteIP = 5;
  int32 RemotePort = 6;
  bytes Raw = 7;
  int64 Timestamp = 8;
}

message DNSLogRootDomain {
  string Domain = 1;
  string Token = 2;
}

message GetGlobalReverseServerResponse {
  string PublicReverseIP = 1;
  int32 PublicReversePort = 2;
  string LocalReverseAddr = 3;
  int32 LocalReversePort = 4;
}

message AvailableLocalAddrResponse {
  repeated NetInterface Interfaces = 1;
}

message NetInterface {
  string Name = 1;
  string Addr = 2;
  string IP = 3;
  string Description = 4;
  bool IsIpv4 = 5;
  bool IsIpv6 = 6;
  string NetInterfaceName = 7;
}

message ConfigGlobalReverseParams {
  GetTunnelServerExternalIPParams ConnectParams = 1;
  string LocalAddr = 2;
}

message DeleteRiskRequest {
  int64 Id = 1;
  string Hash = 2;
  repeated int64 Ids = 4;
  QueryRisksRequest Filter = 3;
  bool DeleteAll = 5;
  bool DeleteRepetition = 6;
}

message QueryRiskRequest {
  int64 Id = 1;
  string Hash = 2;
  repeated int64 Ids = 4;
  QueryRisksRequest Filter = 3;
}

message Risk {
  string Hash = 1;

  string IP = 2;
  string Url = 3;
  int32  Port = 4;
  string Host = 5;

  string Title = 6;
  string TitleVerbose = 7;
  string RiskType = 8;
  string RiskTypeVerbose = 9;
  string Parameter = 10;
  string Payload = 11;
  string Details = 12;

  string FromYakScript = 13;
  string YakScriptUUID = 29;

  bool WaitingVerified = 14;
  string ReverseToken = 15;

  int64 Id = 18;
  int64 CreatedAt = 16;
  int64 UpdatedAt = 17;

  string Severity = 19;

  // 数据包提取出来！
  bytes Request = 20;
  bytes Response = 21;

  // 这个一般用于生成报告追踪报告中产生的漏洞
  string RuntimeId = 22;

  string CVE = 23;
  string Description = 24;
  string Solution = 25;
  string TaskName = 26;
  string Tags = 27;
  bool IsRead = 28;

  uint64 ResultID = 30;
  string SyntaxFlowVariable = 31;
  string ProgramName = 32;
  bool IsPotential = 33;
}

message QueryRisksRequest {
  Paging Pagination = 1;

  string Search = 2;
  string Network = 3;
  string Ports = 4;
  string RiskType = 5;
  string Token = 6;
  bool WaitingVerified = 7;
  string Severity = 8;

  int64 FromId = 9;
  int64 BeforeCreatedAt = 17;
  int64 AfterCreatedAt = 18;
  int64 UntilId = 10;
  string Tags = 11;
  string IsRead = 12;
  string Title = 13;
  repeated int64 Ids = 14;

  string RuntimeId = 15;
  repeated string RuntimeIds = 19;

  // ssa program
  repeated string SSAProgramNames = 16;
}

message QueryRisksResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated Risk Data = 3;
}

message QueryNewRiskRequest {
  int64 AfterId = 1;
}

message QueryNewRiskResponse {
  repeated NewRisk Data = 1;
  int64 NewRiskTotal = 2;
  int64 Total = 3;
  int64 Unread = 4;
}

message QueryRiskTagsResponse {
  repeated FieldGroup RiskTags = 1;
}

message RiskFieldGroupResponse {
  repeated FieldGroup RiskIPGroup = 1;
  repeated FieldName RiskLevelGroup = 2;
  repeated FieldName RiskTypeGroup = 3;
}

message FieldGroup {
  string Name = 1;
  int32 Total = 2;
}

message NewRisk {
  string Title = 1;
  int64 Id = 2;
  int64 CreatedAt = 3;
  int64 UpdatedAt = 4;
  string Verbose = 5;
  string TitleVerbose = 6;
  bool IsRead = 7;
}

message NewRiskReadRequest {
  int64 AfterId = 1;
  repeated int64 Ids = 2;
  QueryRisksRequest Filter = 3;
}

message UploadRiskToOnlineRequest {
  string Token = 1;
  string ProjectName = 2;
  repeated string Hash = 3;
  string ExternalModule = 4;
  string ExternalProjectCode = 5;
}

message SetTagForRiskRequest {
  int64 Id = 1;
  string Hash = 2;
  repeated string Tags = 3;
}


message VerifyTunnelServerDomainParams {
  GetTunnelServerExternalIPParams ConnectParams = 1;
  string Domain = 2;
}

message VerifyTunnelServerDomainResponse {
  string Domain = 1;
  bool Ok = 2;
  string Reason = 3;
}

message GetTunnelServerExternalIPParams {
  string Addr = 1;
  string Secret = 2;
}

message GetTunnelServerExternalIPResponse {
  string IP = 1;
}

message StartFacadesParams {
  // 端口复用的
  string LocalFacadeHost = 41;
  int32 LocalFacadePort = 42;
  //  bool EnableRMIServer = 1;
  //  int32 RMILocalPort = 2;
  //
  bool EnableDNSLogServer = 3;
  int32 DNSLogLocalPort = 4;
  //
  //  bool EnableHTTPServer = 23;
  //  int32 HTTPServerPort = 24;

  // 连接远程端口参数
  GetTunnelServerExternalIPParams ConnectParam = 5;

  // 远端端口开放情况
  //  int32 RMIRemotePort = 6;
  int32 FacadeRemotePort = 16;
  int32 DNSLogRemotePort = 7;

  // 外部域名
  string ExternalDomain = 8;

  // 验证端口是否转发成功
  bool Verify = 9;
}
message ApplyClassToFacadesParamsWithVerbose {
  YsoOptionsRequerstWithVerbose GenerateClassParams = 1;
  string Token = 2;
}
//已弃用
message ApplyClassToFacadesParams {
  YsoOptionsRequerst GenerateClassParams = 1;
  string Token = 2;
}
message StartFacadesWithYsoParams {
  // 端口复用的
  bool IsRemote = 1;
  int32 ReversePort = 2;
  string ReverseHost = 4;
  string Token = 5;
  GetTunnelServerExternalIPParams BridgeParam = 6;

  YsoOptionsRequerst GenerateClassParams = 7;
}

message Tree {
  string Name = 1;
  string Data = 2;
  repeated Tree Children = 3;
}

message GetAvailableBruteTypesResponse {
  repeated string Types = 1; // 弃用
  repeated Tree TypesWithChild = 2;
}

message StartBruteParams {
  string Type = 1;
  string Targets = 2;
  string TargetFile = 3;

  // 设置如果用户输入了，就代替默认字典
  bool ReplaceDefaultUsernameDict = 28;
  bool ReplaceDefaultPasswordDict = 29;

  repeated string Usernames = 4;
  string UsernameFile = 24;

  repeated string Passwords = 5;
  string PasswordFile = 25;

  repeated string Prefix = 6;
  float Timeout = 7;

  // 每个目标之间的并发
  int64 Concurrent = 8;
  int64 Retry = 9;

  // 目标任务内并发
  int64 TargetTaskConcurrent = 10;

  //
  bool OkToStop = 11;
  int64 DelayMin = 12;
  int64 DelayMax = 13;

  string PluginScriptName = 14;
}

message HTTPRequestMutateParams {
  bytes Request = 1;

  repeated string FuzzMethods = 2;

  // use chunk encode
  bool ChunkEncode = 3;

  // multipart boundary
  bool UploadEncode = 4;
}

message HTTPResponseMutateParams {
  bytes Response = 2;
}

message MutateResult {
  bytes Result = 1;
  repeated bytes ExtraResults = 2;
}

message QueryHostsRequest {
  Paging Pagination = 1;

  string DomainKeyword = 2;
  string Network = 3;
}

message DeleteHostsRequest {
  bool DeleteAll = 1;
  string DomainKeyword = 2;
  string Network = 3;
  int64 ID = 4;
}

message QueryHostsResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated Host Data = 3;
}

message QueryDomainsRequest {
  Paging Pagination = 1;
  string Network = 2;
  string DomainKeyword = 3;
  string Title = 4;
  bool   All = 5;
}

message DeleteDomainsRequest {
  bool DeleteAll = 1;
  string DomainKeyword = 2;
  string Network = 3;
  int64 ID = 4;
  QueryDomainsRequest Filter = 5;
  repeated int64 IDs = 6;
}

message QueryDomainsResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated Domain Data = 3;
}

message Domain {
  int64 ID = 1;
  string DomainName = 2;
  string IPAddr = 3;
  string HTTPTitle = 4;
}

message QueryPortsGroupResponse {
  repeated PortsGroup PortsGroupList = 1;
}

message PortsGroup {
  string GroupName = 1;
  repeated GroupList GroupLists = 2;
}

message GroupList {
  string ServiceType = 1;
  string ShowServiceType = 2;
  int32 Total = 3;
}

message Host {
  int64 Id = 1;
  string IP = 2;
  int64 IPInteger = 3;
  bool IsInPublicNet = 4;
  repeated string Domains = 5;
}

message DownloadReportRequest {
  string FileData = 1;
  string FileName = 2;
  string FileDir = 3;
}

message DeleteYakScriptExecResultRequest {
  repeated int64 Id = 1;
  string YakScriptName = 2;
}

message YakScriptNames {
  repeated string YakScriptNames = 1;
}

message QueryYakScriptExecResultRequest {
  Paging Pagination = 1;
  string YakScriptName = 2;
}

message QueryYakScriptExecResultResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated ExecResult Data = 3;
}

message GenerateWebsiteTreeResponse {
  bytes TreeDataJson = 1;
}

message GenerateWebsiteTreeRequest {
  string Targets = 1;
}

message StartBasicCrawlerRequest {
  string Targets = 1;
  string TargetsFile = 2;

  string MaxDepth = 3;
  string MaxCountOfLinks = 4;
  string MaxCountOfRequest = 5;
  string DisallowSuffix = 6;
  string StartFromParentPath = 7;
  string MaxRetryTimes = 8;
  string AllowMethods = 9;
  string AllowDomains = 10;
  string ForbiddenDomain = 11;
  string AllowUrlRegexp = 12;
  string ForbiddenUrlRegexp = 13;
  string UserAgent = 14;

  // 基础认证
  string BasicAuth = 15;
  string BasicAuthUsername = 16;
  string BasicAuthPassword = 17;

  // Transport
  repeated string Proxies = 18;
  int64 Concurrent = 19;
  int64 MaxRedirectTimes = 20;
  int64 ConnectTimeoutSeconds = 21;
  int64 ResponseTimeoutSeconds = 22;

  repeated HTTPHeader Headers = 23;
  repeated HTTPCookie Cookies = 24;
}

message HTTPCookieSetting {
  string Key = 1;
  string Value = 2;
  string Path = 3;
  string Domain = 4;
  int64 Expires = 5;
  int64 MaxAge = 6;
  bool Secure = 7;
  bool HttpOnly = 8;

  // default
  // lax
  // strict
  // none
  string SameSiteMode = 9;
}

message HTTPCookie {
  string Key = 1;
  string Value = 2;
  bool AllowOverride = 3;
}

message ExportYakScriptRequest {
  int64 YakScriptId = 1;
  string OutputDir = 2;
  string OutputPluginDir = 3;
  repeated int64 YakScriptIds = 4;
  bool All = 5;
}

message ExportYakScriptStreamRequest {
  QueryYakScriptRequest Filter = 1;
  string OutputFilename = 2;
  string Password = 3;
}

message ImportYakScriptStreamRequest {
  bytes Data = 1;
  string Password = 2;
  string Filename = 3;
}

message ExportYakScriptResponse {
  string OutputDir = 2;
}


message GetMarkdownDocumentResponse {
  YakScript Script = 1;
  string Markdown = 2;
}

message GetMarkdownDocumentRequest {
  string YakScriptName = 1;
  int64 YakScriptId = 2;
}

message SaveMarkdownDocumentRequest {
  string YakScriptName = 1;
  int64 YakScriptId = 2;
  string Markdown = 3;
}

message GroupNames {
  repeated string Groups = 1;
}

message QueryGroupsByYakScriptIdRequest {
  int64 YakScriptId = 1;
  string Mode = 2;
}

message MenuItem {
  string Group = 1;
  string Verbose = 2;
  int64 YakScriptId = 3;
  BatchExecutionPluginFilter Query = 4;
  uint64 MenuItemId = 5;
  int64 GroupSort = 6;
  string YakScriptName = 7;
}

// 这里的小写不要改动，兼容前端已有的格式
message BatchExecutionPluginFilter {
  string type = 1;
  string tags = 2;
  repeated string include = 3;
  repeated string exclude = 4;
}

message MenuItemGroup {
  string Group = 1;
  repeated MenuItem Items = 2;
  int64 MenuSort = 3;
  string Mode = 4;
}

message GetMenuItemByIdRequest {
  uint64 ID = 1;
}

message MenuByGroup {
  repeated MenuItemGroup Groups = 1;
}

message YakScriptIsInMenuRequest {
  string Group = 1 ;
  int64 YakScriptId = 2;
}

message RemoveFromMenuRequest {
  int64 YakScriptId = 1;
  string Group = 2;
  string Mode = 3;
}

message AddToMenuRequest {
  int64 YakScriptId = 1;
  string Group = 2;
  string Verbose = 3;
  string Mode = 4;
  int64  MenuSort = 5;
  int64  GroupSort = 6;
}

message AddMenuRequest {
  repeated MenuItemGroup  Data = 1;
}

message QueryAllMenuItemRequest {
  string Mode = 1;
  string Group = 2;
  string Verbose = 3;
}

message ImportMenuItemRequest {
  string RawJson = 1;
  string JsonFileName = 2;
}

message ExportMenuItemResult {
  string RawJson = 1;
}

message AddToNavigationRequest {
  repeated NavigationList Data = 1;
}

message NavigationList {
  string Group = 1;
  repeated NavigationItem Items = 2;
  int64 GroupSort = 3;
  string Mode = 4;
  string GroupLabel = 5;
}

message NavigationItem {
  int64 YakScriptId = 1;
  string Group = 2;
  string Mode = 3;
  int64  VerboseSort = 4;
  int64  GroupSort = 5;
  string Route = 6;
  string YakScriptName = 7;
  string Verbose = 8;
  string VerboseLabel = 9;
  string GroupLabel = 10;
  string HeadImg = 11;
}

message GetAllNavigationRequest {
  string Mode = 1;
  string Group = 2;
  string YakScriptName = 3;
}

message GetAllNavigationItemResponse {
  repeated NavigationList Data = 1;
}

message AddOneNavigationRequest {
  string YakScriptName = 1;
  string Group = 2;
  string Verbose = 3;
  string Mode = 4;
  int64  VerboseSort = 5;
  int64  GroupSort = 6;
  string GroupLabel = 7;
  string VerboseLabel = 8;
  string Route = 9;
}

message QueryNavigationGroupsRequest {
  string YakScriptName = 1;
  string Mode = 2;
}


message UpdateFromYakitResourceRequest {
  string Proxy = 1;
  string BaseSourceUrl = 2;
}

message UpdateFromGithubRequest {
  string Proxy = 1;
  string GithubUrl = 2;
}

message SimpleScript {
  string Content = 1;
}

message LastRecord {
  int64 LastRecordPtr = 1;
  double Percent = 2;
  string YakScriptOnlineGroup = 3;
  string ExtraInfo = 4;
}

message RecordPortScanRequest {
  LastRecord LastRecord = 1;
  StartBruteParams StartBruteParams = 3;
  PortScanRequest PortScanRequest = 2;
  string RuntimeId = 4;
}

message CreatReportRequest {
  string ReportName = 1;
  string RuntimeId = 2;
}

message PortScanRequest {
  string Targets = 1;
  string Ports = 2;
  string Mode = 3;
  repeated string Proto = 4;
  int64 Concurrent = 5;
  // 主动发包模式
  bool Active = 6;
  // service / web / all
  string FingerprintMode = 7;

  // 保存数据库
  bool SaveToDB = 8;

  // 保存已经关闭的端口
  bool SaveClosedPorts = 9;

  // 上传扫描目标为文件
  string TargetsFile = 10;

  // 设置上传的文件
  repeated string ScriptNames = 11;

  // TCPProxy
  repeated string Proxy = 12;

  // 设置单次探测超时时间
  double ProbeTimeout = 13;

  // ProbeMax 设置指纹探测条数
  int32 ProbeMax = 14;

  // 启用 C 段扫描
  bool EnableCClassScan = 15;

  // HostAlive Scan
  bool SkippedHostAliveScan = 16;
  double HostAliveTimeout = 17;
  int32 HostAliveConcurrent = 18;
  string HostAlivePorts = 19;

  // 排除端口与主机
  string ExcludeHosts = 20;
  string ExcludePorts = 21;

  // EnableBasicCrawler
  // 是否启用基础爬虫，以及基础爬虫最多几个请求？
  bool EnableBasicCrawler = 22;
  int64 BasicCrawlerRequestMax = 23;

  // SYN Concurrent
  // 简易设置 SYN 每秒并发
  int64 SynConcurrent = 24;

  string TaskName = 25;

  bool EnableBrute = 26;

  string SynScanNetInterface = 27;

  // 联动插件的配置
  HybridScanPluginConfig LinkPluginConfig = 28;

  // 爬虫是否启用 JS 解析
  bool BasicCrawlerEnableJSParser = 29;
  repeated string UserFingerprintFiles = 30;
  bool SkipCveBaseLine = 31;

  // 指纹规则组
  bool EnableFingerprintGroup = 32;
  repeated string FingerprintGroup = 33;
}

message DeletePortsRequest {
  string Hosts = 1;
  string Ports = 2;
  repeated int64 Id = 3;
  bool All = 4;
  repeated int64 Ids = 5;
  bool DeleteAll = 6;
  QueryPortsRequest Filter = 7;
}

message QueryPortsRequest {
  Paging Pagination = 1;

  // 根据 Hosts Ports 查询
  string Hosts = 2;
  string Ports = 3;
  string Service = 4;
  string State = 5;
  string Title = 6;
  bool   All = 7;
  string Keywords = 8;
  bool  TitleEffective = 9;
  string ComplexSelect = 10;
  string Proto = 11;
  string RuntimeId = 12;

  int64 BeforeUpdatedAt = 13;
  int64 AfterUpdatedAt = 14;
  int64 AfterId = 15;
  int64 BeforeId = 16;
  string OrderBy = 17;
  string Order = 18;
}

message QueryPortsResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated Port Data = 3;
}

message Port {
  string Host = 1;
  int64 IPInteger = 2;
  int64 Port = 3;
  string Proto = 4;
  string ServiceType = 5;
  string State = 6;
  string Reason = 7;
  string Fingerprint = 8;
  repeated string CPE = 9;
  string HtmlTitle = 10;

  int64 Id = 11;
  int64 CreatedAt = 12;
  int64 UpdatedAt = 13;
  string TaskName = 14;
}

message YakitCompletionRawResponse {
  bytes RawJson = 1;
}

message GetYakVMBuildInMethodCompletionRequest {

}

// 这个定义我们争取和 monaco editor suggestion 基本一致
message SuggestionDescription {
  string Label = 1;
  string Description = 2;
  string InsertText = 3;
  bool JustAppend = 4;
  string DefinitionVerbose = 5; // 展示定义的内容，如果没有的话，一般展示 InsertText 就行
  string Kind = 6; // 补全类型, Method = 0, Function = 1, Constructor = 2, Field = 3, Variable = 4, Class = 5, Struct = 6, Interface = 7, Module = 8, Property = 9, Event = 10, Operator = 11, Unit = 12, Value = 13, Constant = 14, Enum = 15, EnumMember = 16, Keyword = 17, Text = 18, Color = 19, File = 20, Reference = 21, Customcolor = 22, Folder = 23, TypeParameter = 24, User = 25, Issue = 26, Snippet = 27
  string Command = 7; // 用于执行的命令
}

message MethodSuggestion {
  // 产生这个方法提示的关键词是啥？
  repeated string ExactKeywords = 1;
  repeated string FuzzKeywords = 2;
  repeated string Regexp = 3;

  // 提示的内容是啥？
  repeated SuggestionDescription Suggestions = 4;

  // 这个代码提示方法组是啥？
  string Verbose = 5;
}

message GetYakVMBuildInMethodCompletionResponse {
  repeated MethodSuggestion Suggestions = 1;
}


message RenameRequest {
  string Name = 1;
  string NewName = 2;
}

message NameRequest {
  string Name = 1;
}

message PayloadGroupNode {
  string Type = 1; // "File" / "DataBase" / "Folder"
  string Name = 2;
  int64 Number = 3;
  repeated PayloadGroupNode Nodes = 4; // for Type "Folder"
}

message GetAllPayloadGroupResponse {
  repeated string Groups = 1;
  repeated PayloadGroupNode Nodes = 2;
}
message UpdateAllPayloadGroupRequest{
  repeated PayloadGroupNode Nodes = 1;
}

message SavePayloadRequest {
  bool IsFile = 1;
  string Group = 2;
  string Content = 3;
  repeated string FileName = 4;
  string Folder = 5;
  bool IsNew = 6;
}


message UpdatePayloadRequest {
  // old
  string Group = 1;   // old
  string OldGroup = 2; // old

  // new, please use this
  int64 Id = 3;
  Payload Data = 4;
}

message UpdatePayloadToFileRequest {
  string GroupName = 1;
  string Content = 2;
}

// copy payload(get by id) to group
message BackUpOrCopyPayloadsRequest {
  repeated int64 Ids = 1;
  string Group = 2;
  string Folder = 3;
  bool Copy = 4;
}

message DeletePayloadByGroupRequest {
  string Group = 1;
}

message DeletePayloadRequest {
  int64 Id = 1;
  repeated int64 Ids = 2;
}

message QueryPayloadFromFileRequest {
  string Group = 1;
  string Folder = 2;
}
message QueryPayloadFromFileResponse {
  bytes Data = 1;
  bool IsBigFile = 2;
}

message QueryPayloadRequest {
  Paging Pagination = 1;
  string Group = 2;
  string Keyword = 3;
  string Folder = 4;
}

message QueryPayloadResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated Payload Data = 3;
}

message Payload {
  int64 Id = 1;
  string Group = 2;
  bytes ContentBytes = 3;
  string Content = 4;
  string Folder = 5;
  int64 HitCount = 6;
  bool IsFile = 7;
}

message GetAllPayloadRequest {
  string Group = 1;
  string Folder = 2;
  string SavePath = 3;
}

message GetAllPayloadResponse {
  repeated Payload Data = 1;
  double Progress = 2;
}

message GetAllPayloadFromFileResponse {
  double Progress = 1;
  bytes Data = 2;
}

message QueryYakScriptRequest {
  Paging Pagination = 1;
  string Type = 2;
  string Keyword = 3;
  bool IsHistory = 4;
  bool IsIgnore = 5;
  bool IsGeneralModule = 6;
  bool IsBatch = 7;
  bool ExcludeNucleiWorkflow = 8;
  repeated string ExcludeScriptNames = 9;
  repeated string IncludedScriptNames = 10;
  repeated string Tag = 11;
  bool NoResultReturn = 12; // 这是一很特殊的选项，如果开启了，total 将会为 0
  int64 UserId = 13;
  string UserName = 14;

  bool IgnoreGeneralModuleOrder = 15;
  repeated string Family = 16;
  string UUID = 17;
  PluginGroup Group = 18;
  repeated string ExcludeTypes = 19;
  int64 IsMITMParamPlugins = 20; //0->默认全部 1->是mitm带参数插件 2->mitm不带参数
  string FieldKeywords = 21;
  string VectorSearchContent = 22;
}

message PluginGroup {
  bool UnSetGroup = 1;
  repeated string Group = 2;
  string IsPocBuiltIn = 3;
}

message QueryYakScriptResponse {
  Paging Pagination = 1;
  int64 Total = 2;
  repeated YakScript Data = 3;
}

message YakScriptParam {
  string Field = 1;
  string DefaultValue = 2;

  // int/number/integer/float/str/bool
  string TypeVerbose = 3;

  string FieldVerbose = 4;

  string Help = 5;

  bool Required = 6;
  string Group = 7;

  string ExtraSetting = 8;

  string MethodType = 9;
  string JsonSchema = 10;

  string SuggestionDataExpression = 11;

  string UISchema = 12;
}

message YakScript {
  int64 Id = 1;
  string Content = 2;
  string Type = 3;
  repeated YakScriptParam Params = 4;
  int64 CreatedAt = 5;
  string ScriptName = 6;
  string Help = 7;
  string Level = 8;
  string Author = 9;
  string Tags = 10;
  bool IsHistory = 11;
  bool IsIgnore = 12;
  bool IsGeneralModule = 13;
  string GeneralModuleVerbose = 14;
  string GeneralModuleKey = 15;
  string FromGit = 16;
  bool EnablePluginSelector = 17;
  string PluginSelectorTypes = 18;
  int64 OnlineId = 19;
  int64 UserId = 20;
  string OnlineScriptName = 21;
  string OnlineContributors = 22;
  string UUID = 23;
  bool OnlineIsPrivate = 24;
  string HeadImg = 25;
  string OnlineBaseUrl = 26;
  int64  BaseOnlineId = 27;
  bool OnlineOfficial = 28;
  string OnlineGroup = 29;
  bool IsCorePlugin = 30;
  int64 UpdatedAt = 31;
  string RiskType = 32;
  // 结构弃用
  QueryYakScriptRiskDetailByCWEResponse RiskDetail = 33;
  string RiskAnnotation = 34;
  // 协作者
  repeated Collaborator CollaboratorInfo = 35;
  repeated YakRiskInfo RiskInfo = 36;
  bool IsUpdate = 37;
  repeated string PluginEnvKey = 38;
  bool SkipUpdate = 39;
}

message Collaborator {
  string HeadImg = 1;
  string UserName = 2;
}

message SaveNewYakScriptRequest {
  string Content = 1;
  string Type = 2;
  repeated YakScriptParam Params = 3;
  string ScriptName = 4;
  string Help = 5;
  string Level = 6;
  string Tags = 7;
  bool IsHistory = 8;
  bool IsIgnore = 9;
  bool IsGeneralModule = 10;
  string GeneralModuleVerbose = 11;
  string GeneralModuleKey = 12;
  string FromGit = 13;
  bool EnablePluginSelector = 14;
  string PluginSelectorTypes = 15;
  bool IsCorePlugin = 16;
  string RiskType = 17;
  // 这个结构弃用,换成YakRiskInfo
  QueryYakScriptRiskDetailByCWEResponse RiskDetail = 18;
  string RiskAnnotation = 19;
  int64 Id = 20;
  repeated YakRiskInfo RiskInfo = 21;
  repeated string PluginEnvKey = 22;
}

message SaveYakScriptToOnlineRequest {
  repeated string ScriptNames = 1;
  string Token = 2;
  bool IsPrivate = 3;
  bool All = 4;
  string PluginSupplement = 5;
}

message SaveYakScriptToOnlineResponse {
  // 进度
  double Progress = 1;
  string Message = 2;
  string MessageType = 3;
}

message ToOnlineResult {
  string ScriptName = 1;
}

message ExportLocalYakScriptRequest {
  string OutputDir = 1;
  string OutputPluginDir = 2;
  repeated int64 YakScriptIds = 3;
  string Keywords = 4;
  string Type = 5;
  string UserName = 6;
  string Tags = 7;
}

message ExportLocalYakScriptResponse {
  string OutputDir = 1;
}

message ExportYakScriptLocalResponse {
  string OutputDir = 1;
  double Progress = 2;
  string Message = 3;
  string MessageType = 4;
}


message ImportYakScriptRequest {
  repeated string Dirs = 1;
}

message ImportYakScriptResult {
  // 进度
  double Progress = 1;
  string Message = 2;
  string MessageType = 3;
}

message SetYakScriptSkipUpdateRequest{
  bool SkipUpdate = 1;
  QueryYakScriptRequest Field = 2;
}

message QueryYakScriptSkipUpdateResponse {
  bool SkipUpdate = 1;
}

message QueryYakScriptGroupRequest {
  bool All = 1;
  string PageId = 2;
  // 默认是false， 目前中有专项漏洞这里的关键词组传 true 才会返回数据，插件管理里面不传就不会返回 poc 这边的内置组
  bool IsPocBuiltIn = 3;
  repeated string ExcludeType = 4;
  int64 IsMITMParamPlugins = 5;
}

message QueryYakScriptGroupResponse {
  repeated GroupCount Group = 1;
}

message GroupCount {
  string Value = 1;
  int32 Total = 2;
  bool Default = 3;
  // 临时组ID
  string TemporaryId = 5;
  bool IsPocBuiltIn = 6;
}

message SaveYakScriptGroupRequest {
  QueryYakScriptRequest Filter = 1;
  repeated string SaveGroup = 2;
  repeated string RemoveGroup = 3;
  string PageId = 4;
}

message RenameYakScriptGroupRequest {
  string Group = 1;
  string NewGroup = 2;
}

message DeleteYakScriptGroupRequest {
  string Group = 1;
}

/*message GetYakScriptGroupRequest {
  QueryYakScriptRequest Filter = 1;
}*/

message GetYakScriptGroupResponse {
  repeated string SetGroup = 1;
  repeated string AllGroup = 2;
}

message ResetYakScriptGroupRequest {
  string Token = 1;
}

message SetGroupRequest {
  string GroupName = 1;
}

message GetYakScriptTagsAndTypeResponse {
  repeated TagsAndType Type = 1;
  repeated TagsAndType Tag = 2;
  repeated TagsAndType Group = 3;
}

message TagsAndType {
  string Value = 1;
  int32 Total = 2;
}

message SnippetsFilter {
  repeated string Name = 1;
}

message SnippetsRequest {
  string Name = 1;
  string Code = 2;
  string Description = 3;
  string State = 4;
  string Level = 5;
}

message EditSnippetsRequest {
  string Target = 1;
  string Name = 2;
  string Code = 3;
  string Description = 4;
  string State = 5;
  string Level = 6;
}

message QuerySnippetsRequest {
  SnippetsFilter Filter = 1;
}

message SnippetsResponse {
  repeated string Names = 1;
  repeated string Codes = 2;
  repeated string Descriptions = 3;
  repeated string States = 4;
  repeated string Levels = 5;
}

message CodecRequest {
  string Text = 1;
  string Type = 2;
  bool Auto = 3;
  repeated ExecParamItem Params = 4;
  string ScriptName = 5;

  // 如果 InputBytes 设置了，将会无条件覆盖 Text
  bytes InputBytes = 6;
}

message CodecWork{
  string CodecType = 1;
  string Script = 2;
  string PluginName = 3;
  repeated ExecParamItem Params = 5;
}

message CodecRequestFlow{
  string Text = 1;
  bool Auto = 2;
  repeated CodecWork WorkFlow = 3;
  bytes InputBytes = 6;
}

message CustomizeCodecFlow{
  string FlowName = 1;
  repeated CodecWork WorkFlow = 2;
  string WorkFlowUI = 3;
}

message UpdateCodecFlowRequest {
  string FlowId = 1;
  string FlowName = 2;
  repeated CodecWork WorkFlow = 3;
  string WorkFlowUI = 4;
}

message DeleteCodecFlowRequest {
  bool DeleteAll = 1;
  string FlowName = 2;
}

message GetCodecFlowResponse {
  repeated CustomizeCodecFlow Flows = 1;
}


message CodecResponse {
  string Result = 1; // show result
  bytes  RawResult = 2; // raw result, need hex editor
  string ResultVerbose = 3;
  bool IsFalseAppearance = 4; // 是否是失真
}

message CodecMethods {
  repeated CodecMethod Methods = 1;
}

message CodecMethod {
  string Tag = 1; // Codec 分类
  string CodecName = 2; //  Codec name
  string CodecMethod = 3; // Codec Method
  string Desc = 4; // 描述
  repeated CodecParam Params = 5; // Codec Param 用于构建样式
}

message CodecParam {
  string Name = 1;
  string Type = 2; // input | select | checkbox | search | monaco | inputSelect
  repeated string Options = 3; // 可选值
  bool  Required = 4; // 就算是false也需要传
  string Desc = 5; // 描述
  string Regex = 6; // 正则
  string Label = 7; // 参数文本标签
  string DefaultValue = 8; // 默认值
  CodecParam Connector = 9; // 连接组件
}

// Yak Invoker
message ExecHistoryRequest {
  Paging Pagination = 1;
  int64 YakScriptId = 3;
  string YakScriptName = 4;
}

message ExecHistoryRecordResponse {
  repeated ExecHistoryRecord Data = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

// 执行的历史记录
message ExecHistoryRecord {
  // 脚本内容
  string Script = 1;
  // 脚本 ID（如果有的话）
  string ScriptId = 2;
  // 执行时间点
  int64 Timestamp = 3;
  // 执行间隔
  int64 DurationMs = 4;
  // 执行参数（命令行参数部分）
  string Params = 5;

  // 执行成功还是失败
  bool Ok = 7;
  // 失败原因是啥？
  string Reason = 8;
  // Uid
  string Id = 9;

  // 展示界面内容
  bytes Stdout = 10;
  bytes Stderr = 11;

  //
  string RuntimeId = 12;
  string FromYakModule = 13;

  int64 StdoutLen = 14;
  int64 StderrLen = 15;

  bytes Messages = 16;

}

// Fuzz 相关模型
message StringFuzzerRequest {
  string Template = 1;
  string HotPatchCode = 2;
  string HotPatchCodeWithParamGetter = 3;
  int64 Limit = 4;
  int64 TimeoutSeconds = 5;
}


message StringFuzzerResponse {
  repeated bytes Results = 1;
}

message HTTPRequestAnalysisMaterial {
  string Request = 1;
  bool IsHTTPS = 2;
  string Response = 3;
}

message HTTPRequestParamItem {
  string TypePosition = 1;
  string ParamOriginValue = 2;
  string ParamName = 3;
  string TypePositionVerbose = 4;
}

message HTTPRequestAnalysis {
  repeated HTTPRequestParamItem Params = 1;
  repeated string Requests = 2;
  bool IsHTTPS = 3;
}

message HTTPResponseMatcher {
  repeated HTTPResponseMatcher SubMatchers = 1;
  string SubMatcherCondition = 2;

  string MatcherType = 3;
  string Scope = 4;
  string Condition = 5;
  repeated string Group = 6;
  string GroupEncoding = 7;
  bool Negative = 8;
  string ExprType = 9;

  string HitColor = 10;
  string Action = 11;
}

message RenderVariablesRequest {
  repeated KVPair Params = 1;
  bool IsHTTPS = 2;
  bool IsGmTLS = 3;
  bytes HTTPRequest = 5;
  bytes HTTPResponse = 4;
}

message RenderVariablesResponse {
  repeated KVPair Results = 1;
}

message MatchHTTPResponseParams {
  repeated HTTPResponseMatcher Matchers = 1;
  string MatcherCondition = 2;

  bool IsHTTPS = 3;
  string HTTPResponse = 4;
  string HTTPRequest = 5;
}

message MatchHTTPResponseResult {
  bool Matched = 1;
}

message HTTPResponseExtractor {
  string Name = 1; // default for index
  string Type = 2; // regex / xpath / kval / json / nuclei-dsl
  string Scope = 3; // body / header / raw
  repeated string Groups = 4;
  repeated int64 RegexpMatchGroup = 5;
  string XPathAttribute = 6;
}

message ExtractHTTPResponseResult {
  repeated FuzzerParamItem Values = 1;
}

message ExtractHTTPResponseParams {
  repeated HTTPResponseExtractor Extractors = 1;
  string HTTPResponse = 2;
  string HTTPRequest = 3;
  bool IsHTTPS = 4;
}

message PreloadHTTPFuzzerParamsRequest {
  repeated FuzzerParamItem Params = 1;
}

message PreloadHTTPFuzzerParamsResponse {
  repeated FuzzerParamItem Values = 2;
}

message FuzzerParamItem {
  string Key = 1;
  string Value = 2;

  // nuclei-dsl / raw
  // fuzztag
  string Type = 3;
  string MarshalValue = 4;
}

message FuzzerRequests {
  repeated FuzzerRequest Requests = 1;
  // concurrent flow
  int64 Concurrent = 2;
}

message GroupHTTPFuzzerOverrides {
  int64 RepeatTimes = 1;
  int64 Concurrent = 2;
  double DelayMinSeconds = 3;
  double DelayMaxSeconds = 4;
  bool DisableUseConnPool = 5;
}

message GroupHTTPFuzzerRequest {
  repeated FuzzerRequest Requests = 1;
  int64 Concurrent = 2;
  GroupHTTPFuzzerOverrides Overrides = 3;
}

message GroupHTTPFuzzerResponse {
  FuzzerRequest Request = 1;
  FuzzerResponse Response = 2;
}

message FuzzerRequest {// last index 68
  string Request = 1;
  bytes RequestRaw = 16;  // 这里是因为麻将块儿的问题，还是需要处理一下类型
  repeated FuzzerParamItem Params = 2;
  int64 Concurrent = 3;
  bool IsHTTPS = 4;
  bool IsGmTLS = 35;
  // random JA3 fingerprint
  bool RandomJA3 = 63;
  bool ForceFuzz = 5;
  string FuzzTagMode = 50; // "close"/"standard"/"legacy"
  bool FuzzTagSyncIndex = 51;
  string Proxy = 6;
  string ProxyRuleId = 70;
  double PerRequestTimeoutSeconds = 7;
  double DialTimeoutSeconds = 61;

  // 用于处理 Host 和 Header 中 Host 不一致的情况
  string ActualAddr = 8;

  // redirect setting
  bool NoFollowRedirect = 9;
  // 这个弃用了，Meta 自动归类到 Redirect 里面
  bool NoFollowMetaRedirect = 10;
  bool FollowJSRedirect = 11;
  double RedirectTimes = 27;

  // 如果从历史加载，就用这个！
  int32 HistoryWebFuzzerId = 12;

  // 如果不想自动修复 Content-Length
  bool NoFixContentLength = 13;

  // 热加载代码
  string HotPatchCode = 14;

  // 设置 Fuzzer
  FuzzerResponseFilter Filter = 15;

  // 随时 delay
  double DelayMinSeconds = 17;
  double DelayMaxSeconds = 18;

  // 获取模版数据
  string HotPatchCodeWithParamGetter = 19;

  // retry
  int64 MaxRetryTimes = 20; // 最大重试次数
  string RetryInStatusCode = 21; // 命中这些状态码的时候，重试
  string RetryNotInStatusCode = 22; // 不是这些状态的时候，重试
  double RetryWaitSeconds = 25; // 重试等待时间
  double RetryMaxWaitSeconds = 26; // 最大重试等待时间

  // Response Charset
  // 默认或者不填为 UTF8
  // 中国的话，用 gb18030
  string ResponseCharset = 23;

  // Verbose
  // 这个字段不需要用户做任何处理，也不需要客户端传递
  // 这是服务端用来初始化的字段，用以构建快速搜索
  string Verbose = 24;

  // dns config
  repeated string DNSServers = 28;
  repeated KVPair EtcHosts = 29;

  // 不启用系统代理
  bool NoSystemProxy = 30;

  // 重复次数
  int64 RepeatTimes = 31;

  // Extractor n Matchers
  repeated HTTPResponseExtractor Extractors = 32;
  repeated HTTPResponseMatcher Matchers = 33;
  string MatchersCondition = 34;
  string HitColor = 36;

  // 如果发包的时候，需要指定一两个插件，那么可以通过他来操作，并把流量一起返回
  repeated string YamlPoCNames = 37;

  // 是否继承上一个 Workflow 的变量？（在 Sequence 中生效）
  bool InheritVariables = 38;
  bool ForceOnlyOneResponse = 39;
  bool InheritCookies = 40; // 上一个 Request 一般来说是单个请求，他的响应信息中 Cookie 也应该被妥善处理

  // web fuzzer task id
  // 需要配合前端的 Index
  // 这两个 Index 如果有的话，后端在执行 HTTP Fuzzer Sequence 的时候，就可以只传递这两个了
  // 如果没有的话，直接把整个 Request 传回去
  string FuzzerIndex = 41; // fuzzer grpc index, every HTTPFuzzer will have one index
  string FuzzerTabIndex = 42; // use witch fuzzer tab, has some config info
  string FuzzerSequenceIndex = 62; // fuzzer sequence index , for sequence fuzzer, front end not set, just use for server push

  // BatchTarget
  // 继承透传给 HTTPPOOL 的参数，可以使用批量目标来发送
  bool BatchTargetFile = 43;
  bytes BatchTarget = 44;
  bool AfterRequested = 45;
  bool StopAtFirstMatch = 46;

  // retry task id
  int64 RetryTaskID = 47;

  // re matcher
  bool ReMatch = 48;

  // default 5M?
  // packet is too large (> MaxBodySize)
  int64 MaxBodySize = 49;

  int64 PauseTaskID = 52;
  bool IsPause = 53;

  repeated MutateMethod MutateMethods = 54;
  bool SetPauseStatus = 55;

  string SNI = 56;
  bool OverwriteSNI = 57;

  // use tcp conn pool
  bool DisableUseConnPool = 58;

  // disable hotPatch
  bool DisableHotPatch = 59;

  // engine drop packet
  bool EngineDropPacket = 60;

  // Random Chunked
  bool EnableRandomChunked = 64;
  int64 RandomChunkedMinLength = 65;
  int64 RandomChunkedMaxLength = 66;
  int64 RandomChunkedMinDelay = 67;
  int64 RandomChunkedMaxDelay = 68;

  bool NoReadMultiResponse = 69;
}

message MutateMethod {
  string Type = 1;
  repeated KVPair Value = 2;
}

message KVPair {
  string Key = 1;
  string Value = 2;
  string MarshalValue = 3;
}

message FuzzerResponseFilter {
  // 设置 body 大小作为过滤依据
  int64 MinBodySize = 1;
  int64 MaxBodySize = 2;

  // 设置正则作为过滤依据，这个正则针对整个数据包生效
  repeated string Regexps = 3;
  repeated string Keywords = 4;

  repeated string StatusCode = 6;
}

message RedirectRequestParams {
  string Request = 1;
  string Response = 2;
  bool IsHttps = 3;
  double PerRequestTimeoutSeconds = 4;
  string Proxy = 5;

  // Extractor n Matchers
  repeated HTTPResponseExtractor Extractors = 6;
  repeated HTTPResponseMatcher Matchers = 7;
  string MatchersCondition = 8;
  string HitColor = 9;

  repeated FuzzerParamItem Params = 10;
  bool IsGmTLS = 11;
}

message ExtractedUrl {
  string Url = 1;
}

message FuzzerSequenceResponse {
  FuzzerRequest Request = 1;
  FuzzerResponse Response = 2;
}

message FuzzerResponse {
  string Method = 1;
  int32  StatusCode = 2;
  string Host = 3;
  string ContentType = 4;
  repeated HTTPHeader Headers = 5;
  bytes ResponseRaw = 6;

  // response body 的长度
  int64 BodyLength = 7;
  // 这个请求大约花费了多长时间
  int64 DurationMs = 8; // FirstByte Duration
  int64 DNSDurationMs = 40;
  int64 FirstByteDurationMs = 41;
  int64 TotalDurationMs = 42;
  int64 TLSHandshakeDurationMs = 56;
  int64 TCPDurationMs = 57;
  int64 ConnectDurationMs = 58;

  // 给一个随机 ID
  string UUID = 9;
  // timestamp 请求
  int64 Timestamp = 10;

  // RequestRaw 原始数据包
  bytes RequestRaw = 11;

  // 猜测可能的编码
  string GuessResponseEncoding = 12;

  // 基础状态
  bool Ok = 31;
  string Reason = 32;

  // IsHTTPS
  bool IsHTTPS = 33;

  // payloads
  repeated string Payloads = 34;

  double BodySimilarity = 35;
  double HeaderSimilarity = 36;

  // Matched by filter
  bool MatchedByFilter = 37;

  string Url = 38;

  int64 TaskId = 39;

  // 使用哪个代理
  string Proxy = 43;
  string RemoteAddr = 44;

  // 如果设置了
  repeated KVPair ExtractedResults = 45;
  bool MatchedByMatcher = 46;
  string HitColor = 47;
  repeated RedirectHTTPFlow RedirectFlows = 48;

  // too large file operators
  bool IsTooLargeResponse = 49;
  string TooLargeResponseHeaderFile = 50;
  string TooLargeResponseBodyFile = 51;
  bool DisableRenderStyles = 52;

  string RuntimeID = 53;
  bool Discard = 54;
  bool IsAutoFixContentType = 55;
  string OriginalContentType = 59;
  string FixContentType = 60;
  bool IsSetContentTypeOptions = 61;
  repeated RandomChunkedResponse RandomChunkedData = 62;
}

message RandomChunkedResponse{
  int64 Index = 1; // 当前的 chunked index
  bytes Data = 2; // 当前的 chunked 数据
  int64 ChunkedLength = 3; // 当前的 chunked 长度
  int64 CurrentChunkedDelayTime = 4; // 当前的 chunked 延迟时间
  int64 TotalDelayTime = 5; // 总的发送耗时
}

message RedirectHTTPFlow {
  bool IsHttps = 1;
  bytes Request = 2;
  bytes Response = 3;
}

message Paging {
  int64 Page = 51;
  int64 Limit = 52;
  string OrderBy = 53;
  string Order = 54;
  string RawOrder = 55;
  int64 BeforeId = 56;
  int64 AfterId = 57;
}

message GetHTTPFlowByHashRequest {
  string Hash = 1;
}

message GetHTTPFlowByIdRequest {
  int64 Id = 1;
}

message GetHTTPFlowByIdsRequest {
  repeated int64 Ids = 2;
}

message GetHTTPFlowBodyByIdRequest {
  int64 Id = 1;
  bool IsRequest = 2;
  int64 BufSize = 3;
  string RuntimeId = 4;

  bool IsRisk = 5;
}

message QueryHTTPFlowRequest {
  Paging Pagination = 1;
  string SourceType = 2;
  string Methods = 3;
  string SearchURL = 4;
  string StatusCode = 5;
  bool HaveCommonParams = 6;
  bool HaveBody = 7;
  string SearchContentType = 9;

  // 一般用于查询增量，查询所有更新前的内容
  int64 BeforeUpdatedAt = 10;
  int64 AfterUpdatedAt = 11;
  int64 AfterId = 12;
  int64 BeforeId = 13;

  string Keyword = 14;

  bool OnlyWebsocket = 15;

  // 查询包含在这个 URL 中的搜索结果
  repeated string IncludeInUrl = 16;
  // 不查询当前 URL 中的结果
  repeated string ExcludeInUrl = 17;
  // 仅查看当前 IP 对应的结果或不包含
  repeated string IncludeInIP = 18;
  repeated string ExcludeInIP = 19;

  repeated int64 ExcludeId = 20;

  repeated string IncludeInWhere = 21;
  repeated int64 IncludeId = 22;

  repeated string Tags = 23;
  string HaveParamsTotal = 24;
  repeated string Color = 25;
  int64 OffsetId = 26;

  int64 AfterBodyLength = 27;
  int64 BeforeBodyLength = 28;
  string IsWebsocket = 29;

  string RuntimeId = 31;
  string FromPlugin = 32;
  bool  Full = 33;

  repeated string IncludePath = 34;
  repeated string ExcludePath = 35;
  repeated string IncludeSuffix = 36;
  repeated string ExcludeSuffix = 37;
  repeated string ExcludeContentType = 38;

  bool WithPayload = 39;
  repeated string RuntimeIDs = 40;

  repeated string IncludeHash = 41;
  repeated string HiddenIndex = 42;

  repeated string ProcessName = 43;
  repeated string ExcludeKeywords = 44;
  string KeywordType = 45; // <empty> = all/response/request
  repeated int64 AnalyzedIds = 46;

  string PayloadKeyword = 47;
  string ExcludeStatusCode = 48; // 排除状态码
}

message HTTPFlowsToOnlineRequest {
  string Token = 1;
  string ProjectName = 2;
  string ProjectDescription = 3;
  string ExternalModule = 4;
  string ExternalProjectCode = 5;
}

message HTTPFlowsToOnlineBatchRequest {
  HTTPFlowsToOnlineRequest ToOnlineWhere = 1;
  QueryHTTPFlowRequest UploadHTTPFlowsWhere = 2;
}

message HTTPFlowsToOnlineBatchResponse {
  int64 SuccessCount = 1;
  int64 FailedCount = 2;
}

message AnalyzeHTTPFlowRequest{
  string HotPatchCode = 1;
  repeated MITMContentReplacer Replacers = 2;
  AnalyzeHTTPFlowConfig Config = 3 ;
  // 分析数据源
  AnalyzedDataSource Source = 4;
  // 响应匹配器
  repeated HTTPResponseMatcher Matchers = 5;
}

message AnalyzedDataSource {
  string SourceType = 1; // 分数数据源来自数据库或者用户手动输入的数据包 database / rawpacket
  // database
  QueryHTTPFlowRequest HTTPFlowFilter = 2;
  // rawpacket
  string RawRequest = 3;
  string RawResponse = 4;
}

message AnalyzeHTTPFlowConfig {
  int64 Concurrency = 1; // 并发数量，不传默认为10
  bool  EnableDeduplicate = 2; // 是否进行单条数据去重
}


message AnalyzeHTTPFlowResponse{
  ExecResult ExecResult = 1;
  HTTPFlowRuleData RuleData = 2;
  string ExtractedContent = 3;
}


message AnalyzedHTTPFlowFilter{
  repeated string ResultIds = 1;
  repeated string RuleVerboseNames = 2;
  repeated string Rule = 3;
}


// 规则数据
message HTTPFlowRuleData{
  int64 Id = 1;
  int64 HTTPFlowId = 2;
  string RuleVerboseName = 3;
  string Rule = 4;
  int64 StatusCode = 5;
  string Url = 6;
  string Method = 7;
  string IPAddress = 8;
}

message ExportHTTPFlowsRequest {
  QueryHTTPFlowRequest ExportWhere = 1;
  repeated int64 Ids = 2;
  repeated string FieldName = 3;
}

message QueryHTTPFlowsProcessNamesResponse {
  repeated string ProcessNames = 1;
}

message DeleteHTTPFlowRequest {
  bool DeleteAll = 1;
  repeated int64 Id = 4;
  repeated string ItemHash = 2;

  string URLPrefix = 3;
  QueryHTTPFlowRequest Filter = 5;
  repeated string  URLPrefixBatch = 6;
}

message QueryHTTPFlowsIdsRequest {
  repeated string IncludeInWhere = 1;
  string SourceType = 2;
}

message QueryHTTPFlowsIdsResponse {
  repeated HTTPFlow Data = 1;
}

message HTTPHeader {
  string Header = 1;
  string Value = 2;
}

message HTTPFlows {
  repeated HTTPFlow Data = 1;
}

message HTTPFlow {
  bool IsHTTPS = 2;
  string Url = 3;
  repeated HTTPHeader RequestHeader = 4;
  bytes Request = 5;
  repeated HTTPHeader ResponseHeader = 6;
  bytes Response = 7;
  string SourceType = 8;
  string Path = 9;
  string Method = 10;
  int64 BodyLength = 11;
  string BodySizeVerbose = 19;
  int64 RequestLength = 31; // 设置 Request Body 长度
  string RequestSizeVerbose = 32; // 设置 Request
  string ContentType = 12;
  int64 StatusCode = 13;
  int64 GetParamsTotal = 14;
  int64 PostParamsTotal = 15;
  int64 CookieParamsTotal = 22;
  int64 UpdatedAt = 16;
  int64 CreatedAt = 17;
  string Hash = 18;

  repeated FuzzableParam GetParams = 20;
  repeated FuzzableParam PostParams = 21;
  repeated FuzzableParam CookieParams = 23;

  string HostPort = 24;
  string IPAddress = 25;

  string HtmlTitle = 26;

  string Tags = 27;
  bool NoFixContentLength = 28;

  uint64 Id = 29;

  // websocket 相关字段
  bool IsWebsocket = 30;
  string WebsocketHash = 33;

  // 标记 UTF8 Invalid
  /*
    一般这不是无损的情况，会涉及到用户 Copy Paste 直接 Body 的需求
  */
  bool InvalidForUTF8Request = 34;
  bool InvalidForUTF8Response = 35;
  string RawRequestBodyBase64 = 36;
  string RawResponseBodyBase64 = 37;

  // 可以安全的传输到 Fuzzer 的 HTTPRequest
  string SafeHTTPRequest = 38;

  /*
  在完全数据下，可加载 Domain 和 RootDomain 还有 Json
  */
  repeated string Domains = 40;
  repeated string RootDomains = 41;
  repeated string JsonObjects = 42;

  bool IsReadTooSlowResponse = 51;
  bool IsTooLargeResponse = 43;
  string TooLargeResponseHeaderFile = 44;
  string TooLargeResponseBodyFile = 45;
  bool DisableRenderStyles = 46;

  // payloads (web fuzzer)
  repeated string Payloads = 47;
  int64 DurationMs = 48;
  string HiddenIndex = 49;
  string FromPlugin = 50;
  string Host = 52;
}

message FuzzableParam {
  string Position = 1;
  string ParamName = 2;
  bytes OriginValue = 3;
  bytes AutoTemplate = 4;
  bool IsHTTPS = 5;
}

message GetHTTPFlowBodyByIdResponse {
  bytes Data = 1;
  string Filename = 2; // 第一个响应里才有，应该保存的文件名
  bool EOF = 3; // 是否是最后一个包
}

message QueryHTTPFlowResponse {
  Paging Pagination = 1;
  repeated HTTPFlow Data = 2;
  int64 Total = 3;
}

message HTTPFlowsFieldGroupRequest {
  bool RefreshRequest = 1;
}

message HTTPFlowsFieldGroupResponse {
  repeated TagsCode Tags = 1;
  repeated TagsCode StatusCode = 2;
}

message HTTPFlowsShareRequest {
  repeated int64 Ids = 1;
  int64 LimitNum = 2;
  int64 ExpiredTime = 3;
  bool Pwd = 4;
  string ShareId = 5;
  string Token = 6;
  string Module = 7;
}

message HTTPFlowsShareResponse {
  string ShareId = 1;
  string ExtractCode = 2;
}

message HTTPFlowsExtractRequest {
  string ShareExtractContent = 1;
}

message TagsCode {
  string Value = 1;
  int32 Total = 2;
}

message WebsocketFlows {
  Paging Pagination = 1;
  repeated WebsocketFlow Data = 2;
  int64 Total = 4;
}

message WebsocketFlow {
  int64 ID = 1;
  int64 CreatedAt = 2;
  string WebsocketRequestHash = 3;
  int64 FrameIndex = 4;
  bool FromServer = 5;
  string MessageType = 6;
  bytes Data = 7;
  string DataSizeVerbose = 8;
  int64 DataLength = 9;
  string DataVerbose = 10;
  bool IsJson = 11;
  bool IsProtobuf = 12;
  string Tags = 13;
}

message SetMITMFilterRequest {
  repeated string includeHostname = 7;
  repeated string excludeHostname = 8;
  repeated string excludeSuffix = 9;
  repeated string includeSuffix = 10;
  repeated string excludeMethod = 11;
  repeated string excludeContentTypes = 40;
  repeated string excludeUri = 43;
  repeated string includeUri = 44;

  MITMFilterData FilterData = 1;
}

message SetMITMFilterResponse {

}

// 中间人劫持的问题
message MITMRequest {
  // id 54
  bytes request = 1;
  bytes response = 111;

  string host = 2;
  uint32 port = 3;
  string downstreamProxy = 4;

  // 用来保证不要串台
  int64 id = 5;
  // 这个是响应劫持需要注意的字段。保证不串台
  int64 responseId = 16;
  bool recover = 6;

  // 过滤器
  repeated string includeHostname = 7;
  repeated string excludeHostname = 8;
  repeated string excludeSuffix = 9;
  repeated string includeSuffix = 10;
  repeated string excludeMethod = 11;
  repeated string excludeContentTypes = 40;
  repeated string excludeUri = 43;
  repeated string includeUri = 44;
  MITMFilterData FilterData = 63;
  bool updateFilter = 12;

  bool hijackResponse = 13;
  bool cancelhijackResponse = 54;

  // 手动丢包
  bool drop = 14;

  // 原封不动放行
  bool forward = 15;

  // mitm plugin 中间人插件，本质上是一段 Yak 代码
  bool setYakScript = 21;
  repeated ExecParamItem yakScriptParams = 22;
  int64 yakScriptID = 23;
  string yakScriptContent = 25;

  // 查看当前启用插件
  bool getCurrentHook = 30;

  // 移除插件
  bool removeHook = 31;  // 当这个为 true 的时候，将会
  RemoveHookParams removeHookParams = 32;

  // 设置自动转发
  bool setAutoForward = 33;
  bool autoForwardValue = 34;

  // 设置清除上下文
  bool setClearMITMPluginContext = 35;

  // 设置启用插件模式，自动加载所有主插件。
  // 如果不设置 initPluginNames 的话，启动所有默认插件
  bool setPluginMode = 36;
  repeated string initPluginNames = 37;

  // 设置规则
  bool setContentReplacers = 38;
  repeated MITMContentReplacer replacers = 39;

  // 恢复 filter, 防止用户删除了全部的 filter
  bool setResetFilter = 41;

  // enable h2
  bool enableHttp2 = 42;

  repeated Certificate certificates = 45;

  // gmtls config
  bool enableGMTLS = 46;
  bool onlyEnableGMTLS = 47;
  bool preferGMTLS = 48;

  // 代理用户名和密码
  string proxyUsername = 49;
  string proxyPassword = 50;
  bool enableProxyAuth = 51;
  repeated string dnsServers = 52;
  repeated KVPair hosts = 53;

  // max content-length
  int64 maxContentLength = 55;
  int64 MaxReadWaitTime = 67;

  // 提前为此次flow设置tags
  repeated string Tags = 56;

  // 过滤 ws
  bool filterWebsocket = 57;
  bool updateFilterWebsocket = 58;

  // force close
  bool ForceDisableKeepAlive = 59;

  // runtime change proxy
  bool SetDownstreamProxy = 60;

  // disable MITM CA Cert Page
  bool DisableCACertPage = 61;

  // random JA3 fingerprint
  bool RandomJA3 = 62;

  // disable websocket compression
  bool DisableWebsocketCompression = 64;

  // hijack filter
  MITMFilterData HijackFilterData = 65;
  bool updateHijackFilter = 66;
}

message FilterDataItem {
  string MatcherType = 1;
  repeated string Group = 2;
}

message MITMFilterData {
  repeated FilterDataItem IncludeHostnames = 1;
  repeated FilterDataItem ExcludeHostnames = 2;

  repeated FilterDataItem  IncludeSuffix = 3;
  repeated FilterDataItem  ExcludeSuffix = 4;

  repeated FilterDataItem IncludeUri = 5;
  repeated FilterDataItem ExcludeUri = 6;

  repeated FilterDataItem ExcludeMethods = 7;
  repeated FilterDataItem ExcludeMIME = 8;
}

message Certificate {
  bytes CrtPem = 1;
  bytes KeyPem = 2;
  repeated bytes CaCertificates = 3;

  // pkcs12path need a .p12 or .pfx file
  bytes Pkcs12Bytes = 4;
  bytes Pkcs12Password = 5;
  string Host = 6;
}

message MITMContentReplacer {
  // 如果是正则的话，就把匹配到的内容替换成对应结果
  // 优先 Golang 原生规则
  // 然后再是 Re2 规则
  // 然后子字符串
  string Rule = 1;

  // 这个功能意义在于，不要替代内容，仅标注颜色（敏感内容）
  bool NoReplace = 2;

  // 这里保存对应结果
  string Result = 3;

  // 选择替换之后的颜色
  string Color = 4;

  // 生效内容：默认对 body 生效
  bool EnableForRequest = 5;
  bool EnableForResponse = 6;
  bool EnableForHeader = 9;
  bool EnableForBody = 10;
  bool EnableForURI = 15;

  // Index
  int32 Index = 7;

  // 额外标签，用于标注 flow
  repeated string ExtraTag = 8;

  // 一键禁用启用全部
  bool Disabled = 11;

  // 展示名称，一般用于助记，不会有啥额外影响
  string VerboseName = 12;

  // 为数据包新增 Header
  repeated HTTPHeader ExtraHeaders = 13;
  repeated HTTPCookieSetting ExtraCookies = 14;

  // Action
  // 额外重复一次这个数据包（替换后的数据）
  // 只有替换数据
  bool ExtraRepeat = 16;
  // 匹配掉之后直接丢包
  bool Drop = 17;

  string EffectiveURL = 18;

  repeated int64 RegexpGroups = 19;
}

message RemoveHookParams {
  bool ClearAll = 1;

  repeated string HookName = 2;
  repeated string RemoveHookID = 3;
}

message MITMResponse {
  bytes request = 1;

  // 劫持的是 HTTPS 吗？
  bool isHttps = 3;
  string url = 4;

  // 和 Request 中的一一对应
  int64 id = 5;

  // 过滤器
  bool justFilter = 16;
  repeated string includeHostname = 17;
  repeated string excludeHostname = 18;
  repeated string excludeSuffix = 19;
  repeated string includeSuffix = 110;
  repeated string excludeMethod = 111;
  repeated string excludeContentTypes = 113;
  repeated string excludeUri = 114;
  repeated string includeUri = 115;
  MITMFilterData FilterData = 116;

  // 替代规则的内容
  bool justContentReplacer = 120;
  repeated MITMContentReplacer replacers = 121;

  // 刷新表格: 如果这个是 True 的话，那么不应该发送回劫持器，应该只发送刷新表格的信息
  bool refresh = 2;
  HTTPFlow historyHTTPFlow = 22;

  bool forResponse = 23;
  bytes response = 24;
  int64 responseId = 26;

  // exec result
  bool haveMessage = 27;
  ExecResult message = 28;

  bool getCurrentHook = 30;
  repeated YakScriptHooks hooks = 31;

  string RemoteAddr = 32;

  // 这里用来展示一些服务端通知，直接弹框就好
  bool haveNotification = 34;
  bytes notificationContent = 33;

  // 这两个标志是用来设置 MITM 加载状态的，用于服务端控制用户端的 "加载中"
  bool haveLoadingSetter = 35;
  bool loadingFlag = 36;

  // Websocket 相关配置
  bool isWebsocket = 37;
  repeated string websocketEncode = 38;
  // Websocket 传输的数据
  bytes Payload = 39;

  // 响应跟踪信息
  TraceInfo traceInfo = 40;
}

message TraceInfo {
  repeated string AvailableDNSServers = 1;
  int64 DurationMs = 2; // ServerTime
  int64 DNSDurationMs = 3; // DNSTime
  int64 ConnDurationMs = 4; // ConnTime
  int64 TotalDurationMs = 5; // TotalTime
  int64 TLSHandshakeDurationMs = 6;
  int64 TCPDurationMs = 7;
  int64 ConnectDurationMs = 8;
}

message YakScriptHooks {
  string HookName = 1;
  repeated YakScriptHookItem Hooks = 2;
}

message YakScriptHookItem {
  int64 YakScriptId = 1;
  string YakScriptName = 2;
  string Verbose = 3;
}

// 最基础的 ECHO
message EchoRequest {
  string text = 1;
}

message EchoResposne {
  string result = 1;
}

// handshake 
message HandshakeRequest {
  string Name = 1;
}

message HandshakeResponse {
  bool Success = 1;
}

// 开启一个端口，对接 GRPC 服务器
message Input {
  bytes raw = 1;

  string host = 2;
  uint32 port = 3;
  string path = 4;
  uint32 width = 5;
  uint32 height = 6;
}

message Output {
  bytes raw = 1;
  string remoteAddr = 11;
  string localAddr = 12;

  // 如果 control 为 true 说明这是一个控制信息
  bool control = 2;
  // 服务端需要关闭
  bool closed = 3;
  // 服务端正在等待连接接入
  bool waiting = 4;
}

// 执行脚本
message ExecParamItem {
  string Key = 1;
  string Value = 2;
}
message ExecRequest {
  // 执行优先级为：ScriptPath > Script > ScriptId
  repeated ExecParamItem Params = 1;
  string Script = 2;
  string ScriptId = 3;
  int64 YakScriptId = 5;

  // 这个是为了满足 Runner 的情况，属于特殊情况
  string RunnerParamRaw = 6;
  bool NoDividedEngine = 7;

  string WorkDir = 8; // 工作目录
  string ScriptPath = 9; // 脚本位置
}

message ExecResult {
  string Hash = 1;
  string OutputJson = 2;
  bytes Raw = 3;
  bool IsMessage = 4;
  bytes Message = 5;

  // 如果是一个保存过的 ExecResult 他应该有数据库记录 ID
  int64 Id = 6;

  string RuntimeID = 7;
  float Progress = 8;
}

message GetLicenseResponse {
  string License = 1;
}

message CheckLicenseRequest {
  string LicenseActivation = 1;
  string CompanyVersion = 2;
}
message DefaultDnsServerResponse{
  repeated string DefaultDnsServer = 1;
}


message HTTPFlowBareRequest {
  int64 Id = 1;
  string BareType = 2;
}

message HTTPFlowBareResponse {
  int64 Id = 1;
  bytes Data = 2;
}
message ImportHTTPFuzzerTaskFromYamlRequest {
  string YamlContent = 1;
}
message ImportHTTPFuzzerTaskFromYamlResponse{
  GeneralResponse Status = 1;
  FuzzerRequests Requests = 2;
}
message ExportHTTPFuzzerTaskToYamlRequest{
  FuzzerRequests Requests = 1;
  string TemplateType = 2;
}
message ExportHTTPFuzzerTaskToYamlResponse{
  GeneralResponse Status = 1;
  string YamlContent = 2;
}

message RenderHTTPFuzzerPacketRequest {
  bytes Packet = 1;
}

message RenderHTTPFuzzerPacketResponse {
  bytes Packet = 1;
}

message SmokingEvaluatePluginBatchRequest {
  repeated string ScriptNames = 1;
  // "syntaxflow" | "nuclei" | "mitm" | "port-scan" | "codec" | "yak"
  string PluginType = 2;
}

message SmokingEvaluatePluginBatchResponse {
  double Progress = 1;
  string Message = 2;
  string MessageType = 3;
}

message GenerateURLRequest{
  string Scheme = 1;
  string Host = 2;
  int32 Port = 3;
  string Username = 4;
  string Password = 5;
}
message GenerateURLResponse{
  string URL = 1;
}

message YakVersionAtLeastRequest{
  string AtLeastVersion = 1;
  string YakVersion = 2;
}
message ParseTrafficRequest{
  int64 Id = 1;
  string Type = 2;
}
message ParseTrafficResponse{
  bool OK = 1;
  string Result = 2;
  string Message = 3;
}
message TraceRouteRequest{
  string Host = 1;
}
message TraceRouteResponse{
  string Ip = 1;
  int64 Rtt = 2;
  string Reason = 3;
  int64 Hop = 4;
}

message EvaluateExpressionRequest {
  string Expression = 1;
  repeated KVPair Variables = 2;
  bool ImportYaklangLibs = 3;
}

message EvaluateExpressionResponse {
  string Result = 1; // json marshal
  bool BoolResult = 2;
}

message EvaluateMultiExpressionRequest {
  repeated string Expressions = 1;
  repeated KVPair Variables = 2;
  bool ImportYaklangLibs = 3;
}

message EvaluateMultiExpressionResponse {
  repeated EvaluateExpressionResponse Results = 1;
}

message ThirdPartyAppConfigItemTemplate{
  bool Required = 2;
  string Name = 1;
  string Verbose = 7;
  string Type = 3;
  string DefaultValue = 4;
  string Desc = 5;
  string Extra = 6;
}

message GetThirdPartyAppConfigTemplate {
  string Name = 1;
  string Verbose = 2;
  string Type = 4;
  repeated ThirdPartyAppConfigItemTemplate Items = 3;
}
message GetThirdPartyAppConfigTemplateResponse{
  repeated GetThirdPartyAppConfigTemplate Templates = 2;
}
message GetFingerprintRequest{

}
message GetFingerprintResponse{

}
message AddFingerprintRequest{
  string Name = 1;
  string Fingerprint = 2;
}
message AddFingerprintResponse{

}
message ModifyFingerprintRequest{
}

message ModifyFingerprintResponse{

}

message ReadFileRequest {
  string FilePath = 1;
  int64 BufSize = 2;
  string FileSystem = 3; // "local" "ssadb"
}

message ReadFileResponse {
  bytes Data = 1;
  bool EOF = 2;
}

message GetReverseShellProgramListRequest{
  string System = 1;
  string CmdType = 2;
}

message GetReverseShellProgramListResponse{
  repeated string ProgramList = 1;
  repeated string ShellList = 2;
}
message GenerateReverseShellCommandRequest{
  string System = 1;
  string CmdType = 2;
  string ShellType = 4;
  string Encode = 5;
  string Program = 6;
  string IP = 7;
  int32 port = 8;
}

message GenerateReverseShellCommandResponse{
  GeneralResponse Status = 1;
  string Result = 2;
}

message DbOperateMessage {
  string TableName = 1; // 表名 数据源
  string Operation = 2; // 操作 (增删改查)
  int64 EffectRows = 3; // 影响行数
  string ExtraMessage = 4; // 额外信息
  int64 CreateID = 5;
}

message CPE {
  string Part = 1;
  string Vendor = 2;
  string Product = 3;
  string Version = 4;
  string Update = 5;
  string Edition = 6;
  string Language = 7;
}

message FingerprintRule {
  int64 Id = 1;
  string RuleName = 2;
  CPE CPE = 3;
  string WebPath = 4;
  string ExtInfo = 5;
  string MatchExpression = 6;
  repeated string GroupName = 7;
}


message FingerprintFilter {
  repeated string Vendor = 1;
  repeated string Product = 2;
  repeated int64 IncludeId = 3;
  repeated string GroupName = 4;
  repeated string RuleName = 5;
  string Keyword = 6;
}

message QueryFingerprintRequest {
  FingerprintFilter Filter = 1;
  Paging Pagination = 2;
}

message QueryFingerprintResponse {
  Paging Pagination = 1;
  repeated FingerprintRule Data = 2;
  int64 Total = 3;
}

message DeleteFingerprintRequest {
  FingerprintFilter Filter = 1;
}

message CreateFingerprintRequest {
  FingerprintRule Rule = 1;
}

message UpdateFingerprintRequest {
  int64 Id = 1;
  string RuleName = 2;
  FingerprintRule Rule = 3;
}
message FingerprintGroup {
  string GroupName = 1;
  int64  Count = 2;
}
message FingerprintGroups {
  repeated FingerprintGroup Data = 1;
}

message RenameFingerprintGroupRequest {
  string GroupName = 1;
  string NewGroupName = 2;
}

message DeleteFingerprintGroupRequest {
  repeated string GroupNames = 1;
}

message BatchUpdateFingerprintToGroupRequest{
  repeated string AppendGroupName = 1;
  repeated string DeleteGroupName = 2;
  FingerprintFilter Filter = 3;
}

message GetFingerprintGroupSetRequest {
  FingerprintFilter Filter = 1;
  bool Union = 2; // default intersect ,if set true return union
}

message ExportFingerprintRequest {
  FingerprintFilter Filter = 1;
  string Password = 2;
  string TargetPath = 3;
}
message ImportFingerprintRequest {
  string InputPath = 1;
  string Password = 2;
}

message DataTransferProgress {
  double Progress = 1;
  string Verbose = 2;
}

message QuerySyntaxFlowRuleRequest{
  Paging Pagination = 1;
  SyntaxFlowRuleFilter Filter = 2;
}

message SyntaxFlowRule{
  int64 Id = 18;

  string RuleName = 1;
  string Content = 2;

  string Language = 3;
  string Type = 4;
  string Severity = 5;
  string Purpose = 6;
  bool IsBuildInRule = 7;

  string Title = 8;
  string TitleZh = 9;
  string Description = 10;
  bool Verified = 11;
  bool AllowIncluded = 12;
  string IncludedName = 13;
  string Tag = 14;


  //字段弃用，使用新结构来做
  string AlertDesc = 15;

  string Hash = 16;

  repeated string GroupName = 17;

  map<string, AlertMessage> AlertMsg = 19;
}

message AlertMessage{
  string Title = 1;
  string TitleZh = 2;
  string Description = 3;
  string Solution = 4;
  string Severity = 5;
  string Purpose = 6;
  string Msg = 7;
  string Cve = 8;
  string RiskType = 9;
  string Tag = 10;
  map<string, string> Extra = 11;
}

message  SyntaxFlowRuleInput{
  string RuleName = 1; // RuleName作为索引，因此不能update RuleName
  string Content = 2;
  string Language = 3;
  repeated string Tags = 4;
  repeated string GroupNames = 5;
  string Description = 6;
  map<string, AlertMessage> AlertMsg = 7;
}

message SyntaxFlowRuleFilter {
  repeated string RuleNames = 1;
  repeated string Language = 2;
  repeated string GroupNames = 3;
  repeated string Severity = 4;
  repeated string Purpose = 5;
  repeated string Tag = 6;
  string Keyword = 7;
  // 是否包含作为库的规则  这些规则只提供相关数据并被其他规则引用 默认不包含
  bool includeLibraryRule = 8; // default false // 废弃
  // for infinite list
  int64 FromId = 9; // 废弃
  int64  UntilId = 10;  // 废弃
  int64 AfterId = 11;
  int64 BeforeId = 12;
  string FilterRuleKind = 13; // "buildIn"内置规则，"unBuildIn"非内置规则组, 空为所有规则
  string FilterLibRuleKind = 14; // "lib"library规则，"noLib"非library规则，空为所有规则
  repeated string RuleIds = 15;
  repeated uint64 Ids = 16 ;
}

message SSAProgram{
  // basic info
  int64 CreateAt = 1;
  int64  UpdateAt = 2;
  string Name = 3;
  string Description = 4;
  string Dbpath = 5;
  string Language = 6;
  string EngineVersion = 7;

  // need re-compile
  bool Recompile = 8;


  uint32 Id = 13;
  // risk number
  int64 CriticalRiskNumber = 10;
  int64 HighRiskNumber = 9;
  int64 WarnRiskNumber = 11;
  int64 LowRiskNumber = 12;
  int64 InfoRiskNumber = 14;
  uint64  SSAProjectID = 15;
}

message SSARiskDiffItem{
  string ProgramName = 1;
  string RuleName = 2;
  string Variable = 3;
  string RiskRuntimeId = 4;
}

message SSARiskDiffRequest{
  SSARiskDiffItem BaseLine = 1; // 原项目
  SSARiskDiffItem Compare = 2; // 被对比的项目
  bool DefaultCompare = 3;
}

message SSARiskDiffResponse{
  SSARisk BaseRisk = 1;
  SSARisk CompareRisk = 2;
  string RuleName = 3;
  string Status = 4;
}

message SSAProgramInput {
  string Name = 1; // index
  string Description = 2;
}

message SSAProgramFilter{
  repeated string ProgramNames = 1;
  repeated string Languages = 2;
  repeated int64 Ids = 3;

  // update range
  int64 BeforeUpdatedAt = 5;
  int64 AfterUpdatedAt = 6;
  // fuzz search
  string Keyword = 7 ;
  // id range
  int64 AfterID = 8;
  int64 BeforeID = 9;

  repeated uint64 ProjectIds = 10;
}


message QuerySSAProgramRequest{
  Paging Paging = 1; // abort
  Paging Pagination = 2;
  SSAProgramFilter Filter = 3;
}

message UpdateSSAProgramRequest{
  SSAProgramInput ProgramInput = 1;
}

message DeleteSSAProgramRequest{
  bool DeleteAll = 1;
  SSAProgramFilter Filter = 2;
}

message QuerySSAProgramResponse{
  Paging Paging = 1; // abort
  Paging Pagination = 5;
  repeated SSAProgram Programs = 2; // abort
  repeated SSAProgram Data = 4;
  int64 Total = 3;
}

message CreateSyntaxFlowRuleRequest{
  SyntaxFlowRuleInput SyntaxFlowInput = 1;
}

message CreateSyntaxFlowRuleResponse {
  DbOperateMessage Message = 1;
  SyntaxFlowRule Rule = 2;
}

message UpdateSyntaxFlowRuleRequest{
  SyntaxFlowRuleInput SyntaxFlowInput = 1;
}

message UpdateSyntaxFlowRuleResponse{
  DbOperateMessage Message = 1;
  SyntaxFlowRule Rule = 2;
}

message QuerySyntaxFlowRuleResponse{
  Paging Pagination = 1;
  DbOperateMessage DbMessage = 2;
  repeated SyntaxFlowRule Rule = 3;
  uint64 Total = 4;
}

message DeleteSyntaxFlowRuleRequest{
  SyntaxFlowRuleFilter Filter = 1;
}

message CheckSyntaxFlowRuleUpdateRequest{}

message CheckSyntaxFlowRuleUpdateResponse {
  bool NeedUpdate = 1;  // 是否需要更新
  string State = 2;  // 更新状态，没有规则"empty",规则需要更新"to_update"
}
message ApplySyntaxFlowRuleUpdateRequest {}

message ApplySyntaxFlowRuleUpdateResponse {
  double Percent = 1;  // 更新进度百分比
  string Message = 2;  // 更新状态信息
}

message SyntaxFlowRuleGroupFilter {
  repeated string GroupNames = 2;
  // for fuzzing search
  string KeyWord = 1;
  string  FilterGroupKind = 3; // "buildIn"内置组，"unBuildIn"非内置组, 空为所有
}

message SyntaxFlowGroup{
  string GroupName = 1;
  int32  Count = 2;
  bool  IsBuildIn = 3;
}

message QuerySyntaxFlowRuleGroupRequest{
  SyntaxFlowRuleGroupFilter Filter = 1;
  Paging Pagination = 2;
}

message QuerySyntaxFlowRuleGroupResponse{
  repeated SyntaxFlowGroup Group = 1;
  Paging Pagination = 2;
}

message CreateSyntaxFlowGroupRequest{
  string GroupName = 1;
}

message UpdateSyntaxFlowRuleGroupRequest {
  string OldGroupName = 1;
  string NewGroupName = 2;
}

message UpdateSyntaxFlowRuleAndGroupRequest{
  SyntaxFlowRuleFilter Filter = 1;
  repeated string AddGroups = 2;
  repeated string RemoveGroups = 3;
  bool All = 4; // abort
}

message QuerySyntaxFlowSameGroupRequest{
  SyntaxFlowRuleFilter Filter = 1;
}

message QuerySyntaxFlowSameGroupResponse{
  repeated SyntaxFlowGroup Group = 1;
}

message DeleteSyntaxFlowRuleGroupRequest{
  SyntaxFlowRuleGroupFilter Filter = 1;
}


message SyntaxFlowRuleToOnlineRequest{
  Paging Pagination = 1;
  SyntaxFlowRuleFilter Filter = 2;
  string Token = 3;
}

message SyntaxFlowRuleOnlineProgress {
  // 进度
  double Progress = 1;
  string Message = 2;
  string MessageType = 3;
}

message DownloadSyntaxFlowRuleRequest {
  string Token = 1;
  SyntaxFlowRuleFilter Filter = 2;
}

message SyntaxFlowScanRequest{
  string ControlMode = 1; // 控制模式 "start" "pause" "resume" "status"

  // 启动扫描任务
  SyntaxFlowRuleFilter Filter = 2; // 用于指定扫描的规则
  repeated string ProgramName = 3; // 用于指定扫描的程序
  // 恢复扫描任务
  string ResumeTaskId = 5;         // 恢复任务ID

  // 其他参数
  bool IgnoreLanguage = 4; // 是否忽略语言 默认为false 将会只运行和当前项目语言一致的规则，最后运行的规则可能会比当前选中的规则少一些。

  // for new rule scan task
  SyntaxFlowRuleInput RuleInput = 6; // 用于新建规则时的调试功能
  // 并发，默认5
  uint32  Concurrency = 7;

  // compile data only in memory 
  bool Memory = 8;
  // 根据项目扫描
  uint64 SSAProjectId = 9;
  repeated string ProjectName = 10;
}

message QuerySyntaxFlowScanTaskRequest{
  Paging Pagination = 1;
  SyntaxFlowScanTaskFilter Filter = 2;
  bool ShowDiffRisk = 3;
}

message SyntaxFlowScanTaskFilter{
  repeated string Programs = 1;
  repeated string Status = 2;
  repeated string TaskIds = 3;
  int64 FromId = 4;
  int64  UntilId = 5;
  string Keyword = 6; // fuzz search program-name
  repeated string Kind = 7; // "debug" | "scan";
  repeated uint64 ProjectIds = 8;
  bool HaveRisk = 17; // 是否有风险
}

message QuerySyntaxFlowScanTaskResponse{
  Paging Pagination = 1;
  repeated SyntaxFlowScanTask Data = 2;
  int64 Total = 3;
}

message SyntaxFlowScanTask {
  uint64 Id = 1;
  int64 CreatedAt = 2;
  int64 UpdatedAt = 3;

  string TaskId = 4;
  repeated string Programs = 5;
  int64 RuleCount = 6;
  string Status = 7; // executing / paused / done / error
  string Reason = 8;
  // query execute
  int64 FailedQuery = 9;
  int64 SkipQuery = 10;
  int64 SuccessQuery = 11;
  // risk
  int64 RiskCount = 12;
  // query process
  int64 TotalQuery = 13;

  SyntaxFlowScanRequest Config = 14;
  string Kind = 15; // "debug" | "scan"
  // diff
  int64 NewRiskCount = 16;
  int64 InfoCount = 17;
  int64 LowCount = 18;
  int64 WarningCount = 19;
  int64 CriticalCount = 20;
  int64 HighCount = 21;
  int64 NewInfoCount = 22;
  int64 NewLowCount = 23;
  int64 NewWarningCount = 24;
  int64 NewCriticalCount = 25;
  int64 NewHighCount = 26;
}

message DeleteSyntaxFlowScanTaskRequest{
  bool DeleteAll = 1;
  SyntaxFlowScanTaskFilter Filter = 2;
}

message SyntaxFlowScanResponse{
  string TaskID = 1;
  // 扫描状态
  string Status = 2; // "executing" | "done" | "paused" | "error"

  ExecResult ExecResult = 3;

  // result
  SyntaxFlowResult Result = 4;
  repeated Risk risks = 5;
  repeated SSARisk SSARisks = 6;

  repeated SyntaxFlowScanActiveTask ActiveTask = 7;
}

message SyntaxFlowScanActiveTask {
  // index 
  string RuleName = 3;
  string ProgramName = 4; 
  // progress 
  double Progress = 5; 

  int64 RunningTime = 6;
  string Info = 7;
}


message SyntaxFlowResultFilter {
  repeated string TaskIDs = 1;
  repeated string ResultIDs = 2;
  repeated string RuleNames = 3;
  repeated string ProgramNames = 4;

  string Keyword = 5;


  bool OnlyRisk = 6;

  int64 AfterID = 7;
  int64 BeforeID = 8;

  repeated string Severity = 9;  //  "info", "low", "middle", "critical", "high"
  repeated string Kind = 10 ; //   "query" | "debug" | "scan"
}

message QuerySyntaxFlowResultRequest{
  Paging Pagination = 2;
  SyntaxFlowResultFilter Filter = 1;
}

message QuerySyntaxFlowResultResponse{
  Paging Pagination = 1;
  DbOperateMessage DbMessage = 2;
  repeated SyntaxFlowResult Results = 3;
  uint64 Total = 4;
}


message SyntaxFlowResult {
  // result ID for yakurl(syntaxflow://)
  uint64 ResultID = 1;
  string TaskID = 2;

  // rule info
  string RuleName = 3;
  string Title = 4;
  string TitleZh = 5;
  string Description = 6;
  string Severity = 7; //  "info", "low", "middle", "critical", "high"
  string Purpose = 8;

  // target info
  string ProgramName = 9;
  string Language = 10;

  // runtime info
  uint64 RiskCount = 11;

  string RuleContent = 12;
  string Kind = 13; // "query" | "debug" | "scan"
  string SaveKind = 14; // "memory" | "database"  
}

message DeleteSyntaxFlowResultRequest{
  bool DeleteContainRisk = 1;  //  是否删除带风险的结果
  bool DeleteAll = 2;  // DeleteAll 的保护
  SyntaxFlowResultFilter Filter = 3;
}

message DeleteSyntaxFlowResultResponse{
  DbOperateMessage Message = 1;
}

message QueryPluginEnvRequest {
  repeated string Key = 1;
}

message PluginEnvData {
  repeated KVPair Env = 1;
}

message DeletePluginEnvRequest {
  string Key = 1;
  bool All = 2;
}

message GetAllFuzztagInfoRequest{
  string Key = 1;
}

message GetAllFuzztagInfoResponse{
  repeated FuzztagInfo Data = 2;
}

message FuzztagArgumentType{
  string Name = 1;
  string DefaultValue = 2;
  string Description = 3;
  bool IsOptional = 4;
  bool IsList = 5;
  repeated string Separators = 6;
}
message FuzztagInfo{
  string Name = 1;
  string Description = 2;
  string VerboseName = 3;
  repeated string Examples = 4;
  repeated FuzztagArgumentType ArgumentTypes = 5;
}

message GenerateFuzztagRequest{
  string Name = 1;
  string Type = 2;
  Range Range = 3;
}

message GenerateFuzztagResponse{
  GeneralResponse Status = 1;
  string Result = 2;
}

message FuzzTagSuggestionRequest{
  string HotPatchCode = 1;
  string FuzztagCode = 2;
  string InspectType = 3;
}

message SSARisk {
  int64 Id = 1;
  int64 CreatedAt = 2;
  int64 UpdatedAt = 3;

  string Hash = 4;

  string ProgramName = 5;
  string CodeSourceUrl = 6;
  string CodeRange = 7;
  string CodeFragment = 8;

  string Title = 9;
  string TitleVerbose = 10;
  string RiskType = 11;
  string RiskTypeVerbose = 12;
  string Details = 13;
  string Severity = 14;

  string FromRule = 15;
  string RuntimeID = 16;

  bool IsPotential = 17;

  string CVE = 18;
  repeated string CWE = 31;
  string CveAccessVector = 19;
  string CveAccessComplexity = 20;
  string Tags = 21;

  bool IsRead = 23;

  uint64 ResultID = 22;
  string Variable = 24;
  int64 Index = 25;

  string FunctionName = 26;
  int64 Line = 27;

  // other mesg
  string Solution = 28;
  string Description = 29 ;
  string LatestDisposalStatus = 30; // 最新处置状态 not_set | is_issue | not_issue | suspicious
}

message SSARisksFilter {
  repeated int64 ID = 1;

  string Search = 2;
  repeated string ProgramName = 3;
  repeated string CodeSourceUrl = 4;
  repeated string RiskType = 5;
  repeated string Severity = 6;
  repeated string FromRule = 7;
  repeated string RuntimeID = 8;
  repeated uint64 ResultID = 9;
  repeated string Tags = 10;
  int64 IsRead = 11; // >0 true  <0 false =0 all
  string Title = 12; // fuzz search
  repeated string Hash = 13;
  repeated string FunctionName = 14;
  int64 BeforeCreatedAt = 15;
  int64 AfterCreatedAt = 16;
  repeated string LatestDisposalStatus = 17;  // not_set | is_issue | not_issue | suspicious
  SSARiskDiffRequest SSARiskDiffRequest = 18;
  // 增量查询
  bool Incremental = 19;
}

message QuerySSARisksRequest {
  Paging Pagination = 1;
  SSARisksFilter Filter = 2;
}

message QuerySSARisksResponse {
  Paging Pagination = 1;
  repeated SSARisk Data = 2;
  int64 Total = 3;
}

message QueryNewSSARisksRequest{
  int64 AfterID = 1;
}

message QueryNewSSARisksResponse{
  repeated SSARisk Data = 1; // new ssa-risk unread data 
  int64 NewRiskTotal = 2; // new ssa-risk unread count
  int64 Total = 3; // total ssa-risk count 
  int64 Unread = 4;// total unread ssa-risk count
}

message DeleteSSARisksRequest {
  SSARisksFilter Filter = 1;
}

message UpdateSSARiskTagsRequest {
  int64 ID = 1;
  repeated string Tags = 2;
}

message GetSSARiskFieldGroupRequest{
  SSARisksFilter Filter = 1;
}

message SSARiskFieldGroupResponse {
  repeated FieldGroup FileField = 1;
  repeated FieldName SeverityField = 2;
  repeated FieldName RiskTypeField = 3;
}

message NewSSARiskReadRequest {
  SSARisksFilter Filter = 1;
}
message NewSSARiskReadResponse {
}

message ExportSSARiskRequest {
  SSARisksFilter Filter = 1;
  string TargetPath =2 ;
  bool WithDataFlowPath =3 ;
  bool WithFileContent = 4;
}

message ExportSSARiskResponse{
  double  Process =1 ;
  string  Verbose =2 ;
}

message ImportSSARiskRequest{
  string InputPath = 1;
}

message ImportSSARiskResponse{
  double  Process =1 ;
  string  Verbose =2 ;
}

message SSARiskFeedbackToOnlineRequest {
  string Token = 1;
  SSARisksFilter Filter = 2;
}

message SSARiskDisposalData{
  int64 Id = 1 ;
  int64 CreatedAt = 2;
  int64 UpdatedAt = 3;

  string Status = 4;
  string Comment = 5;

  int64 RiskId = 6;
  string TaskName = 7;         // 任务名称，追踪处置来自哪次扫描任务
}

message SSARiskDisposalsFilter {
  repeated int64 ID = 1;
  repeated string Status = 2;
  repeated int64 RiskId = 3;

  // for fuzz search
  string Search = 4;
}

message CreateSSARiskDisposalsRequest {
  repeated int64 RiskIds = 1;
  string Status = 2;
  string Comment = 3;
}

message CreateSSARiskDisposalsResponse {
  repeated SSARiskDisposalData Data = 1;
}

message QuerySSARiskDisposalsRequest {
  Paging  Pagination = 1;
  SSARiskDisposalsFilter Filter = 2;
}

message QuerySSARiskDisposalsResponse {
  Paging Pagination = 1;
  repeated SSARiskDisposalData Data = 2;
  int64 Total = 3;
}

message UpdateSSARiskDisposalsRequest {
  SSARiskDisposalsFilter Filter = 1;
  string User = 2;
  string Status = 3;
  string Comment = 4;
}

message UpdateSSARiskDisposalsResponse {
  repeated SSARiskDisposalData Data = 1;
}

message DeleteSSARiskDisposalsRequest {
  SSARiskDisposalsFilter Filter = 1;
}

message DeleteSSARiskDisposalsResponse {
  DbOperateMessage Message = 1;
}

message GetSSARiskDisposalRequest{
  int64 RiskId = 1;
  string RiskHash = 2;
}

message GetSSARiskDisposalResponse{
  repeated SSARiskDisposalData Data = 1;
}


message ExportSyntaxFlowsRequest {
  SyntaxFlowRuleFilter Filter = 1;
  string Password = 2;
  string TargetPath = 3;
}
message ImportSyntaxFlowsRequest {
  string InputPath = 1;
  string Password = 2;
}

message SyntaxflowsProgress {
  // 进度  0-1.0
  double Progress = 1;
  // 展示的提示语，可能是中断原因或者错误原因之类的
  string Verbose = 2;
}

// hot-patch template
message HotPatchTemplate {
  string Name = 1;
  string Content = 2;
  string Type = 3; // fuzzer/mitm/httpflow-analyze
}

message HotPatchTemplateRequest {
  repeated int64 Id = 1;
  repeated string Name = 2;
  repeated string ContentKeyword = 3;
  string Type = 4; // fuzzer/mitm/httpflow-analyze
}

message UpdateHotPatchTemplateRequest {
  HotPatchTemplateRequest Condition = 1;
  HotPatchTemplate Data = 2;
}

message DeleteHotPatchTemplateRequest {
  HotPatchTemplateRequest Condition = 1;
  bool All = 2;
}

message CreateHotPatchTemplateResponse {
  DbOperateMessage Message = 1;
}

message DeleteHotPatchTemplateResponse {
  DbOperateMessage Message = 1;
}

message UpdateHotPatchTemplateResponse {
  DbOperateMessage Message = 1;
}

message QueryHotPatchTemplateResponse {
  DbOperateMessage Message = 1;
  repeated HotPatchTemplate Data = 2;
}

message QueryHotPatchTemplateListRequest {
  string Type = 1; // fuzzer/mitm/httpflow-analyze
}

message QueryHotPatchTemplateListResponse {
  Paging Pagination = 1;
  repeated string Name = 2;
  int64 Total = 3;
}

message GroupTableColumnRequest {
  string DatabaseName = 1; //  enum    Project/Profile/SSA
  string TableName = 2;
  string ColumnName = 3;
}

message GroupTableColumnResponse {
  repeated string Data = 1;
}
message UploadHotPatchTemplateToOnlineRequest {
  string Token = 1;
  string Name = 2;
  string Type = 3; // fuzzer/mitm/httpflow-analyze
}

message DownloadHotPatchTemplateRequest {
  string Name = 1;
  string Type = 2; // fuzzer/mitm/httpflow-analyze
  string Token = 3;
}
message ExportHTTPFlowStreamRequest {
  QueryHTTPFlowRequest Filter = 1;
  repeated string FieldName = 2;
  string ExportType = 3; // csv/har
  string TargetPath = 4;
}

message ExportHTTPFlowStreamResponse {
  double Percent = 1;
  string Verbose = 2;
}

message ImportHTTPFlowStreamRequest {
  string InputPath = 1;
}

message ImportHTTPFlowStreamResponse {
  double Percent = 1;
  string Verbose = 2;
}

message Note {
  uint64 Id = 1;
  string Title = 2;
  string Content = 3;
  int64 CreateAt = 4;
  int64 UpdateAt = 5;
}

message NoteContent {
  Note Note = 1;
  uint64 Index = 2;
  uint64 Line = 3;
  string LineContent = 4;
}

message NoteFilter {
  repeated uint64 Id = 1;
  repeated string Title = 2;
  repeated string Keyword = 3;
}

message CreateNoteRequest {
  string Title = 1;
  string Content = 2;
}

message CreateNoteResponse {
  DbOperateMessage Message = 1;
  int64 NoteId = 2;
}

message UpdateNoteRequest {
  NoteFilter Filter = 1;
  bool UpdateTitle = 2;
  string Title = 3;
  bool UpdateContent = 4;
  string Content = 5;
}

message DeleteNoteRequest {
  NoteFilter Filter = 1;
}

message QueryNoteRequest {
  NoteFilter Filter = 1;
  Paging Pagination = 2;
}

message QueryNoteResponse {
  Paging Pagination = 1;
  repeated Note Data = 2;
  int64 Total = 3;
}

message SearchNoteContentRequest {
  string Keyword = 1;
  Paging Pagination = 2;
}

message SearchNoteContentResponse {
  Paging Pagination = 1;
  repeated NoteContent Data = 2;
  int64 Total = 3;
}

message ImportNoteRequest {
  string TargetPath = 1;
}

message ImportNoteResponse {
  double Percent = 1;
  string Verbose = 2;
  int64 NoteId = 3;
}

message ExportNoteRequest {
  NoteFilter Filter = 1;
  string TargetPath = 2;
}

message ExportNoteResponse {
  double Percent = 1;
  string Verbose = 2;
}



message ListAiModelRequest{
  string Config = 1;
}

message ListAiModelResponse{
  repeated string ModelName = 1;
}

// Local Model Messages
message IsLlamaServerReadyResponse {
  bool Ok = 1;
  string Reason = 2;
}

message IsLocalModelReadyRequest {
  string ModelName = 1;
}

message IsLocalModelReadyResponse {
  bool Ok = 1;
  string Reason = 2;
}

message InstallLlamaServerRequest {
  string Proxy = 1;
}

message StartLocalModelRequest {
  string ModelName = 1;
  string Host = 2;
  int32 Port = 3;
  int32 ContextSize = 4;
  int32 BatchSize = 5;
  int32 Threads = 6;
  bool Debug = 8;
  string Pooling = 9;
  int64 StartupTimeoutMs = 10;
  repeated string Args = 11;
}

message DownloadLocalModelRequest {
  string ModelName = 1;
  string Proxy = 2;
}

message LocalModelConfig {
  string Name = 1;
  string Type = 2;
  string FileName = 3;
  string DownloadURL = 4;
  string Description = 5;
  int32 DefaultPort = 6;
  bool IsLocal = 7;
  bool IsReady = 8;
  string Path = 9;
  LocalModelStatus Status = 10;
}

message GetSupportedLocalModelsResponse {
  repeated LocalModelConfig Models = 1;
}




message MITMV2Request{
  /*
    mitm config message
  */
  string Host = 1;
  uint32 Port = 2;
  string DownstreamProxy = 3;
  // runtime change proxy
  bool SetDownstreamProxy = 4; // runtime change proxy

  bool EnableHttp2 = 5;

  // gmtls config
  bool EnableGMTLS = 6;
  bool OnlyEnableGMTLS = 7;
  bool PreferGMTLS = 8;
  repeated Certificate Certificates = 9;

  string ProxyUsername = 10;
  string ProxyPassword = 11;
  bool EnableProxyAuth = 12;
  repeated string DnsServers = 13;
  repeated KVPair hosts = 14;
  repeated KVPair HostsMapping = 46;

  // max content-length
  int64 MaxContentLength = 15;
  int64 MaxReadWaitTime = 16;

  // 过滤 ws
  bool FilterWebsocket = 17;
  bool UpdateFilterWebsocket = 18;

  // force close
  bool ForceDisableKeepAlive = 19;

  // disable MITM CA Cert Page
  bool DisableCACertPage = 20;

  // random JA3 fingerprint
  bool RandomJA3 = 21;

  // disable websocket compression
  bool DisableWebsocketCompression = 22;

  // filter
  MITMFilterData FilterData = 23;
  bool UpdateFilter = 24;
  bool ResetFilter = 25;

  // condition hijack filter
  MITMFilterData HijackFilterData = 26;
  bool UpdateHijackFilter = 27;


  // set content replacers
  bool SetContentReplacers = 28;
  repeated MITMContentReplacer Replacers = 29;


  // mitm yak script cli/hotpatch
  bool SetYakScript = 30;
  repeated ExecParamItem YakScriptParams = 31;
  int64 YakScriptID = 32;
  string YakScriptContent = 33;

  bool GetCurrentHook = 34; // get current hook plugin

  // remove hook plugin
  bool RemoveHook = 35;
  RemoveHookParams RemoveHookParams = 36;

  bool SetClearMITMPluginContext = 37;


  // 设置启用插件模式，自动加载所有主插件。
  // 如果不设置 initPluginNames 的话，启动所有默认插件
  bool SetPluginMode = 38;
  repeated string InitPluginNames = 39;


  /*
  mitm manual hijack message
  */
  bool SetAutoForward = 40;
  bool AutoForwardValue = 41;

  bool RecoverManualHijack = 42;
  bool ManualHijackControl = 43;
  SingleManualHijackControlMessage ManualHijackMessage = 44;

  bool RecoverContext = 45; // recover mitm context plugin config...
  int64 PluginConcurrency = 47; // 设置插件并发数，默认30
  string DownstreamProxyRuleId = 48;

}

message MITMV2Response {
  // filter
  bool JustFilter = 1;
  MITMFilterData FilterData = 2;

  // Replacer
  bool JustContentReplacer = 3;
  repeated MITMContentReplacer Replacers = 4;

  // exec result
  bool HaveMessage = 7;
  ExecResult Message = 8;

  bool GetCurrentHook = 9;
  repeated YakScriptHooks Hooks = 10;

  // server notification, just show a dialog
  bool HaveNotification = 11;
  bytes NotificationContent = 12;

  // 这两个标志是用来设置 MITM 加载状态的，用于服务端控制用户端的 "加载中"
  bool HaveLoadingSetter = 13;
  bool LoadingFlag = 14;

  string ManualHijackListAction = 15; // add\delete\update\reload
  repeated SingleManualHijackInfoMessage ManualHijackList = 16; // top 20 hijack message
}

message SingleManualHijackControlMessage{
  string TaskID = 1;

  // update config action: can process multiple config info in single control message
  bool HijackResponse = 2;
  bool CancelHijackResponse = 3;

  bool UpdateTags = 4;
  repeated string Tags = 5;
  //--------------------------

  // send packet action: every hijack just can process a send packet action, if set drop|forward|sendpacket hijack will done
  bool Drop = 6; // drop request|response|payload
  bool Forward = 7; // send origin request|response|payload

  bool SendPacket = 8; // send request|response|payload
  bytes Request = 9;
  bytes Response = 10;
  bytes Payload = 11;
}

message SingleManualHijackInfoMessage{
  string TaskID = 1;
  bytes Request = 2;
  bytes Response = 3;
  string Status = 4; // hijack request / hijack response
  bool HijackResponse = 5;
  repeated string Tags = 6;
  bool IsHttps = 7;
  string URL = 8;
  string RemoteAddr = 9;

  // websocket
  bool IsWebsocket = 10;
  bytes Payload = 11;
  repeated string WebsocketEncode = 12;
  TraceInfo TraceInfo = 15;

  string Method = 16;
}

message QueryMITMReplacerRulesRequest{
  string KeyWord = 1;
}

message QueryMITMReplacerRulesResponse{
  MITMContentReplacers Rules = 1;
}

// 插件执行跟踪相关消息定义
message PluginExecutionTrace {
  string TraceID = 1;
  string PluginID = 2;
  string HookName = 3;
  string Status = 4; // "pending", "running", "completed", "failed", "cancelled"
  int64 StartTime = 5;
  int64 EndTime = 6;
  bytes ExecutionArgs = 7; // JSON encoded arguments
  string ErrorMessage = 8;
  int64 DurationMs = 9;
  string RuntimeId = 10;
}

message PluginTraceRequest {
  // 控制字段
  string ControlMode = 1; // "start_stream", "stop_stream", "cancel_trace", "set_tracing"
  // 取消特定Trace
  string TraceID = 2;
  // Tracing开关 打开PluginTrace流不代表启用了插件Trace
  bool EnableTracing = 3;
}

message PluginTraceResponse {
  // 响应类型
  string ResponseType = 1; // "trace_update", "control_result"
  // 跟踪列表
  repeated PluginExecutionTrace Traces = 2;
  // 控制操作结果
  bool Success = 3;
  string Message = 4;
  // 统计信息
  PluginTraceStats Stats = 5;
}

message PluginTraceStats {
  int64 TotalTraces = 1;
  int64 RunningTraces = 2;
  int64 CompletedTraces = 3;
  int64 FailedTraces = 4;
  int64 CancelledTraces = 5;
}

// SSA Report Messages
message GenerateSSAReportRequest {
  string TaskID = 1;     // SSA扫描TaskID
  string ReportName = 2;    // 报告名称
  SSARisksFilter Filter = 3;  // 风险过滤器，用于筛选要生成报告的Risk
}

message GenerateSSAReportResponse {
  bool Success = 1;         // 是否成功
  string Message = 2;       // 消息
  string ReportData = 3;    // 报告数据（当格式不是yakit时）
}

// SSA Project Messages
message SSAProject {
  int64 ID = 1;
  int64 CreatedAt = 2;
  int64 UpdatedAt = 3;
  // 项目基础信息
  string ProjectName = 4;
  string Language = 5;
  string Description = 6;
  repeated string Tags = 7;
  // 源代码来源
  string CodeSourceConfig = 8;
  // 编译配置选项
  SSAProjectCompileConfig CompileConfig = 9;
  // 扫描配置选项
  SSAProjectScanConfig ScanConfig = 10;
  // 规则策略配置
  SSAProjectScanRuleConfig RuleConfig = 11;

  string JSONStringConfig = 12;
  // 漏洞个数
  int64 RiskNumber = 13;
  // 编译次数
  int64 CompileTimes = 14;
  // 本地路径或者远程代码仓库路径
  string URL = 15;
}

message SSAProjectCompileConfig{
  bool StrictMode = 1;
  int64 PeepholeSize = 2;
  repeated string ExcludeFiles = 3;
  bool ReCompile = 4;
  bool Memory = 5;
  uint32  Concurrency = 6;
}

message SSAProjectScanConfig{
  uint32 Concurrency = 1;
  bool Memory = 2;
  bool IgnoreLanguage = 3;
}

message SSAProjectScanRuleConfig{
  SyntaxFlowRuleFilter RuleFilter = 1;
}

message SSAProjectFilter {
  repeated int64 IDs = 1;
  repeated string ProjectNames = 2;
  string SearchKeyword = 3;
  repeated string Languages = 4;
}

message CreateSSAProjectRequest {
  SSAProject Project = 1;
  string JSONStringConfig = 2;
}

message CreateSSAProjectResponse {
  SSAProject Project = 1;
  DbOperateMessage Message = 2;
}

message UpdateSSAProjectRequest {
  SSAProject Project = 1;
}

message UpdateSSAProjectResponse {
  SSAProject Project = 1;
  DbOperateMessage Message = 2;
}

message DeleteSSAProjectRequest {
  SSAProjectFilter Filter = 1;
  // 删除模式:
  // "clear_compile_history" - 只清空编译历史（删除 IrProgram，保留 SSAProject）
  // "delete_all" 或 空字符串 - 清空编译历史和项目信息（删除 IrProgram 和 SSAProject）
  // 默认为 "delete_all"
  string DeleteMode = 2;
  bool DeleteAllProject =3 ;
}

message DeleteSSAProjectResponse {
  DbOperateMessage Message = 1;
}

message QuerySSAProjectRequest {
  SSAProjectFilter Filter = 1;
  Paging Pagination = 2;
}

message QuerySSAProjectResponse {
  repeated SSAProject Projects = 1;
  Paging Pagination = 2;
  int64 Total = 3;
}

message MigrateSSAProjectRequest{}

message MigrateSSAProjectResponse{
  double Percent = 1;  // 更新进度百分比
  string Message = 2;  // 更新状态信息
}
